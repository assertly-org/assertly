!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function o(e,t,n){var r,i,l;if(!e||0===t)return n;if(null===(r=null==e?void 0:e._debugSource)||void 0===r?void 0:r.fileName){const r=function e(t,n={}){var o;if(!t)return c(n),n;const r=t.pendingProps?Object.assign(Object.assign({},n),t.pendingProps):n;if(delete r.children,(null===(o=null==t?void 0:t.type)||void 0===o?void 0:o.__proto__)&&["Component","PureComponent"].includes(t.type.__proto__.name))return c(r),r;return e(t._debugOwner,r)}(null==e?void 0:e._debugOwner),s=function e(t){if(!t)return null;if(t.elementType&&t.elementType.name)return t.elementType.name;if(t.elementType&&t.elementType.displayName)return t.elementType.displayName;if(t.type.displayName)return t.type.displayName;if(t.type.name)return t.type.name;return e(t._debugOwner)}(null==e?void 0:e._debugOwner);return n.push({filename:null===(i=null==e?void 0:e._debugSource)||void 0===i?void 0:i.fileName,linenumber:null===(l=null==e?void 0:e._debugSource)||void 0===l?void 0:l.lineNumber,props:r,componentName:s}),o(null==e?void 0:e._debugOwner,t-1,n)}return o(null==e?void 0:e._debugOwner,t-1,n)}n.r(t),n.d(t,"default",(function(){return u}));const r={mouseup:!0,mousedown:!0,mousemove:!0,mouseover:!0};function i(e){const t=e;return r[e.type]?{x:t.clientX,y:t.clientY}:null}function l(e){const t=Object.keys(e).find(e=>e.startsWith("__reactInternalInstance$")),n=t?e[t]:null;return null==n?null:n}function c(e){for(let t in e)if(e[t]&&"[object Function]"==={}.toString.call(e[t]))try{e[t]="[Function]"}catch(e){console.error("Error stringifying prop",e)}!function(e){const t=Object.keys(e);for(const n of t)"[object Object]"!==Object.prototype.toString.call(e[n])||!e[n].hasOwnProperty("_owner")&&"inputRef"!==n&&"InputProps"!==n||delete e[n]}(e)}class s{constructor(e){this.recordEvents=[],this.reconcileEvents=["blur","focus","change"],this.addAllListeners=()=>{this.recordEvents.forEach(e=>{window.addEventListener(e,this.eventCallback,!0)}),this.reconcileEvents.forEach(e=>{window.addEventListener(e,this.reconcileCallback,!0)})},this.removeAllListeners=()=>{this.recordEvents.forEach(e=>{window.removeEventListener(e,this.eventCallback,!0)}),this.reconcileEvents.forEach(e=>{window.removeEventListener(e,this.reconcileCallback,!0)})},this.start=()=>{window.recorderAddedControlListeners||(this.addAllListeners(),window.recorderAddedControlListeners=!0)},this.stop=()=>{window.recorderAddedControlListeners&&(this.removeAllListeners(),window.recorderAddedControlListeners=!1)};const{eventCallback:t,reconcileCallback:n,recordEvents:o,reconcileEvents:r=null}=e;this.eventCallback=t,this.reconcileCallback=n,this.recordEvents=o,r&&(this.reconcileEvents=r)}}var a=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function l(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,c)}s((o=o.apply(e,t||[])).next())}))};class u{constructor(){this.eventsToRecord=["click","change"],this.componentEventCache=[],this.previousComponent=null,this.previousMsg=null,this.start=()=>{this.eventRecorder.start()},this.stop=()=>{this.eventRecorder.stop()},this.clearEventCache=()=>{this.componentEventCache=[]},this.reconcileEventCache=e=>{(e.target?l(e.target):null)!==this.previousComponent&&(this.componentEventCache.forEach(e=>{console.log("in the reconcile"),this.sendEvent(e)}),this.clearEventCache())},this.createPopupMenu=e=>{var t;const n="componentMenu"+(new Date).getTime(),o=event,r=document.createElement("DIV"),i=Array.from(document.getElementsByClassName("componentMenu"));null==i||i.map(e=>e.remove()),r.setAttribute("id",n),r.setAttribute("class","componentMenu"),document.body.appendChild(r),r.style.position="absolute",r.style.left=o.x+"px",r.style.top=o.y+"px",r.style.zIndex="5",null===(t=null==e?void 0:e.componentInfo)||void 0===t||t.map(t=>{const o=document.createElement("BUTTON");if(o.style.width="150px",o.innerHTML=null==t?void 0:t.componentName,o.innerHTML){o.addEventListener("click",()=>this.componentMenuClick(event,n,e)),r.appendChild(o);const t=document.createElement("br");r.appendChild(t)}});const l=document.createElement("BUTTON");l.style.width="150px",l.innerHTML="Cancel",l.addEventListener("click",()=>this.removeSingleMenu(n)),r.appendChild(l)},this.removeSingleMenu=e=>{const t=document.getElementById(e);null==t||t.remove()},this.componentMenuClick=(e,t,n)=>{var o;console.log("this is the click call back: ",e);const r=null===(o=n.componentInfo)||void 0===o?void 0:o.reduce((t,n)=>{var o;return n.componentName===(null===(o=e.target)||void 0===o?void 0:o.innerHTML)?Object.assign({},n):t},null);null==e||e.stopPropagation(),this.sendEvent(Object.assign(Object.assign({},n),{componentInfo:r})),this.removeSingleMenu(t)},this.getMessage=(e,t)=>{var n,r,l;const c=t.target||t.srcElement,s=c,a=c,u=o(e,10,[]),d=null===(r=null===(n=null==u?void 0:u.slice(0))||void 0===n?void 0:n.reverse())||void 0===r?void 0:r.reduce((e,t)=>{var n;return(null===(n=t.props)||void 0===n?void 0:n.onClick)?Object.assign({},t):e},null);return{action:t.type,checked:(null===(l=null==t?void 0:t.target)||void 0===l?void 0:l.hasOwnProperty("checked"))?s.checked:null,coordinates:i(t),href:a.href?a.href:null,keyCode:t.keyCode?t.keyCode:null,tagName:s.tagName,tagType:s.type,textContent:s.textContent||s.innerText,timestamp:(new Date).getTime(),value:s.value,writeTestLocation:"",componentInfo:u,clickHandlerComponent:d}},this.recordEvent=e=>{var t,n;const o=e.target,r=e;if(!(null===(n=null===(t=null==o?void 0:o.parentElement)||void 0===t?void 0:t.getAttribute("id"))||void 0===n?void 0:n.includes("componentMenu"))&&e.target)try{if(this.previousMsg&&("change"===e.type||"click"===e.type)&&this.previousMsg&&"click"===this.previousMsg.action&&(new Date).getTime()-this.previousMsg.timestamp<100)return void console.log("message not send due to time");const t=l(e.target),n=this.getMessage(t,e);console.log("reactComponent and message in RECORD_EVENT: ",t,n),localStorage.setItem("lastEvent",JSON.stringify(n)),this.previousMsg=n,this.previousComponent=t,(null==r?void 0:r.metaKey)&&this.createPopupMenu(n)}catch(e){console.error("Error recording event",e)}},this.sendEvent=e=>a(this,void 0,void 0,(function*(){const t=window.dataLayer[0].apiKey,n=window.dataLayer[0].testLocation,o=`//localhost:3002/api/accounts/${t}/events/`;console.log("this is the message in SEND_EVENT: ",e),e.writeTestLocation=n,yield fetch(o,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:window.location.href,event:e,placeholder:null})})})),this.eventRecorder=new s({recordEvents:this.eventsToRecord,eventCallback:this.recordEvent,reconcileCallback:this.reconcileEventCache})}}window.eventRecorder=new u,window.eventRecorder.start()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovLy8uL3NyYy9ldmVudC1yZWNvcmRlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY2xpZW50LnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZ2V0Q29tcG9uZW50SW5mbyIsImNvbXBvbmVudCIsIm1heE5lc3QiLCJyZXN1bHRBcnJheSIsIl9kZWJ1Z1NvdXJjZSIsImZpbGVOYW1lIiwicHJvcHMiLCJnZXRDb21wb25lbnRQcm9wcyIsImZ1bmN0aW9uU3RyaW5naWZ5IiwibmV3UHJvcHMiLCJwZW5kaW5nUHJvcHMiLCJjaGlsZHJlbiIsInR5cGUiLCJfX3Byb3RvX18iLCJpbmNsdWRlcyIsIl9kZWJ1Z093bmVyIiwiZ2V0Q29tcG9uZW50TmFtZSIsImZpYmVyIiwiZWxlbWVudFR5cGUiLCJkaXNwbGF5TmFtZSIsInB1c2giLCJmaWxlbmFtZSIsImxpbmVudW1iZXIiLCJsaW5lTnVtYmVyIiwiY29tcG9uZW50TmFtZSIsImV2ZW50c1dpdGhDb29yZGluYXRlcyIsIm1vdXNldXAiLCJtb3VzZWRvd24iLCJtb3VzZW1vdmUiLCJtb3VzZW92ZXIiLCJnZXRDb29yZGluYXRlcyIsImV2ZW50IiwibW91c2VFdmVudCIsIngiLCJjbGllbnRYIiwieSIsImNsaWVudFkiLCJmaW5kUmVhY3RFbGVtZW50IiwidGFyZ2V0Iiwia2V5cyIsImZpbmQiLCJzdGFydHNXaXRoIiwiaW50ZXJuYWxJbnN0YW5jZSIsIm9iaiIsImsiLCJ0b1N0cmluZyIsImUiLCJjb25zb2xlIiwiZXJyb3IiLCJzdHJpcEV4dHJhQ29tcG9uZW50UHJvcHMiLCJFdmVudFJlY29yZGVyIiwiY29uZmlnIiwicmVjb3JkRXZlbnRzIiwicmVjb25jaWxlRXZlbnRzIiwiYWRkQWxsTGlzdGVuZXJzIiwidGhpcyIsImZvckVhY2giLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnRDYWxsYmFjayIsInJlY29uY2lsZUNhbGxiYWNrIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInN0YXJ0IiwicmVjb3JkZXJBZGRlZENvbnRyb2xMaXN0ZW5lcnMiLCJzdG9wIiwiZXZlbnRzVG9SZWNvcmQiLCJjb21wb25lbnRFdmVudENhY2hlIiwicHJldmlvdXNDb21wb25lbnQiLCJwcmV2aW91c01zZyIsImV2ZW50UmVjb3JkZXIiLCJjbGVhckV2ZW50Q2FjaGUiLCJyZWNvbmNpbGVFdmVudENhY2hlIiwibXNnIiwibG9nIiwic2VuZEV2ZW50IiwiY3JlYXRlUG9wdXBNZW51IiwibWVzc2FnZSIsImRpdklEIiwiRGF0ZSIsImdldFRpbWUiLCJtZW51RGl2IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwicHJldmlvdXNNZW51cyIsIkFycmF5IiwiZnJvbSIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJtYXAiLCJ2YWwiLCJyZW1vdmUiLCJzZXRBdHRyaWJ1dGUiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJzdHlsZSIsInBvc2l0aW9uIiwibGVmdCIsInRvcCIsInpJbmRleCIsImNvbXBvbmVudEluZm8iLCJidG4iLCJ3aWR0aCIsImlubmVySFRNTCIsImNvbXBvbmVudE1lbnVDbGljayIsImJyIiwiQ2FuY2VsQnRuIiwicmVtb3ZlU2luZ2xlTWVudSIsImdldEVsZW1lbnRCeUlkIiwic2VsZWN0ZWRDb21wb25lbnQiLCJyZWR1Y2UiLCJhY2MiLCJjdXJyIiwic3RvcFByb3BhZ2F0aW9uIiwiZ2V0TWVzc2FnZSIsInJlYWN0Q29tcG9uZW50Iiwic3JjRWxlbWVudCIsImlucHV0VGFyZ2V0IiwibGlua1RhcmdldCIsImNsaWNrSGFuZGxlciIsInNsaWNlIiwicmV2ZXJzZSIsImFjY3VtdWxhdG9yIiwiY3VycmVudFZhbHVlIiwib25DbGljayIsImFjdGlvbiIsImNoZWNrZWQiLCJjb29yZGluYXRlcyIsImhyZWYiLCJrZXlDb2RlIiwidGFnTmFtZSIsInRhZ1R5cGUiLCJ0ZXh0Q29udGVudCIsImlubmVyVGV4dCIsInRpbWVzdGFtcCIsIndyaXRlVGVzdExvY2F0aW9uIiwiY2xpY2tIYW5kbGVyQ29tcG9uZW50IiwicmVjb3JkRXZlbnQiLCJub2RlVGFyZ2V0IiwicGFyZW50RWxlbWVudCIsImdldEF0dHJpYnV0ZSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YUtleSIsImFjY291bnRJZCIsIndyaXRlTG9jYXRpb24iLCJ1cmwiLCJmZXRjaCIsIm1ldGhvZCIsImNhY2hlIiwiY3JlZGVudGlhbHMiLCJoZWFkZXJzIiwibG9jYXRpb24iLCJwbGFjZWhvbGRlciJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBS2ZGLEVBQW9CUSxFQUFJRixFQUd4Qk4sRUFBb0JTLEVBQUlWLEVBR3hCQyxFQUFvQlUsRUFBSSxTQUFTUixFQUFTUyxFQUFNQyxHQUMzQ1osRUFBb0JhLEVBQUVYLEVBQVNTLElBQ2xDRyxPQUFPQyxlQUFlYixFQUFTUyxFQUFNLENBQUVLLFlBQVksRUFBTUMsSUFBS0wsS0FLaEVaLEVBQW9Ca0IsRUFBSSxTQUFTaEIsR0FDWCxvQkFBWGlCLFFBQTBCQSxPQUFPQyxhQUMxQ04sT0FBT0MsZUFBZWIsRUFBU2lCLE9BQU9DLFlBQWEsQ0FBRUMsTUFBTyxXQUU3RFAsT0FBT0MsZUFBZWIsRUFBUyxhQUFjLENBQUVtQixPQUFPLEtBUXZEckIsRUFBb0JzQixFQUFJLFNBQVNELEVBQU9FLEdBRXZDLEdBRFUsRUFBUEEsSUFBVUYsRUFBUXJCLEVBQW9CcUIsSUFDL0IsRUFBUEUsRUFBVSxPQUFPRixFQUNwQixHQUFXLEVBQVBFLEdBQThCLGlCQUFWRixHQUFzQkEsR0FBU0EsRUFBTUcsV0FBWSxPQUFPSCxFQUNoRixJQUFJSSxFQUFLWCxPQUFPWSxPQUFPLE1BR3ZCLEdBRkExQixFQUFvQmtCLEVBQUVPLEdBQ3RCWCxPQUFPQyxlQUFlVSxFQUFJLFVBQVcsQ0FBRVQsWUFBWSxFQUFNSyxNQUFPQSxJQUN0RCxFQUFQRSxHQUE0QixpQkFBVEYsRUFBbUIsSUFBSSxJQUFJTSxLQUFPTixFQUFPckIsRUFBb0JVLEVBQUVlLEVBQUlFLEVBQUssU0FBU0EsR0FBTyxPQUFPTixFQUFNTSxJQUFRQyxLQUFLLEtBQU1ELElBQzlJLE9BQU9GLEdBSVJ6QixFQUFvQjZCLEVBQUksU0FBUzFCLEdBQ2hDLElBQUlTLEVBQVNULEdBQVVBLEVBQU9xQixXQUM3QixXQUF3QixPQUFPckIsRUFBZ0IsU0FDL0MsV0FBOEIsT0FBT0EsR0FFdEMsT0FEQUgsRUFBb0JVLEVBQUVFLEVBQVEsSUFBS0EsR0FDNUJBLEdBSVJaLEVBQW9CYSxFQUFJLFNBQVNpQixFQUFRQyxHQUFZLE9BQU9qQixPQUFPa0IsVUFBVUMsZUFBZTFCLEtBQUt1QixFQUFRQyxJQUd6Ry9CLEVBQW9Ca0MsRUFBSSxHQUlqQmxDLEVBQW9CQSxFQUFvQm1DLEVBQUksRywrQkNoRjlDLFNBQVNDLEVBQWlCQyxFQUFnQkMsRUFBaUJDLEcsVUFLaEUsSUFBS0YsR0FBeUIsSUFBWkMsRUFFaEIsT0FBT0MsRUFHVCxHQUEyQixRQUEzQixFQUFJRixhQUFTLEVBQVRBLEVBQVdHLG9CQUFZLGVBQUVDLFNBQVUsQ0FFckMsTUFBTUMsRUFlSCxTQUFTQyxFQUFrQk4sRUFBZ0JLLEVBQVEsSSxNQUN4RCxJQUFLTCxFQUVILE9BREFPLEVBQWtCRixHQUNYQSxFQUdULE1BQU1HLEVBQVdSLEVBQVVTLGFBQ3ZCLE9BQUQsd0JBQU1KLEdBQVVMLEVBQVVTLGNBQ3pCSixFQUdKLFVBRk9HLEVBQVNFLFVBR0MsUUFBZixFQUFBVixhQUFTLEVBQVRBLEVBQVdXLFlBQUksZUFBRUMsWUFDakIsQ0FBQyxZQUFhLGlCQUFpQkMsU0FBU2IsRUFBVVcsS0FBS0MsVUFBVXRDLE1BR2pFLE9BREFpQyxFQUFrQkMsR0FDWEEsRUFHVCxPQUFPRixFQUFrQk4sRUFBVWMsWUFBYU4sR0FsQ2hDRixDQUFrQk4sYUFBUyxFQUFUQSxFQUFXYyxhQUNyQ3hDLEVBb0NILFNBQVN5QyxFQUFpQkMsR0FDL0IsSUFBS0EsRUFBTyxPQUFPLEtBRW5CLEdBQUlBLEVBQU1DLGFBQWVELEVBQU1DLFlBQVkzQyxLQUN6QyxPQUFPMEMsRUFBTUMsWUFBWTNDLEtBRzNCLEdBQUkwQyxFQUFNQyxhQUFlRCxFQUFNQyxZQUFZQyxZQUN6QyxPQUFPRixFQUFNQyxZQUFZQyxZQUczQixHQUFJRixFQUFNTCxLQUFLTyxZQUNiLE9BQU9GLEVBQU1MLEtBQUtPLFlBR3BCLEdBQUlGLEVBQU1MLEtBQUtyQyxLQUNiLE9BQU8wQyxFQUFNTCxLQUFLckMsS0FFcEIsT0FBT3lDLEVBQWlCQyxFQUFNRixhQXREZkMsQ0FBaUJmLGFBQVMsRUFBVEEsRUFBV2MsYUFPekMsT0FOQVosRUFBWWlCLEtBQUssQ0FDZkMsU0FBaUMsUUFBekIsRUFBRXBCLGFBQVMsRUFBVEEsRUFBV0csb0JBQVksZUFBRUMsU0FFbkNpQixXQUFtQyxRQUF6QixFQUFFckIsYUFBUyxFQUFUQSxFQUFXRyxvQkFBWSxlQUFFbUIsV0FDckNqQixNQUFPQSxFQUNQa0IsY0FBZWpELElBQ1Z5QixFQUFpQkMsYUFBUyxFQUFUQSxFQUFXYyxZQUFZYixFQUFRLEVBQUVDLEdBRXpELE9BQU9ILEVBQWlCQyxhQUFTLEVBQVRBLEVBQVdjLFlBQVliLEVBQVEsRUFBRUMsRywrQ0FnRDdELE1BQU1zQixFQUFnRCxDQUNwREMsU0FBUyxFQUNUQyxXQUFXLEVBQ1hDLFdBQVcsRUFDWEMsV0FBVyxHQUdOLFNBQVNDLEVBQWVDLEdBQzdCLE1BQU1DLEVBQWFELEVBRW5CLE9BQU9OLEVBQXNCTSxFQUFNbkIsTUFDL0IsQ0FBRXFCLEVBQUdELEVBQVdFLFFBQVNDLEVBQUdILEVBQVdJLFNBQ3ZDLEtBSUMsU0FBU0MsRUFBaUJDLEdBRS9CLE1BQU0vQyxFQUFNYixPQUFPNkQsS0FBS0QsR0FBUUUsS0FBTWpELEdBQ3BDQSxFQUFJa0QsV0FBVyw2QkFNWEMsRUFBbUJuRCxFQUZQK0MsRUFFdUIvQyxHQUFPLEtBRWhELE9BQXdCLE1BQXBCbUQsRUFBaUMsS0FPOUJBLEVBV0YsU0FBU2xDLEVBQWtCbUMsR0FDaEMsSUFBSyxJQUFJQyxLQUFLRCxFQUNaLEdBQUlBLEVBQUlDLElBQW1DLHNCQUE3QixHQUFHQyxTQUFTMUUsS0FBS3dFLEVBQUlDLElBQ2pDLElBSUVELEVBQUlDLEdBQUssYUFDVCxNQUFPRSxHQUNQQyxRQUFRQyxNQUFNLDBCQUEyQkYsSUFTakQsU0FBa0N4QyxHQUNoQyxNQUFNaUMsRUFBTzdELE9BQU82RCxLQUFLakMsR0FDekIsSUFBSyxNQUFNZixLQUFPZ0QsRUFFaUMsb0JBQS9DN0QsT0FBT2tCLFVBQVVpRCxTQUFTMUUsS0FBS21DLEVBQU1mLE1BQ3BDZSxFQUFNZixHQUFLTSxlQUFlLFdBQ2pCLGFBQVJOLEdBQ1EsZUFBUkEsVUFFS2UsRUFBTWYsR0FkakIwRCxDQUF5Qk4sR0N4SFosTUFBTU8sRUFNbkIsWUFBWUMsR0FISixLQUFBQyxhQUE0QixHQUM1QixLQUFBQyxnQkFBbUMsQ0FBQyxPQUFRLFFBQVMsVUFpQjdELEtBQUFDLGdCQUFrQixLQUNoQkMsS0FBS0gsYUFBYUksUUFBU3pCLElBQ3pCMEIsT0FBT0MsaUJBQWlCM0IsRUFBT3dCLEtBQUtJLGVBQWUsS0FHckRKLEtBQUtGLGdCQUFnQkcsUUFBU3pCLElBQzVCMEIsT0FBT0MsaUJBQWlCM0IsRUFBT3dCLEtBQUtLLG1CQUFtQixNQUkzRCxLQUFBQyxtQkFBcUIsS0FDbkJOLEtBQUtILGFBQWFJLFFBQVN6QixJQUN6QjBCLE9BQU9LLG9CQUFvQi9CLEVBQU93QixLQUFLSSxlQUFlLEtBRXhESixLQUFLRixnQkFBZ0JHLFFBQVN6QixJQUM1QjBCLE9BQU9LLG9CQUFvQi9CLEVBQU93QixLQUFLSyxtQkFBbUIsTUFJOUQsS0FBQUcsTUFBUSxLQUNETixPQUFPTyxnQ0FDVlQsS0FBS0Qsa0JBQ0xHLE9BQU9PLCtCQUFnQyxJQUkzQyxLQUFBQyxLQUFPLEtBQ0RSLE9BQU9PLGdDQUNUVCxLQUFLTSxxQkFDTEosT0FBT08sK0JBQWdDLElBM0N6QyxNQUFNLGNBQ0pMLEVBQWEsa0JBQ2JDLEVBQWlCLGFBQ2pCUixFQUFZLGdCQUNaQyxFQUFrQixNQUNoQkYsRUFDSkksS0FBS0ksY0FBZ0JBLEVBQ3JCSixLQUFLSyxrQkFBb0JBLEVBQ3pCTCxLQUFLSCxhQUFlQSxFQUNoQkMsSUFDRkUsS0FBS0YsZ0JBQWtCQSxJLDBTQ1hkLE1BQU0sRUFRbkIsY0FQQSxLQUFBYSxlQUE4QixDQUFDLFFBQVMsVUFHaEMsS0FBQUMsb0JBQWlDLEdBQ2pDLEtBQUFDLGtCQUFzQyxLQUN0QyxLQUFBQyxZQUE4QixLQVV0QyxLQUFBTixNQUFRLEtBQ05SLEtBQUtlLGNBQWNQLFNBR3JCLEtBQUFFLEtBQU8sS0FDTFYsS0FBS2UsY0FBY0wsUUFHckIsS0FBQU0sZ0JBQWtCLEtBQ2hCaEIsS0FBS1ksb0JBQXNCLElBRzdCLEtBQUFLLG9CQUF1QnpDLEtBQ0VBLEVBQU1PLE9BQVNELEVBQWlCTixFQUFNTyxRQUFVLFFBQ2hEaUIsS0FBS2Esb0JBQzFCYixLQUFLWSxvQkFBb0JYLFFBQVNpQixJQUNoQzFCLFFBQVEyQixJQUFJLG9CQUNabkIsS0FBS29CLFVBQVVGLEtBRWpCbEIsS0FBS2dCLG9CQUlULEtBQUFLLGdCQUFtQkMsSSxNQUVqQixNQUNNQyxFQUFRLGlCQURJLElBQUlDLE1BQU9DLFVBRXZCaEQsRUFBYUQsTUFDYmtELEVBQVVDLFNBQVNDLGNBQWMsT0FFakNDLEVBQWdCQyxNQUFNQyxLQUFLSixTQUFTSyx1QkFBdUIsa0JBQ2pFSCxXQUFlSSxJQUFLQyxHQUFhQSxFQUFJQyxVQUVyQ1QsRUFBUVUsYUFBYSxLQUFNYixHQUMzQkcsRUFBUVUsYUFBYSxRQUFTLGlCQUM5QlQsU0FBU1UsS0FBS0MsWUFBWVosR0FDMUJBLEVBQVFhLE1BQU1DLFNBQVcsV0FDekJkLEVBQVFhLE1BQU1FLEtBQU9oRSxFQUFXQyxFQUFJLEtBQ3BDZ0QsRUFBUWEsTUFBTUcsSUFBTWpFLEVBQVdHLEVBQUksS0FDbkM4QyxFQUFRYSxNQUFNSSxPQUFTLElBRUQsUUFBdEIsRUFBQXJCLGFBQU8sRUFBUEEsRUFBU3NCLHFCQUFhLFNBQUVYLElBQUtDLElBQzNCLE1BQU1XLEVBQU1sQixTQUFTQyxjQUFjLFVBR25DLEdBRkFpQixFQUFJTixNQUFNTyxNQUFRLFFBQ2xCRCxFQUFJRSxVQUFZYixhQUFHLEVBQUhBLEVBQUtqRSxjQUNqQjRFLEVBQUlFLFVBQVcsQ0FDakJGLEVBQUkxQyxpQkFBaUIsUUFBUyxJQUFNSCxLQUFLZ0QsbUJBQW1CeEUsTUFBTytDLEVBQU9ELElBQzFFSSxFQUFRWSxZQUFZTyxHQUNwQixNQUFNSSxFQUFLdEIsU0FBU0MsY0FBYyxNQUNsQ0YsRUFBUVksWUFBWVcsTUFJeEIsTUFBTUMsRUFBWXZCLFNBQVNDLGNBQWMsVUFDekNzQixFQUFVWCxNQUFNTyxNQUFRLFFBQ3hCSSxFQUFVSCxVQUFZLFNBQ3RCRyxFQUFVL0MsaUJBQWlCLFFBQVMsSUFBTUgsS0FBS21ELGlCQUFpQjVCLElBQ2hFRyxFQUFRWSxZQUFZWSxJQUd0QixLQUFBQyxpQkFBb0I1QixJQUNsQixNQUFNRyxFQUFVQyxTQUFTeUIsZUFBZTdCLEdBQ3hDRyxXQUFTUyxVQUdYLEtBQUFhLG1CQUFxQixDQUFDeEUsRUFBWStDLEVBQVlELEssTUFDNUM5QixRQUFRMkIsSUFBSSxnQ0FBaUMzQyxHQUU3QyxNQUFNNkUsRUFBeUMsUUFBeEIsRUFBRy9CLEVBQVFzQixxQkFBYSxlQUFFVSxPQUMvQyxDQUFDQyxFQUFVQyxLLE1BQ1QsT0FBSUEsRUFBS3ZGLGlCQUE4QixRQUFqQixFQUFLTyxFQUFNTyxjQUFNLGVBQUVnRSxXQUNoQyxPQUFQLFVBQVlTLEdBQ0VELEdBQ2YsTUFFTC9FLFdBQU9pRixrQkFDUHpELEtBQUtvQixVQUFVLE9BQUQsd0JBQ1RFLEdBQU8sQ0FHVnNCLGNBQWVTLEtBR2pCckQsS0FBS21ELGlCQUFpQjVCLElBTXhCLEtBQUFtQyxXQUFhLENBQUNDLEVBQXFCbkYsSyxVQUdqQyxNQU1NTyxFQUFTUCxFQUFNTyxRQUFVUCxFQUFNb0YsV0FDL0JDLEVBQWM5RSxFQUNkK0UsRUFBYS9FLEVBRWI2RCxFQUFnQm5HLEVBQWlCa0gsRUFBZ0IsR0FBSSxJQUdyREksRUFBK0MsUUFBbkMsRUFBeUIsUUFBekIsRUFBR25CLGFBQWEsRUFBYkEsRUFBZW9CLE1BQU0sVUFBQyxlQUFHQyxpQkFBTyxlQUFJWCxPQWJoQyxDQUFDWSxFQUFrQkMsSyxNQUMxQyxPQUFzQixRQUF0QixFQUFJQSxFQUFhcEgsYUFBSyxlQUFFcUgsU0FDZixPQUFQLFVBQVdELEdBQ0dELEdBVWdFLE1BMkJsRixNQXRCeUIsQ0FFdkJHLE9BQVE3RixFQUFNbkIsS0FDZGlILFNBQXNCLFFBQWIsRUFBQTlGLGFBQUssRUFBTEEsRUFBT08sY0FBTSxlQUFFekMsZUFBZSxZQUNuQ3VILEVBQVlTLFFBQ1osS0FDSkMsWUFBYWhHLEVBQWVDLEdBQzVCZ0csS0FBTVYsRUFBV1UsS0FBT1YsRUFBV1UsS0FBTyxLQUMxQ0MsUUFBVWpHLEVBQXdCaUcsUUFDN0JqRyxFQUF3QmlHLFFBQ3pCLEtBQ0pDLFFBQVNiLEVBQVlhLFFBQ3JCQyxRQUFTZCxFQUFZeEcsS0FDckJ1SCxZQUFhZixFQUFZZSxhQUFlZixFQUFZZ0IsVUFDcERDLFdBQVcsSUFBSXRELE1BQU9DLFVBQ3RCL0YsTUFBT21JLEVBQVluSSxNQUNuQnFKLGtCQUFtQixHQUNuQm5DLGNBQWVBLEVBQ2ZvQyxzQkFBdUJqQixJQVMzQixLQUFBa0IsWUFBZXpHLEksUUFDYixNQUFNMEcsRUFBYTFHLEVBQU1PLE9BQ25CTixFQUFhRCxFQUduQixLQUFnRCxRQUFoRCxFQUE2QixRQUE3QixFQUFJMEcsYUFBVSxFQUFWQSxFQUFZQyxxQkFBYSxlQUFFQyxhQUFhLGFBQUksZUFBRzdILFNBQVMsbUJBR3ZEaUIsRUFBTU8sT0FFWCxJQUNFLEdBQUlpQixLQUFLYyxjQUVXLFdBQWZ0QyxFQUFNbkIsTUFBb0MsVUFBZm1CLEVBQU1uQixPQUNsQzJDLEtBQUtjLGFBQ3VCLFVBQTVCZCxLQUFLYyxZQUFZdUQsU0FDakIsSUFBSTdDLE1BQU9DLFVBQVl6QixLQUFLYyxZQUFZZ0UsVUFBWSxJQUdwRCxZQURBdEYsUUFBUTJCLElBQUksZ0NBS2hCLE1BQU13QyxFQUFpQjdFLEVBQWlCTixFQUFNTyxRQUN4Q21DLEVBQWVsQixLQUFLMEQsV0FBV0MsRUFBZ0JuRixHQUNyRGdCLFFBQVEyQixJQUFJLCtDQUFnRHdDLEVBQWdCekMsR0FFNUVtRSxhQUFhQyxRQUFRLFlBQWFDLEtBQUtDLFVBQVV0RSxJQUNqRGxCLEtBQUtjLFlBQWNJLEVBMkJuQmxCLEtBQUthLGtCQUFvQjhDLEdBR3JCbEYsYUFBVSxFQUFWQSxFQUFZZ0gsVUFBU3pGLEtBQUtxQixnQkFBZ0JILEdBRTlDLE1BQU8zQixHQUNQQyxRQUFRQyxNQUFNLHdCQUF5QkYsS0FJM0MsS0FBQTZCLFVBQW1CRSxHQUFxQixFQUFELGdDQUVyQyxNQUFNb0UsRUFBYXhGLE9BQTZDLFVBQUUsR0FBVyxPQUN2RXlGLEVBQWlCekYsT0FBNkMsVUFBRSxHQUFpQixhQUNqRjBGLEVBQU0saUNBQWlDRixZQUc3Q2xHLFFBQVEyQixJQUFJLHNDQUF1Q0csR0FFbkRBLEVBQVF5RCxrQkFBb0JZLFFBR3RCRSxNQUFNRCxFQUFLLENBQ2ZFLE9BQVEsT0FDUmxLLEtBQU0sT0FDTm1LLE1BQU8sV0FDUEMsWUFBYSxjQUNiQyxRQUFTLENBQ1AsZUFBZ0Isb0JBRWxCNUQsS0FBTWtELEtBQUtDLFVBQVUsQ0FDbkJJLElBQUsxRixPQUFPZ0csU0FBUzFCLEtBQ3JCaEcsTUFBTzhDLEVBRVA2RSxZQUFhLFlBek9qQm5HLEtBQUtlLGNBQWdCLElBQUlwQixFQUFjLENBQ3JDRSxhQUFjRyxLQUFLVyxlQUNuQlAsY0FBZUosS0FBS2lGLFlBQ3BCNUUsa0JBQW1CTCxLQUFLaUIsdUJBNE94QmYsT0FBUWEsY0FBZ0IsSUFBSSxFQUM1QmIsT0FBUWEsY0FBY1AiLCJmaWxlIjoiYXNzZXJ0bHkuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJpbXBvcnQgQ29vcmRpbmF0ZXMgZnJvbSBcIi4vdHlwZXMvQ29vcmRpbmF0ZXNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbXBvbmVudEluZm8oY29tcG9uZW50OiBhbnksIG1heE5lc3Q6IG51bWJlciwgcmVzdWx0QXJyYXk6IGFueSk6IGFueSB7XG4gIFxuXG4gIC8vIGNvbnNvbGUubG9nKCdmaW5kRmlsZU5hbWU6ICcsIGNvbXBvbmVudClcblxuICBpZiAoIWNvbXBvbmVudCB8fCBtYXhOZXN0ID09PSAwKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ3Jlc3VsdEFycmF5OiAnLCByZXN1bHRBcnJheSlcbiAgICByZXR1cm4gcmVzdWx0QXJyYXlcbiAgfVxuXG4gIGlmIChjb21wb25lbnQ/Ll9kZWJ1Z1NvdXJjZT8uZmlsZU5hbWUpIHtcbiAgICAvLyB0aGUgb3duZXIgb2YgdGhlIG5vZGUgd2hlcmUgdGhlICdzb3VyY2UnIGZpbGVuYW1lIGV4aXN0cyBpcyB0aGUgZmlsZSB0aGF0IHlvdSB3YW50IHRoZSBwcm9wcyBmb3IgXG4gICAgY29uc3QgcHJvcHMgPSBnZXRDb21wb25lbnRQcm9wcyhjb21wb25lbnQ/Ll9kZWJ1Z093bmVyKVxuICAgIGNvbnN0IG5hbWUgPSBnZXRDb21wb25lbnROYW1lKGNvbXBvbmVudD8uX2RlYnVnT3duZXIpXG4gICAgcmVzdWx0QXJyYXkucHVzaCh7XG4gICAgICBmaWxlbmFtZTogY29tcG9uZW50Py5fZGVidWdTb3VyY2U/LmZpbGVOYW1lLCBcbiAgICAgIC8vIHRoZSBsaW5lIG51bWJlciBpcyByZWFsbHkgZm9yIHRoZSBuZXh0IGNvbXBvbmVudCBkb3duIGluIHRoZSB0cmVlIHRoYXQgaXMgYmVpbmcgY2FsbGVkIGZyb20gdGhlICdmaWxlbmFtZSdcbiAgICAgIGxpbmVudW1iZXI6IGNvbXBvbmVudD8uX2RlYnVnU291cmNlPy5saW5lTnVtYmVyLCBcbiAgICAgIHByb3BzOiBwcm9wcywgXG4gICAgICBjb21wb25lbnROYW1lOiBuYW1lfSlcbiAgICByZXR1cm4gZ2V0Q29tcG9uZW50SW5mbyhjb21wb25lbnQ/Ll9kZWJ1Z093bmVyLG1heE5lc3QtMSxyZXN1bHRBcnJheSlcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZ2V0Q29tcG9uZW50SW5mbyhjb21wb25lbnQ/Ll9kZWJ1Z093bmVyLG1heE5lc3QtMSxyZXN1bHRBcnJheSlcbiAgfVxuXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb21wb25lbnRQcm9wcyhjb21wb25lbnQ6IGFueSwgcHJvcHMgPSB7fSk6IGFueSB7XG4gIGlmICghY29tcG9uZW50KSB7XG4gICAgZnVuY3Rpb25TdHJpbmdpZnkocHJvcHMpO1xuICAgIHJldHVybiBwcm9wcztcbiAgfVxuXG4gIGNvbnN0IG5ld1Byb3BzID0gY29tcG9uZW50LnBlbmRpbmdQcm9wc1xuICAgID8geyAuLi5wcm9wcywgLi4uY29tcG9uZW50LnBlbmRpbmdQcm9wcyB9XG4gICAgOiBwcm9wcztcbiAgZGVsZXRlIG5ld1Byb3BzLmNoaWxkcmVuO1xuXG4gIGlmIChcbiAgICBjb21wb25lbnQ/LnR5cGU/Ll9fcHJvdG9fXyAmJlxuICAgIFtcIkNvbXBvbmVudFwiLCBcIlB1cmVDb21wb25lbnRcIl0uaW5jbHVkZXMoY29tcG9uZW50LnR5cGUuX19wcm90b19fLm5hbWUpXG4gICkge1xuICAgIGZ1bmN0aW9uU3RyaW5naWZ5KG5ld1Byb3BzKTtcbiAgICByZXR1cm4gbmV3UHJvcHM7XG4gIH1cblxuICByZXR1cm4gZ2V0Q29tcG9uZW50UHJvcHMoY29tcG9uZW50Ll9kZWJ1Z093bmVyLCBuZXdQcm9wcyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb21wb25lbnROYW1lKGZpYmVyOiBhbnkpOiBhbnkge1xuICBpZiAoIWZpYmVyKSByZXR1cm4gbnVsbDtcblxuICBpZiAoZmliZXIuZWxlbWVudFR5cGUgJiYgZmliZXIuZWxlbWVudFR5cGUubmFtZSkge1xuICAgIHJldHVybiBmaWJlci5lbGVtZW50VHlwZS5uYW1lO1xuICB9XG5cbiAgaWYgKGZpYmVyLmVsZW1lbnRUeXBlICYmIGZpYmVyLmVsZW1lbnRUeXBlLmRpc3BsYXlOYW1lKSB7XG4gICAgcmV0dXJuIGZpYmVyLmVsZW1lbnRUeXBlLmRpc3BsYXlOYW1lO1xuICB9XG5cbiAgaWYgKGZpYmVyLnR5cGUuZGlzcGxheU5hbWUpIHtcbiAgICByZXR1cm4gZmliZXIudHlwZS5kaXNwbGF5TmFtZTtcbiAgfVxuXG4gIGlmIChmaWJlci50eXBlLm5hbWUpIHtcbiAgICByZXR1cm4gZmliZXIudHlwZS5uYW1lO1xuICB9XG4gIHJldHVybiBnZXRDb21wb25lbnROYW1lKGZpYmVyLl9kZWJ1Z093bmVyKTtcbn1cblxuY29uc3QgZXZlbnRzV2l0aENvb3JkaW5hdGVzOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge1xuICBtb3VzZXVwOiB0cnVlLFxuICBtb3VzZWRvd246IHRydWUsXG4gIG1vdXNlbW92ZTogdHJ1ZSxcbiAgbW91c2VvdmVyOiB0cnVlLFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvb3JkaW5hdGVzKGV2ZW50OiBFdmVudCk6IENvb3JkaW5hdGVzIHwgbnVsbCB7XG4gIGNvbnN0IG1vdXNlRXZlbnQgPSBldmVudCBhcyBNb3VzZUV2ZW50O1xuXG4gIHJldHVybiBldmVudHNXaXRoQ29vcmRpbmF0ZXNbZXZlbnQudHlwZV1cbiAgICA/IHsgeDogbW91c2VFdmVudC5jbGllbnRYLCB5OiBtb3VzZUV2ZW50LmNsaWVudFkgfVxuICAgIDogbnVsbDtcbn1cblxuLy8gbWFwIHJlYWN0IGNsYXNzZXMgdG8gZG9tIGVsZW1lbnRzXG5leHBvcnQgZnVuY3Rpb24gZmluZFJlYWN0RWxlbWVudCh0YXJnZXQ6IEV2ZW50VGFyZ2V0KTogYW55IHtcbiAgLy8gY29uc29sZS5kaXIodGFyZ2V0KVxuICBjb25zdCBrZXkgPSBPYmplY3Qua2V5cyh0YXJnZXQpLmZpbmQoKGtleSkgPT5cbiAgICBrZXkuc3RhcnRzV2l0aChcIl9fcmVhY3RJbnRlcm5hbEluc3RhbmNlJFwiKVxuICApO1xuICAvLyBjb25zb2xlLmxvZygna2V5OiAnLCBrZXkpXG4gIC8vIGNyZWF0ZXMgYW4gb2JqZWN0IG91dCBvZiB0aGUgdGFyZ2V0IHBhc3NlZFxuICBjb25zdCB0YXJnZXRNYXAgPSB0YXJnZXQgYXMgeyBba2V5OiBzdHJpbmddOiBhbnkgfTtcblxuICBjb25zdCBpbnRlcm5hbEluc3RhbmNlID0ga2V5ID8gdGFyZ2V0TWFwW2tleV0gOiBudWxsO1xuICAvLyBjb25zb2xlLmxvZygnUmVhY3QgTm9kZSBpZiBGb3VuZDogJywgaW50ZXJuYWxJbnN0YW5jZSlcbiAgaWYgKGludGVybmFsSW5zdGFuY2UgPT0gbnVsbCkgcmV0dXJuIG51bGw7XG5cbiAgLy8gY29uc29sZS5sb2coJ2ludGVybmFsSW5zdGFuY2UyOiAnLCBpbnRlcm5hbEluc3RhbmNlKVxuICAvLyByZXR1cm4gaW50ZXJuYWxJbnN0YW5jZS5fZGVidWdPd25lclxuICAvLyAgID8gaW50ZXJuYWxJbnN0YW5jZS5fZGVidWdPd25lci5zdGF0ZU5vZGVcbiAgLy8gICA6IGludGVybmFsSW5zdGFuY2UucmV0dXJuLnN0YXRlTm9kZTtcblxuICByZXR1cm4gaW50ZXJuYWxJbnN0YW5jZTtcblxuICAvLyBmb3IgKGxldCBrZXk6IHN0cmluZyBpbiB0YXJnZXQpIHtcbiAgLy8gICBpZiAoa2V5LnN0YXJ0c1dpdGgoXCJfX3JlYWN0SW50ZXJuYWxJbnN0YW5jZSRcIikpIHtcbiAgLy8gICAgIC8vIGNvbnNvbGUubG9nKCdrZXlzIGluIHRoZSBmaW5kIFJlYWN0RWxlbWVudCcsIHRhcmdldFtrZXldKVxuICAvLyAgICAgcmV0dXJuIHRhcmdldFtrZXldO1xuICAvLyAgIH1cbiAgLy8gfVxuICAvLyByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZ1bmN0aW9uU3RyaW5naWZ5KG9iajogYW55KTogdm9pZCB7XG4gIGZvciAobGV0IGsgaW4gb2JqKSB7XG4gICAgaWYgKG9ialtrXSAmJiB7fS50b1N0cmluZy5jYWxsKG9ialtrXSkgPT09IFwiW29iamVjdCBGdW5jdGlvbl1cIikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gb2JqW2tdID0gXCJcIiArIG9ialtrXTtcbiAgICAgICAgLy8gLy8gZ2V0IHJpZCBvZiB0aGUgZXh0cmEgbGluZSBtYXJrZXJzXG4gICAgICAgIC8vIG9ialtrXSA9IG9ialtrXS5yZXBsYWNlKC8oXFxyXFxufFxcbnxcXHIpL2dtLCBcIlwiKTtcbiAgICAgICAgb2JqW2tdID0gXCJbRnVuY3Rpb25dXCJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHN0cmluZ2lmeWluZyBwcm9wXCIsIGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBzdHJpcEV4dHJhQ29tcG9uZW50UHJvcHMob2JqKTtcbn1cblxuXG5cbmZ1bmN0aW9uIHN0cmlwRXh0cmFDb21wb25lbnRQcm9wcyhwcm9wczogYW55KTogdm9pZCB7XG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhwcm9wcyk7XG4gIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICBpZiAoXG4gICAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwocHJvcHNba2V5XSkgPT09IFwiW29iamVjdCBPYmplY3RdXCIgJiZcbiAgICAgIChwcm9wc1trZXldLmhhc093blByb3BlcnR5KFwiX293bmVyXCIpIHx8XG4gICAgICAgIGtleSA9PT0gXCJpbnB1dFJlZlwiIHx8XG4gICAgICAgIGtleSA9PT0gXCJJbnB1dFByb3BzXCIpXG4gICAgKSB7XG4gICAgICBkZWxldGUgcHJvcHNba2V5XTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCB7IEV2ZW50VHlwZSwgUmVjb25jaWxlVHlwZSB9IGZyb20gXCIuL3R5cGVzL0V2ZW50VHlwZVwiO1xuaW1wb3J0IHsgUmVjb3JkZXJDb25maWcgfSBmcm9tIFwiLi90eXBlcy9SZWNvcmRlckNvbmZpZ1wiO1xuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIGludGVyZmFjZSBXaW5kb3cge1xuICAgIHJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzOiBib29sZWFuO1xuICAgIGRhdGFMYXllcjogYW55W107XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXZlbnRSZWNvcmRlciB7XG4gIHByaXZhdGUgZXZlbnRDYWxsYmFjazogKGV2ZW50OiBFdmVudCkgPT4gYW55O1xuICBwcml2YXRlIHJlY29uY2lsZUNhbGxiYWNrOiAoZXZlbnQ6IEV2ZW50KSA9PiBhbnk7XG4gIHByaXZhdGUgcmVjb3JkRXZlbnRzOiBFdmVudFR5cGVbXSA9IFtdO1xuICBwcml2YXRlIHJlY29uY2lsZUV2ZW50czogUmVjb25jaWxlVHlwZVtdID0gW1wiYmx1clwiLCBcImZvY3VzXCIsIFwiY2hhbmdlXCJdO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogUmVjb3JkZXJDb25maWcpIHtcbiAgICBjb25zdCB7XG4gICAgICBldmVudENhbGxiYWNrLFxuICAgICAgcmVjb25jaWxlQ2FsbGJhY2ssXG4gICAgICByZWNvcmRFdmVudHMsXG4gICAgICByZWNvbmNpbGVFdmVudHMgPSBudWxsLFxuICAgIH0gPSBjb25maWc7XG4gICAgdGhpcy5ldmVudENhbGxiYWNrID0gZXZlbnRDYWxsYmFjaztcbiAgICB0aGlzLnJlY29uY2lsZUNhbGxiYWNrID0gcmVjb25jaWxlQ2FsbGJhY2s7XG4gICAgdGhpcy5yZWNvcmRFdmVudHMgPSByZWNvcmRFdmVudHM7XG4gICAgaWYgKHJlY29uY2lsZUV2ZW50cykge1xuICAgICAgdGhpcy5yZWNvbmNpbGVFdmVudHMgPSByZWNvbmNpbGVFdmVudHM7XG4gICAgfVxuICB9XG5cbiAgYWRkQWxsTGlzdGVuZXJzID0gKCkgPT4ge1xuICAgIHRoaXMucmVjb3JkRXZlbnRzLmZvckVhY2goKGV2ZW50KSA9PiB7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5ldmVudENhbGxiYWNrLCB0cnVlKTtcbiAgICB9KTtcblxuICAgIHRoaXMucmVjb25jaWxlRXZlbnRzLmZvckVhY2goKGV2ZW50KSA9PiB7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5yZWNvbmNpbGVDYWxsYmFjaywgdHJ1ZSk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmVtb3ZlQWxsTGlzdGVuZXJzID0gKCkgPT4ge1xuICAgIHRoaXMucmVjb3JkRXZlbnRzLmZvckVhY2goKGV2ZW50KSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5ldmVudENhbGxiYWNrLCB0cnVlKTtcbiAgICB9KTtcbiAgICB0aGlzLnJlY29uY2lsZUV2ZW50cy5mb3JFYWNoKChldmVudDogUmVjb25jaWxlVHlwZSkgPT4ge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMucmVjb25jaWxlQ2FsbGJhY2ssIHRydWUpO1xuICAgIH0pO1xuICB9O1xuXG4gIHN0YXJ0ID0gKCkgPT4ge1xuICAgIGlmICghd2luZG93LnJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzKSB7XG4gICAgICB0aGlzLmFkZEFsbExpc3RlbmVycygpO1xuICAgICAgd2luZG93LnJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzID0gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgc3RvcCA9ICgpID0+IHtcbiAgICBpZiAod2luZG93LnJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzKSB7XG4gICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICAgICAgd2luZG93LnJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzID0gZmFsc2U7XG4gICAgfVxuICB9O1xufVxuIiwiaW1wb3J0IHtcbiAgZmluZFJlYWN0RWxlbWVudCxcbiAgZ2V0Q29vcmRpbmF0ZXMsXG4gIGdldENvbXBvbmVudE5hbWUsXG4gIGdldENvbXBvbmVudFByb3BzLFxuICBnZXRDb21wb25lbnRJbmZvXG59IGZyb20gXCIuL3V0aWxzXCI7XG5cblxuaW1wb3J0IEV2ZW50UmVjb3JkZXIgZnJvbSBcIi4vZXZlbnQtcmVjb3JkZXJcIjtcbmltcG9ydCBDbGllbnRJbnRlcmZhY2UgZnJvbSBcIi4vdHlwZXMvQ2xpZW50XCI7XG5pbXBvcnQgTWVzc2FnZSBmcm9tIFwiLi90eXBlcy9NZXNzYWdlXCI7XG5pbXBvcnQgeyBFdmVudFR5cGUgfSBmcm9tIFwiLi90eXBlcy9FdmVudFR5cGVcIjtcblxuaW50ZXJmYWNlIENvbXBvbmVudCB7IH1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXNzZXJ0bHlDbGllbnQgaW1wbGVtZW50cyBDbGllbnRJbnRlcmZhY2Uge1xuICBldmVudHNUb1JlY29yZDogRXZlbnRUeXBlW10gPSBbXCJjbGlja1wiLCBcImNoYW5nZVwiXTtcblxuICBwcml2YXRlIGV2ZW50UmVjb3JkZXI6IEV2ZW50UmVjb3JkZXI7XG4gIHByaXZhdGUgY29tcG9uZW50RXZlbnRDYWNoZTogTWVzc2FnZVtdID0gW107XG4gIHByaXZhdGUgcHJldmlvdXNDb21wb25lbnQ6IENvbXBvbmVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHByZXZpb3VzTXNnOiBNZXNzYWdlIHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5ldmVudFJlY29yZGVyID0gbmV3IEV2ZW50UmVjb3JkZXIoe1xuICAgICAgcmVjb3JkRXZlbnRzOiB0aGlzLmV2ZW50c1RvUmVjb3JkLFxuICAgICAgZXZlbnRDYWxsYmFjazogdGhpcy5yZWNvcmRFdmVudCxcbiAgICAgIHJlY29uY2lsZUNhbGxiYWNrOiB0aGlzLnJlY29uY2lsZUV2ZW50Q2FjaGUsXG4gICAgfSk7XG4gIH1cblxuICBzdGFydCA9ICgpID0+IHtcbiAgICB0aGlzLmV2ZW50UmVjb3JkZXIuc3RhcnQoKTtcbiAgfTtcblxuICBzdG9wID0gKCkgPT4ge1xuICAgIHRoaXMuZXZlbnRSZWNvcmRlci5zdG9wKCk7XG4gIH07XG5cbiAgY2xlYXJFdmVudENhY2hlID0gKCkgPT4ge1xuICAgIHRoaXMuY29tcG9uZW50RXZlbnRDYWNoZSA9IFtdO1xuICB9O1xuXG4gIHJlY29uY2lsZUV2ZW50Q2FjaGUgPSAoZXZlbnQ6IEV2ZW50KSA9PiB7XG4gICAgY29uc3QgcmVhY3RDb21wb25lbnQgPSBldmVudC50YXJnZXQgPyBmaW5kUmVhY3RFbGVtZW50KGV2ZW50LnRhcmdldCkgOiBudWxsO1xuICAgIGlmIChyZWFjdENvbXBvbmVudCAhPT0gdGhpcy5wcmV2aW91c0NvbXBvbmVudCkge1xuICAgICAgdGhpcy5jb21wb25lbnRFdmVudENhY2hlLmZvckVhY2goKG1zZykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnaW4gdGhlIHJlY29uY2lsZScpXG4gICAgICAgIHRoaXMuc2VuZEV2ZW50KG1zZyk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY2xlYXJFdmVudENhY2hlKCk7XG4gICAgfVxuICB9O1xuXG4gIGNyZWF0ZVBvcHVwTWVudSA9IChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XG5cbiAgICBjb25zdCBldmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICAgIGNvbnN0IGRpdklEID0gXCJjb21wb25lbnRNZW51XCIgKyBldmVudFRpbWVcbiAgICBjb25zdCBtb3VzZUV2ZW50ID0gZXZlbnQgYXMgTW91c2VFdmVudDtcbiAgICBjb25zdCBtZW51RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkRJVlwiKTtcblxuICAgIGNvbnN0IHByZXZpb3VzTWVudXMgPSBBcnJheS5mcm9tKGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbXBvbmVudE1lbnUnKSk7XG4gICAgcHJldmlvdXNNZW51cz8ubWFwKCh2YWw6IGFueSkgPT4gdmFsLnJlbW92ZSgpKVxuXG4gICAgbWVudURpdi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBkaXZJRCk7XG4gICAgbWVudURpdi5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCAnY29tcG9uZW50TWVudScpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobWVudURpdik7XG4gICAgbWVudURpdi5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICBtZW51RGl2LnN0eWxlLmxlZnQgPSBtb3VzZUV2ZW50LnggKyAncHgnO1xuICAgIG1lbnVEaXYuc3R5bGUudG9wID0gbW91c2VFdmVudC55ICsgJ3B4JztcbiAgICBtZW51RGl2LnN0eWxlLnpJbmRleCA9ICc1JztcblxuICAgIG1lc3NhZ2U/LmNvbXBvbmVudEluZm8/Lm1hcCgodmFsOiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJCVVRUT05cIik7XG4gICAgICBidG4uc3R5bGUud2lkdGggPSAnMTUwcHgnO1xuICAgICAgYnRuLmlubmVySFRNTCA9IHZhbD8uY29tcG9uZW50TmFtZTtcbiAgICAgIGlmIChidG4uaW5uZXJIVE1MKSB7XG4gICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuY29tcG9uZW50TWVudUNsaWNrKGV2ZW50LCBkaXZJRCwgbWVzc2FnZSkpXG4gICAgICAgIG1lbnVEaXYuYXBwZW5kQ2hpbGQoYnRuKTtcbiAgICAgICAgY29uc3QgYnIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnJcIik7XG4gICAgICAgIG1lbnVEaXYuYXBwZW5kQ2hpbGQoYnIpO1xuICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBDYW5jZWxCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiQlVUVE9OXCIpO1xuICAgIENhbmNlbEJ0bi5zdHlsZS53aWR0aCA9ICcxNTBweCc7XG4gICAgQ2FuY2VsQnRuLmlubmVySFRNTCA9ICdDYW5jZWwnO1xuICAgIENhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMucmVtb3ZlU2luZ2xlTWVudShkaXZJRCkpXG4gICAgbWVudURpdi5hcHBlbmRDaGlsZChDYW5jZWxCdG4pO1xuICB9XG5cbiAgcmVtb3ZlU2luZ2xlTWVudSA9IChkaXZJRDogYW55KSA9PiB7XG4gICAgY29uc3QgbWVudURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRpdklEKTtcbiAgICBtZW51RGl2Py5yZW1vdmUoKVxuICB9XG5cbiAgY29tcG9uZW50TWVudUNsaWNrID0gKGV2ZW50OiBhbnksIGRpdklEOiBhbnksIG1lc3NhZ2U6IE1lc3NhZ2UpOiBhbnkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCd0aGlzIGlzIHRoZSBjbGljayBjYWxsIGJhY2s6ICcsIGV2ZW50KVxuXG4gICAgY29uc3Qgc2VsZWN0ZWRDb21wb25lbnQgPSBtZXNzYWdlLmNvbXBvbmVudEluZm8/LnJlZHVjZShcbiAgICAgIChhY2M6IGFueSwgY3VycjogYW55KSA9PiB7XG4gICAgICAgIGlmIChjdXJyLmNvbXBvbmVudE5hbWUgPT09IGV2ZW50LnRhcmdldD8uaW5uZXJIVE1MKSB7XG4gICAgICAgICAgcmV0dXJuIHsgLi4uY3VyciB9XG4gICAgICAgIH0gZWxzZSB7IHJldHVybiBhY2MgfVxuICAgICAgfSwgbnVsbClcblxuICAgIGV2ZW50Py5zdG9wUHJvcGFnYXRpb24oKVxuICAgIHRoaXMuc2VuZEV2ZW50KHtcbiAgICAgIC4uLm1lc3NhZ2UsXG4gICAgICAvLyB0aGVyZSBzaG91bGQgb25seSBiZSBvbmUgbWF0Y2ggaGVyZSBvbiB0aGUgZmlsdGVyXG4gICAgICAvLyBjb21wb25lbnRJbmZvOiBtZXNzYWdlLmNvbXBvbmVudEluZm8/LmZpbHRlciggKHZhbDphbnkpID0+IHZhbC5jb21wb25lbnROYW1lID09PSBldmVudC50YXJnZXQ/LmlubmVySFRNTClcbiAgICAgIGNvbXBvbmVudEluZm86IHNlbGVjdGVkQ29tcG9uZW50XG4gICAgfSlcblxuICAgIHRoaXMucmVtb3ZlU2luZ2xlTWVudShkaXZJRClcbiAgICAvLyBjb25zdCBtZW51RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGl2SUQpO1xuICAgIC8vIG1lbnVEaXY/LnJlbW92ZSgpXG5cbiAgfVxuXG4gIGdldE1lc3NhZ2UgPSAocmVhY3RDb21wb25lbnQ6IGFueSwgZXZlbnQ6IEtleWJvYXJkRXZlbnQgfCBFdmVudCk6IE1lc3NhZ2UgPT4ge1xuXG4gICAgLy8gZnVuY3Rpb24gdG8gdXNlIGluIGFycmF5IHJlZHVjZVxuICAgIGNvbnN0IGZpbmRDbGlja0hhbmRsZXIgPSAoYWNjdW11bGF0b3I6IGFueSwgY3VycmVudFZhbHVlOiBhbnkpID0+IHtcbiAgICAgIGlmIChjdXJyZW50VmFsdWUucHJvcHM/Lm9uQ2xpY2spIHtcbiAgICAgICAgcmV0dXJuIHsuLi5jdXJyZW50VmFsdWV9XG4gICAgICB9IGVsc2UgeyByZXR1cm4gYWNjdW11bGF0b3IgfVxuICAgIH07XG5cbiAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQgfHwgZXZlbnQuc3JjRWxlbWVudDtcbiAgICBjb25zdCBpbnB1dFRhcmdldCA9IHRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGxpbmtUYXJnZXQgPSB0YXJnZXQgYXMgSFRNTExpbmtFbGVtZW50O1xuXG4gICAgY29uc3QgY29tcG9uZW50SW5mbyA9IGdldENvbXBvbmVudEluZm8ocmVhY3RDb21wb25lbnQsIDEwLCBbXSlcblxuICAgIC8vIGZpbmQgdGhlIGNsb3Nlc3QgY2xpY2sgaGFuZGxlciB0aGF0IHdvdWxkIGhhdmUgYmVlbiB0cmlnZ2VyZWRcbiAgICBjb25zdCBjbGlja0hhbmRsZXIgPSBjb21wb25lbnRJbmZvPy5zbGljZSgwKT8ucmV2ZXJzZSgpPy5yZWR1Y2UoZmluZENsaWNrSGFuZGxlciwgbnVsbClcblxuXG4gICAgLy8gY29uc29sZS5sb2coJ2NvbXBvbmVudCBpbmZvIGluIEdFVF9NRVNTQUdFOiAnLCBjb21wb25lbnRJbmZvLCBjbGlja0hhbmRsZXIpXG5cbiAgICBjb25zdCBtZXNzYWdlOiBNZXNzYWdlID0ge1xuICAgICAgLy8gY29tcG9uZW50TmFtZSwgZmlsZU5hbWUsIGFuZCBsaW5lTnVtYmVyIGFyZSBhbHJlYWR5IGluIHRoZSBvYmplY3QgcmV0dXJuZWRcbiAgICAgIGFjdGlvbjogZXZlbnQudHlwZSxcbiAgICAgIGNoZWNrZWQ6IGV2ZW50Py50YXJnZXQ/Lmhhc093blByb3BlcnR5KFwiY2hlY2tlZFwiKVxuICAgICAgICA/IGlucHV0VGFyZ2V0LmNoZWNrZWRcbiAgICAgICAgOiBudWxsLFxuICAgICAgY29vcmRpbmF0ZXM6IGdldENvb3JkaW5hdGVzKGV2ZW50KSxcbiAgICAgIGhyZWY6IGxpbmtUYXJnZXQuaHJlZiA/IGxpbmtUYXJnZXQuaHJlZiA6IG51bGwsXG4gICAgICBrZXlDb2RlOiAoZXZlbnQgYXMgS2V5Ym9hcmRFdmVudCkua2V5Q29kZVxuICAgICAgICA/IChldmVudCBhcyBLZXlib2FyZEV2ZW50KS5rZXlDb2RlXG4gICAgICAgIDogbnVsbCxcbiAgICAgIHRhZ05hbWU6IGlucHV0VGFyZ2V0LnRhZ05hbWUsXG4gICAgICB0YWdUeXBlOiBpbnB1dFRhcmdldC50eXBlLFxuICAgICAgdGV4dENvbnRlbnQ6IGlucHV0VGFyZ2V0LnRleHRDb250ZW50IHx8IGlucHV0VGFyZ2V0LmlubmVyVGV4dCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS5nZXRUaW1lKCksXG4gICAgICB2YWx1ZTogaW5wdXRUYXJnZXQudmFsdWUsXG4gICAgICB3cml0ZVRlc3RMb2NhdGlvbjogJycsXG4gICAgICBjb21wb25lbnRJbmZvOiBjb21wb25lbnRJbmZvLFxuICAgICAgY2xpY2tIYW5kbGVyQ29tcG9uZW50OiBjbGlja0hhbmRsZXJcblxuICAgIH07XG5cbiAgICByZXR1cm4gbWVzc2FnZVxuICB9O1xuXG5cblxuICByZWNvcmRFdmVudCA9IChldmVudDogRXZlbnQpID0+IHtcbiAgICBjb25zdCBub2RlVGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIE5vZGU7XG4gICAgY29uc3QgbW91c2VFdmVudCA9IGV2ZW50IGFzIE1vdXNlRXZlbnQ7XG5cbiAgICAvLyBpZiB0aGUgY2xpY2sgaXMgb24gYSBtZW51IHRoYXQgcG9wcyB1cCwgZG9udCBnbyB0aHJvdWdoIHRoZSByZWNvcmQgZXZlbnQgbG9naWNcbiAgICBpZiAobm9kZVRhcmdldD8ucGFyZW50RWxlbWVudD8uZ2V0QXR0cmlidXRlKFwiaWRcIik/LmluY2x1ZGVzKCdjb21wb25lbnRNZW51JykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFldmVudC50YXJnZXQpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBpZiAodGhpcy5wcmV2aW91c01zZykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgKGV2ZW50LnR5cGUgPT09IFwiY2hhbmdlXCIgfHwgZXZlbnQudHlwZSA9PT0gXCJjbGlja1wiKSAmJlxuICAgICAgICAgIHRoaXMucHJldmlvdXNNc2cgJiZcbiAgICAgICAgICB0aGlzLnByZXZpb3VzTXNnLmFjdGlvbiA9PT0gXCJjbGlja1wiICYmXG4gICAgICAgICAgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLnByZXZpb3VzTXNnLnRpbWVzdGFtcCA8IDEwMFxuICAgICAgICApIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIm1lc3NhZ2Ugbm90IHNlbmQgZHVlIHRvIHRpbWVcIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlYWN0Q29tcG9uZW50ID0gZmluZFJlYWN0RWxlbWVudChldmVudC50YXJnZXQpO1xuICAgICAgY29uc3QgbXNnOiBNZXNzYWdlID0gdGhpcy5nZXRNZXNzYWdlKHJlYWN0Q29tcG9uZW50LCBldmVudCk7XG4gICAgICBjb25zb2xlLmxvZygncmVhY3RDb21wb25lbnQgYW5kIG1lc3NhZ2UgaW4gUkVDT1JEX0VWRU5UOiAnLCByZWFjdENvbXBvbmVudCwgbXNnKVxuXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImxhc3RFdmVudFwiLCBKU09OLnN0cmluZ2lmeShtc2cpKTtcbiAgICAgIHRoaXMucHJldmlvdXNNc2cgPSBtc2c7XG5cbiAgICAgIC8vIGlmIChcbiAgICAgIC8vICAgLy8gaWYgdGhlcmUgaXMgbm8gcHJldmlvdXMgY29tcG9uZW50IG9yIHRoZSBwcmV2aW91cyBjb21wb25lbnQgaXMgdGhlIHNhbWUgYXMgdGhlIGNvbXBvbmVudCB5b3UganVzdCBjbGlja2VkIG9uXG4gICAgICAvLyAgICF0aGlzLnByZXZpb3VzQ29tcG9uZW50IHx8XG4gICAgICAvLyAgICh0aGlzLnByZXZpb3VzQ29tcG9uZW50ICYmIHRoaXMucHJldmlvdXNDb21wb25lbnQgPT09IHJlYWN0Q29tcG9uZW50KVxuICAgICAgLy8gKSB7XG4gICAgICAvLyAgIHRoaXMucHJldmlvdXNDb21wb25lbnQgPSByZWFjdENvbXBvbmVudDtcbiAgICAgIC8vICAgaWYgKFxuICAgICAgLy8gICAgIHRoaXMucHJldmlvdXNDb21wb25lbnQgJiZcbiAgICAgIC8vICAgICBtc2cuY2hlY2tlZCAhPT0gbnVsbCAmJlxuICAgICAgLy8gICAgIG1zZy5hY3Rpb24gPT09IFwiY2xpY2tcIlxuICAgICAgLy8gICApIHtcbiAgICAgIC8vICAgICAvLyBtZXNzYWdlIGlzIHNlbnQgd2hlbiBzb21ldGhpbmcgaW4gdGhlIHBvcHVwIG1lbnUgaXMgc2VsZWN0ZWRcbiAgICAgIC8vICAgICB0aGlzLmNyZWF0ZVBvcHVwTWVudShtc2cpO1xuICAgICAgLy8gICAgIC8vIHRoaXMuc2VuZEV2ZW50KG1zZyk7XG4gICAgICAvLyAgICAgcmV0dXJuO1xuICAgICAgLy8gICB9XG5cbiAgICAgIC8vICAgLy9wdXNoaW5nIGEgbWVzc2FnZSB0byB0aGUgZXZlbnQgY2FjaGUgc2VuZHMgaXQgdG8gdGhlIGFwaSB3aGVuIHRoZSByZWNvbmNpbGUgY2FsbGJhY2sgaXMgY2FsbGVkXG4gICAgICAvLyAgIHRoaXMuY29tcG9uZW50RXZlbnRDYWNoZS5wdXNoKG1zZyk7XG5cbiAgICAgIC8vICAgcmV0dXJuO1xuICAgICAgLy8gfSBlbHNlIHtcbiAgICAgIC8vICAgdGhpcy5jbGVhckV2ZW50Q2FjaGUoKTtcbiAgICAgIC8vIH1cblxuICAgICAgdGhpcy5wcmV2aW91c0NvbXBvbmVudCA9IHJlYWN0Q29tcG9uZW50O1xuXG4gICAgICAvLyBtZXNzYWdlIGlzIHNlbnQgd2hlbiBzb21ldGhpbmcgaW4gdGhlIHBvcHVwIG1lbnUgaXMgc2VsZWN0ZWRcbiAgICAgIGlmIChtb3VzZUV2ZW50Py5tZXRhS2V5KSB0aGlzLmNyZWF0ZVBvcHVwTWVudShtc2cpO1xuICAgICAgLy8gdGhpcy5zZW5kRXZlbnQobXNnKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVjb3JkaW5nIGV2ZW50XCIsIGUpO1xuICAgIH1cbiAgfTtcblxuICBzZW5kRXZlbnQgPSBhc3luYyAobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xuICAgIC8vIGNvbnN0IGFjY291bnRJZCA9IHdpbmRvd1tcImRhdGFMYXllclwiXVswXVtcImFwaUtleVwiXTtcbiAgICBjb25zdCBhY2NvdW50SWQgPSAod2luZG93IGFzIHsgW2tleTogc3RyaW5nXTogYW55IH0pW1wiZGF0YUxheWVyXCJdWzBdW1wiYXBpS2V5XCJdXG4gICAgY29uc3Qgd3JpdGVMb2NhdGlvbiA9ICh3aW5kb3cgYXMgeyBba2V5OiBzdHJpbmddOiBhbnkgfSlbXCJkYXRhTGF5ZXJcIl1bMF1bXCJ0ZXN0TG9jYXRpb25cIl1cbiAgICBjb25zdCB1cmwgPSBgLy9sb2NhbGhvc3Q6MzAwMi9hcGkvYWNjb3VudHMvJHthY2NvdW50SWR9L2V2ZW50cy9gO1xuICAgIC8vIGNvbnNvbGUubG9nKCd0aGlzIGlzIHRoZSBtZXNzYWdlOiAnLCBtZXNzYWdlKTtcbiAgICAvLyBjb25zb2xlLmxvZygndGhpcyBpcyB0aGUgd3JpdGUgbG9jYXRpb246ICcsIHdyaXRlTG9jYXRpb24sIGFjY291bnRJZCk7XG4gICAgY29uc29sZS5sb2coJ3RoaXMgaXMgdGhlIG1lc3NhZ2UgaW4gU0VORF9FVkVOVDogJywgbWVzc2FnZSlcblxuICAgIG1lc3NhZ2Uud3JpdGVUZXN0TG9jYXRpb24gPSB3cml0ZUxvY2F0aW9uXG5cblxuICAgIGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIG1vZGU6IFwiY29yc1wiLFxuICAgICAgY2FjaGU6IFwibm8tY2FjaGVcIixcbiAgICAgIGNyZWRlbnRpYWxzOiBcInNhbWUtb3JpZ2luXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdXJsOiB3aW5kb3cubG9jYXRpb24uaHJlZixcbiAgICAgICAgZXZlbnQ6IG1lc3NhZ2UsXG4gICAgICAgIC8vIFRPRE86IHRlc3Qgc2V0IGlkIHNob3VsZCBiZSBzZXQgd2hlbiBjcmVhdGluZy9sb2FkaW5nIHRlc3RzZXQgaW4gdGhlIHJ1bm5lclxuICAgICAgICBwbGFjZWhvbGRlcjogbnVsbCxcbiAgICAgIH0pLFxuICAgIH0pO1xuICB9O1xufVxuXG4oPGFueT53aW5kb3cpLmV2ZW50UmVjb3JkZXIgPSBuZXcgQXNzZXJ0bHlDbGllbnQoKTtcbig8YW55PndpbmRvdykuZXZlbnRSZWNvcmRlci5zdGFydCgpO1xuXG4iXSwic291cmNlUm9vdCI6IiJ9