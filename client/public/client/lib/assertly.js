!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function o(e,t){var n,r,i;return e&&0!==t?(null===(n=null==e?void 0:e._debugSource)||void 0===n?void 0:n.fileName)?{filename:null===(r=null==e?void 0:e._debugSource)||void 0===r?void 0:r.fileName,linenumber:null===(i=null==e?void 0:e._debugSource)||void 0===i?void 0:i.lineNumber}:o(null==e?void 0:e._debugOwner,t-1):null}function r(e){return e?e.elementType&&e.elementType.name?e.elementType.name:e.elementType&&e.elementType.displayName?e.elementType.displayName:e.type.displayName?e.type.displayName:e.type.name?e.type.name:r(e._debugOwner):null}n.r(t),n.d(t,"default",(function(){return d}));const i={mouseup:!0,mousedown:!0,mousemove:!0,mouseover:!0};function s(e){const t=e;return i[e.type]?{x:t.clientX,y:t.clientY}:null}function c(e){const t=Object.keys(e).find(e=>e.startsWith("__reactInternalInstance$")),n=t?e[t]:null;return console.log("React Node if Found: ",n),null==n?null:n}function l(e){for(let t in e)if(e[t]&&"[object Function]"==={}.toString.call(e[t]))try{e[t]="[Function]"}catch(e){console.error("Error stringifying prop",e)}!function(e){const t=Object.keys(e);for(const n of t)"[object Object]"!==Object.prototype.toString.call(e[n])||!e[n].hasOwnProperty("_owner")&&"inputRef"!==n&&"InputProps"!==n||delete e[n]}(e)}class a{constructor(e){this.recordEvents=[],this.reconcileEvents=["blur","focus","change"],this.addAllListeners=()=>{this.recordEvents.forEach(e=>{window.addEventListener(e,this.eventCallback,!0)}),this.reconcileEvents.forEach(e=>{window.addEventListener(e,this.reconcileCallback,!0)})},this.removeAllListeners=()=>{this.recordEvents.forEach(e=>{window.removeEventListener(e,this.eventCallback,!0)}),this.reconcileEvents.forEach(e=>{window.removeEventListener(e,this.reconcileCallback,!0)})},this.start=()=>{window.recorderAddedControlListeners||(this.addAllListeners(),window.recorderAddedControlListeners=!0)},this.stop=()=>{window.recorderAddedControlListeners&&(this.removeAllListeners(),window.recorderAddedControlListeners=!1)};const{eventCallback:t,reconcileCallback:n,recordEvents:o,reconcileEvents:r=null}=e;this.eventCallback=t,this.reconcileCallback=n,this.recordEvents=o,r&&(this.reconcileEvents=r)}}var u=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function c(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}l((o=o.apply(e,t||[])).next())}))};class d{constructor(){this.eventsToRecord=["click","change"],this.componentEventCache=[],this.previousComponent=null,this.previousMsg=null,this.start=()=>{this.eventRecorder.start()},this.stop=()=>{this.eventRecorder.stop()},this.clearEventCache=()=>{this.componentEventCache=[]},this.reconcileEventCache=e=>{(e.target?c(e.target):null)!==this.previousComponent&&(this.componentEventCache.forEach(e=>{this.sendEvent(e)}),this.clearEventCache())},this.getMessage=(e,t)=>{var n,i,c;const a=t.target||t.srcElement,u=a,d=a,v=function e(t,n={}){var o;if(!t)return l(n),n;const r=t.pendingProps?Object.assign(Object.assign({},n),t.pendingProps):n;return delete r.children,(null===(o=null==t?void 0:t.type)||void 0===o?void 0:o.__proto__)&&["Component","PureComponent"].includes(t.type.__proto__.name)?(l(r),r):e(t._debugOwner,r)}(e);return{action:t.type,checked:(null===(n=null==t?void 0:t.target)||void 0===n?void 0:n.hasOwnProperty("checked"))?u.checked:null,componentName:r(null==e?void 0:e._debugOwner),coordinates:s(t),filename:null===(i=o(e,10))||void 0===i?void 0:i.filename,linenumber:null===(c=o(e,10))||void 0===c?void 0:c.linenumber,href:d.href?d.href:null,keyCode:t.keyCode?t.keyCode:null,props:v,tagName:u.tagName,tagType:u.type,textContent:u.textContent||u.innerText,timestamp:(new Date).getTime(),value:u.value}},this.recordEvent=e=>{const t=e.target;if((!this.previousMsg||this.previousMsg.timestamp!==e.timeStamp)&&("load"!==e.type||"#document"!==t.nodeName)&&e.target)try{if(this.previousMsg&&("change"===e.type||"click"===e.type)&&this.previousMsg&&"click"===this.previousMsg.action&&(new Date).getTime()-this.previousMsg.timestamp<100)return void console.log("message not send due to time");const t=c(e.target);console.log("reactComponent: ",t);const n=this.getMessage(t,e);if(console.log("record event msg",n),localStorage.setItem("lastEvent",JSON.stringify(n)),this.previousMsg=n,!this.previousComponent||this.previousComponent&&this.previousComponent===t)return this.previousComponent=t,this.previousComponent&&null!==n.checked&&"click"===n.action?void this.sendEvent(n):void this.componentEventCache.push(n);this.clearEventCache(),this.previousComponent=t,this.sendEvent(n)}catch(e){console.error("Error recording event",e)}},this.sendEvent=e=>u(this,void 0,void 0,(function*(){const t=`//localhost:3002/api/accounts/${window.dataLayer[0].apiKey}/events/`;yield fetch(t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:window.location.href,event:[e],placeholder:null})})})),this.eventRecorder=new a({recordEvents:this.eventsToRecord,eventCallback:this.recordEvent,reconcileCallback:this.reconcileEventCache})}}window.eventRecorder=new d,window.eventRecorder.start()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovLy8uL3NyYy9ldmVudC1yZWNvcmRlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY2xpZW50LnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZ2V0Q29tcG9uZW50RmlsZU5hbWUiLCJjb21wb25lbnQiLCJtYXhOZXN0IiwiX2RlYnVnU291cmNlIiwiZmlsZU5hbWUiLCJmaWxlbmFtZSIsImxpbmVudW1iZXIiLCJsaW5lTnVtYmVyIiwiX2RlYnVnT3duZXIiLCJnZXRDb21wb25lbnROYW1lIiwiZmliZXIiLCJlbGVtZW50VHlwZSIsImRpc3BsYXlOYW1lIiwidHlwZSIsImV2ZW50c1dpdGhDb29yZGluYXRlcyIsIm1vdXNldXAiLCJtb3VzZWRvd24iLCJtb3VzZW1vdmUiLCJtb3VzZW92ZXIiLCJnZXRDb29yZGluYXRlcyIsImV2ZW50IiwibW91c2VFdmVudCIsIngiLCJjbGllbnRYIiwieSIsImNsaWVudFkiLCJmaW5kUmVhY3RFbGVtZW50IiwidGFyZ2V0Iiwia2V5cyIsImZpbmQiLCJzdGFydHNXaXRoIiwiaW50ZXJuYWxJbnN0YW5jZSIsImNvbnNvbGUiLCJsb2ciLCJmdW5jdGlvblN0cmluZ2lmeSIsIm9iaiIsImsiLCJ0b1N0cmluZyIsImUiLCJlcnJvciIsInByb3BzIiwic3RyaXBFeHRyYUNvbXBvbmVudFByb3BzIiwiRXZlbnRSZWNvcmRlciIsImNvbmZpZyIsInJlY29yZEV2ZW50cyIsInJlY29uY2lsZUV2ZW50cyIsImFkZEFsbExpc3RlbmVycyIsInRoaXMiLCJmb3JFYWNoIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50Q2FsbGJhY2siLCJyZWNvbmNpbGVDYWxsYmFjayIsInJlbW92ZUFsbExpc3RlbmVycyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzdGFydCIsInJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzIiwic3RvcCIsImV2ZW50c1RvUmVjb3JkIiwiY29tcG9uZW50RXZlbnRDYWNoZSIsInByZXZpb3VzQ29tcG9uZW50IiwicHJldmlvdXNNc2ciLCJldmVudFJlY29yZGVyIiwiY2xlYXJFdmVudENhY2hlIiwicmVjb25jaWxlRXZlbnRDYWNoZSIsIm1zZyIsInNlbmRFdmVudCIsImdldE1lc3NhZ2UiLCJyZWFjdENvbXBvbmVudCIsInNyY0VsZW1lbnQiLCJpbnB1dFRhcmdldCIsImxpbmtUYXJnZXQiLCJnZXRDb21wb25lbnRQcm9wcyIsIm5ld1Byb3BzIiwicGVuZGluZ1Byb3BzIiwiY2hpbGRyZW4iLCJfX3Byb3RvX18iLCJpbmNsdWRlcyIsImFjdGlvbiIsImNoZWNrZWQiLCJjb21wb25lbnROYW1lIiwiY29vcmRpbmF0ZXMiLCJocmVmIiwia2V5Q29kZSIsInRhZ05hbWUiLCJ0YWdUeXBlIiwidGV4dENvbnRlbnQiLCJpbm5lclRleHQiLCJ0aW1lc3RhbXAiLCJEYXRlIiwiZ2V0VGltZSIsInJlY29yZEV2ZW50Iiwibm9kZVRhcmdldCIsInRpbWVTdGFtcCIsIm5vZGVOYW1lIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJwdXNoIiwibWVzc2FnZSIsInVybCIsImZldGNoIiwibWV0aG9kIiwiY2Fj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R0FFUlMsWUFBYSxZQXJJakI5RCxLQUFLZSxjQUFnQixJQUFJcEIsRUFBYyxDQUNyQ0UsYUFBY0csS0FBS1csZUFDbkJQLGNBQWVKLEtBQUs0QyxZQUNwQnZDLGtCQUFtQkwsS0FBS2lCLHVCQXdJeEJmLE9BQVFhLGNBQWdCLElBQUksRUFDNUJiLE9BQVFhLGNBQWNQIiwiZmlsZSI6ImFzc2VydGx5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiaW1wb3J0IENvb3JkaW5hdGVzIGZyb20gXCIuL3R5cGVzL0Nvb3JkaW5hdGVzXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb21wb25lbnRGaWxlTmFtZShjb21wb25lbnQ6IGFueSwgbWF4TmVzdDogbnVtYmVyKTogYW55IHtcbiAgXG5cbiAgLy8gY29uc29sZS5sb2coJ2ZpbmRGaWxlTmFtZTogJywgY29tcG9uZW50KVxuXG4gIGlmICghY29tcG9uZW50IHx8IG1heE5lc3QgPT09IDApIHtcbiAgICByZXR1cm4gbnVsbFxuICB9XG5cbiAgaWYgKGNvbXBvbmVudD8uX2RlYnVnU291cmNlPy5maWxlTmFtZSkge1xuXG4gICAgcmV0dXJuIHtmaWxlbmFtZTogY29tcG9uZW50Py5fZGVidWdTb3VyY2U/LmZpbGVOYW1lLCBsaW5lbnVtYmVyOiBjb21wb25lbnQ/Ll9kZWJ1Z1NvdXJjZT8ubGluZU51bWJlcn1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZ2V0Q29tcG9uZW50RmlsZU5hbWUoY29tcG9uZW50Py5fZGVidWdPd25lcixtYXhOZXN0LTEpXG4gIH1cblxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29tcG9uZW50UHJvcHMoY29tcG9uZW50OiBhbnksIHByb3BzID0ge30pOiBhbnkge1xuICBpZiAoIWNvbXBvbmVudCkge1xuICAgIGZ1bmN0aW9uU3RyaW5naWZ5KHByb3BzKTtcbiAgICByZXR1cm4gcHJvcHM7XG4gIH1cblxuICBjb25zdCBuZXdQcm9wcyA9IGNvbXBvbmVudC5wZW5kaW5nUHJvcHNcbiAgICA/IHsgLi4ucHJvcHMsIC4uLmNvbXBvbmVudC5wZW5kaW5nUHJvcHMgfVxuICAgIDogcHJvcHM7XG4gIGRlbGV0ZSBuZXdQcm9wcy5jaGlsZHJlbjtcblxuICBpZiAoXG4gICAgY29tcG9uZW50Py50eXBlPy5fX3Byb3RvX18gJiZcbiAgICBbXCJDb21wb25lbnRcIiwgXCJQdXJlQ29tcG9uZW50XCJdLmluY2x1ZGVzKGNvbXBvbmVudC50eXBlLl9fcHJvdG9fXy5uYW1lKVxuICApIHtcbiAgICBmdW5jdGlvblN0cmluZ2lmeShuZXdQcm9wcyk7XG4gICAgcmV0dXJuIG5ld1Byb3BzO1xuICB9XG5cbiAgcmV0dXJuIGdldENvbXBvbmVudFByb3BzKGNvbXBvbmVudC5fZGVidWdPd25lciwgbmV3UHJvcHMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29tcG9uZW50TmFtZShmaWJlcjogYW55KTogYW55IHtcbiAgaWYgKCFmaWJlcikgcmV0dXJuIG51bGw7XG5cbiAgaWYgKGZpYmVyLmVsZW1lbnRUeXBlICYmIGZpYmVyLmVsZW1lbnRUeXBlLm5hbWUpIHtcbiAgICByZXR1cm4gZmliZXIuZWxlbWVudFR5cGUubmFtZTtcbiAgfVxuXG4gIGlmIChmaWJlci5lbGVtZW50VHlwZSAmJiBmaWJlci5lbGVtZW50VHlwZS5kaXNwbGF5TmFtZSkge1xuICAgIHJldHVybiBmaWJlci5lbGVtZW50VHlwZS5kaXNwbGF5TmFtZTtcbiAgfVxuXG4gIGlmIChmaWJlci50eXBlLmRpc3BsYXlOYW1lKSB7XG4gICAgcmV0dXJuIGZpYmVyLnR5cGUuZGlzcGxheU5hbWU7XG4gIH1cblxuICBpZiAoZmliZXIudHlwZS5uYW1lKSB7XG4gICAgcmV0dXJuIGZpYmVyLnR5cGUubmFtZTtcbiAgfVxuICByZXR1cm4gZ2V0Q29tcG9uZW50TmFtZShmaWJlci5fZGVidWdPd25lcik7XG59XG5cbmNvbnN0IGV2ZW50c1dpdGhDb29yZGluYXRlczogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHtcbiAgbW91c2V1cDogdHJ1ZSxcbiAgbW91c2Vkb3duOiB0cnVlLFxuICBtb3VzZW1vdmU6IHRydWUsXG4gIG1vdXNlb3ZlcjogdHJ1ZSxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb29yZGluYXRlcyhldmVudDogRXZlbnQpOiBDb29yZGluYXRlcyB8IG51bGwge1xuICBjb25zdCBtb3VzZUV2ZW50ID0gZXZlbnQgYXMgTW91c2VFdmVudDtcblxuICByZXR1cm4gZXZlbnRzV2l0aENvb3JkaW5hdGVzW2V2ZW50LnR5cGVdXG4gICAgPyB7IHg6IG1vdXNlRXZlbnQuY2xpZW50WCwgeTogbW91c2VFdmVudC5jbGllbnRZIH1cbiAgICA6IG51bGw7XG59XG5cbi8vIG1hcCByZWFjdCBjbGFzc2VzIHRvIGRvbSBlbGVtZW50c1xuZXhwb3J0IGZ1bmN0aW9uIGZpbmRSZWFjdEVsZW1lbnQodGFyZ2V0OiBFdmVudFRhcmdldCk6IGFueSB7XG4gIC8vIGNvbnNvbGUuZGlyKHRhcmdldClcbiAgY29uc3Qga2V5ID0gT2JqZWN0LmtleXModGFyZ2V0KS5maW5kKChrZXkpID0+XG4gICAga2V5LnN0YXJ0c1dpdGgoXCJfX3JlYWN0SW50ZXJuYWxJbnN0YW5jZSRcIilcbiAgKTtcbiAgLy8gY29uc29sZS5sb2coJ2tleTogJywga2V5KVxuICAvLyBjcmVhdGVzIGFuIG9iamVjdCBvdXQgb2YgdGhlIHRhcmdldCBwYXNzZWRcbiAgY29uc3QgdGFyZ2V0TWFwID0gdGFyZ2V0IGFzIHsgW2tleTogc3RyaW5nXTogYW55IH07XG5cbiAgY29uc3QgaW50ZXJuYWxJbnN0YW5jZSA9IGtleSA/IHRhcmdldE1hcFtrZXldIDogbnVsbDtcbiAgY29uc29sZS5sb2coJ1JlYWN0IE5vZGUgaWYgRm91bmQ6ICcsIGludGVybmFsSW5zdGFuY2UpXG4gIGlmIChpbnRlcm5hbEluc3RhbmNlID09IG51bGwpIHJldHVybiBudWxsO1xuXG4gIC8vIGNvbnNvbGUubG9nKCdpbnRlcm5hbEluc3RhbmNlMjogJywgaW50ZXJuYWxJbnN0YW5jZSlcbiAgLy8gcmV0dXJuIGludGVybmFsSW5zdGFuY2UuX2RlYnVnT3duZXJcbiAgLy8gICA/IGludGVybmFsSW5zdGFuY2UuX2RlYnVnT3duZXIuc3RhdGVOb2RlXG4gIC8vICAgOiBpbnRlcm5hbEluc3RhbmNlLnJldHVybi5zdGF0ZU5vZGU7XG5cbiAgcmV0dXJuIGludGVybmFsSW5zdGFuY2U7XG5cbiAgLy8gZm9yIChsZXQga2V5OiBzdHJpbmcgaW4gdGFyZ2V0KSB7XG4gIC8vICAgaWYgKGtleS5zdGFydHNXaXRoKFwiX19yZWFjdEludGVybmFsSW5zdGFuY2UkXCIpKSB7XG4gIC8vICAgICAvLyBjb25zb2xlLmxvZygna2V5cyBpbiB0aGUgZmluZCBSZWFjdEVsZW1lbnQnLCB0YXJnZXRba2V5XSlcbiAgLy8gICAgIHJldHVybiB0YXJnZXRba2V5XTtcbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmdW5jdGlvblN0cmluZ2lmeShvYmo6IGFueSk6IHZvaWQge1xuICBmb3IgKGxldCBrIGluIG9iaikge1xuICAgIGlmIChvYmpba10gJiYge30udG9TdHJpbmcuY2FsbChvYmpba10pID09PSBcIltvYmplY3QgRnVuY3Rpb25dXCIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIG9ialtrXSA9IFwiXCIgKyBvYmpba107XG4gICAgICAgIG9ialtrXSA9IFwiW0Z1bmN0aW9uXVwiXG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzdHJpbmdpZnlpbmcgcHJvcFwiLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgc3RyaXBFeHRyYUNvbXBvbmVudFByb3BzKG9iaik7XG59XG5cblxuXG5mdW5jdGlvbiBzdHJpcEV4dHJhQ29tcG9uZW50UHJvcHMocHJvcHM6IGFueSk6IHZvaWQge1xuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocHJvcHMpO1xuICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgaWYgKFxuICAgICAgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHByb3BzW2tleV0pID09PSBcIltvYmplY3QgT2JqZWN0XVwiICYmXG4gICAgICAocHJvcHNba2V5XS5oYXNPd25Qcm9wZXJ0eShcIl9vd25lclwiKSB8fFxuICAgICAgICBrZXkgPT09IFwiaW5wdXRSZWZcIiB8fFxuICAgICAgICBrZXkgPT09IFwiSW5wdXRQcm9wc1wiKVxuICAgICkge1xuICAgICAgZGVsZXRlIHByb3BzW2tleV07XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBFdmVudFR5cGUsIFJlY29uY2lsZVR5cGUgfSBmcm9tIFwiLi90eXBlcy9FdmVudFR5cGVcIjtcbmltcG9ydCB7IFJlY29yZGVyQ29uZmlnIH0gZnJvbSBcIi4vdHlwZXMvUmVjb3JkZXJDb25maWdcIjtcblxuZGVjbGFyZSBnbG9iYWwge1xuICBpbnRlcmZhY2UgV2luZG93IHtcbiAgICByZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVyczogYm9vbGVhbjtcbiAgICBkYXRhTGF5ZXI6IGFueVtdO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV2ZW50UmVjb3JkZXIge1xuICBwcml2YXRlIGV2ZW50Q2FsbGJhY2s6IChldmVudDogRXZlbnQpID0+IGFueTtcbiAgcHJpdmF0ZSByZWNvbmNpbGVDYWxsYmFjazogKGV2ZW50OiBFdmVudCkgPT4gYW55O1xuICBwcml2YXRlIHJlY29yZEV2ZW50czogRXZlbnRUeXBlW10gPSBbXTtcbiAgcHJpdmF0ZSByZWNvbmNpbGVFdmVudHM6IFJlY29uY2lsZVR5cGVbXSA9IFtcImJsdXJcIiwgXCJmb2N1c1wiLCBcImNoYW5nZVwiXTtcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFJlY29yZGVyQ29uZmlnKSB7XG4gICAgY29uc3Qge1xuICAgICAgZXZlbnRDYWxsYmFjayxcbiAgICAgIHJlY29uY2lsZUNhbGxiYWNrLFxuICAgICAgcmVjb3JkRXZlbnRzLFxuICAgICAgcmVjb25jaWxlRXZlbnRzID0gbnVsbCxcbiAgICB9ID0gY29uZmlnO1xuICAgIHRoaXMuZXZlbnRDYWxsYmFjayA9IGV2ZW50Q2FsbGJhY2s7XG4gICAgdGhpcy5yZWNvbmNpbGVDYWxsYmFjayA9IHJlY29uY2lsZUNhbGxiYWNrO1xuICAgIHRoaXMucmVjb3JkRXZlbnRzID0gcmVjb3JkRXZlbnRzO1xuICAgIGlmIChyZWNvbmNpbGVFdmVudHMpIHtcbiAgICAgIHRoaXMucmVjb25jaWxlRXZlbnRzID0gcmVjb25jaWxlRXZlbnRzO1xuICAgIH1cbiAgfVxuXG4gIGFkZEFsbExpc3RlbmVycyA9ICgpID0+IHtcbiAgICB0aGlzLnJlY29yZEV2ZW50cy5mb3JFYWNoKChldmVudCkgPT4ge1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMuZXZlbnRDYWxsYmFjaywgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlY29uY2lsZUV2ZW50cy5mb3JFYWNoKChldmVudCkgPT4ge1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMucmVjb25jaWxlQ2FsbGJhY2ssIHRydWUpO1xuICAgIH0pO1xuICB9O1xuXG4gIHJlbW92ZUFsbExpc3RlbmVycyA9ICgpID0+IHtcbiAgICB0aGlzLnJlY29yZEV2ZW50cy5mb3JFYWNoKChldmVudCkgPT4ge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMuZXZlbnRDYWxsYmFjaywgdHJ1ZSk7XG4gICAgfSk7XG4gICAgdGhpcy5yZWNvbmNpbGVFdmVudHMuZm9yRWFjaCgoZXZlbnQ6IFJlY29uY2lsZVR5cGUpID0+IHtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCB0aGlzLnJlY29uY2lsZUNhbGxiYWNrLCB0cnVlKTtcbiAgICB9KTtcbiAgfTtcblxuICBzdGFydCA9ICgpID0+IHtcbiAgICBpZiAoIXdpbmRvdy5yZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVycykge1xuICAgICAgdGhpcy5hZGRBbGxMaXN0ZW5lcnMoKTtcbiAgICAgIHdpbmRvdy5yZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVycyA9IHRydWU7XG4gICAgfVxuICB9O1xuXG4gIHN0b3AgPSAoKSA9PiB7XG4gICAgaWYgKHdpbmRvdy5yZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVycykge1xuICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICAgIHdpbmRvdy5yZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVycyA9IGZhbHNlO1xuICAgIH1cbiAgfTtcbn1cbiIsImltcG9ydCB7XG4gIGZpbmRSZWFjdEVsZW1lbnQsXG4gIGdldENvb3JkaW5hdGVzLFxuICBnZXRDb21wb25lbnROYW1lLFxuICBnZXRDb21wb25lbnRQcm9wcyxcbiAgZ2V0Q29tcG9uZW50RmlsZU5hbWVcbn0gZnJvbSBcIi4vdXRpbHNcIjtcblxuXG5pbXBvcnQgRXZlbnRSZWNvcmRlciBmcm9tIFwiLi9ldmVudC1yZWNvcmRlclwiO1xuaW1wb3J0IENsaWVudEludGVyZmFjZSBmcm9tIFwiLi90eXBlcy9DbGllbnRcIjtcbmltcG9ydCBNZXNzYWdlIGZyb20gXCIuL3R5cGVzL01lc3NhZ2VcIjtcbmltcG9ydCB7IEV2ZW50VHlwZSB9IGZyb20gXCIuL3R5cGVzL0V2ZW50VHlwZVwiO1xuXG5pbnRlcmZhY2UgQ29tcG9uZW50IHt9XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFzc2VydGx5Q2xpZW50IGltcGxlbWVudHMgQ2xpZW50SW50ZXJmYWNlIHtcbiAgZXZlbnRzVG9SZWNvcmQ6IEV2ZW50VHlwZVtdID0gW1wiY2xpY2tcIiwgXCJjaGFuZ2VcIl07XG5cbiAgcHJpdmF0ZSBldmVudFJlY29yZGVyOiBFdmVudFJlY29yZGVyO1xuICBwcml2YXRlIGNvbXBvbmVudEV2ZW50Q2FjaGU6IE1lc3NhZ2VbXSA9IFtdO1xuICBwcml2YXRlIHByZXZpb3VzQ29tcG9uZW50OiBDb21wb25lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBwcmV2aW91c01zZzogTWVzc2FnZSB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZXZlbnRSZWNvcmRlciA9IG5ldyBFdmVudFJlY29yZGVyKHtcbiAgICAgIHJlY29yZEV2ZW50czogdGhpcy5ldmVudHNUb1JlY29yZCxcbiAgICAgIGV2ZW50Q2FsbGJhY2s6IHRoaXMucmVjb3JkRXZlbnQsXG4gICAgICByZWNvbmNpbGVDYWxsYmFjazogdGhpcy5yZWNvbmNpbGVFdmVudENhY2hlLFxuICAgIH0pO1xuICB9XG5cbiAgc3RhcnQgPSAoKSA9PiB7XG4gICAgdGhpcy5ldmVudFJlY29yZGVyLnN0YXJ0KCk7XG4gIH07XG5cbiAgc3RvcCA9ICgpID0+IHtcbiAgICB0aGlzLmV2ZW50UmVjb3JkZXIuc3RvcCgpO1xuICB9O1xuXG4gIGNsZWFyRXZlbnRDYWNoZSA9ICgpID0+IHtcbiAgICB0aGlzLmNvbXBvbmVudEV2ZW50Q2FjaGUgPSBbXTtcbiAgfTtcblxuICByZWNvbmNpbGVFdmVudENhY2hlID0gKGV2ZW50OiBFdmVudCkgPT4ge1xuICAgIGNvbnN0IHJlYWN0Q29tcG9uZW50ID0gZXZlbnQudGFyZ2V0ID8gZmluZFJlYWN0RWxlbWVudChldmVudC50YXJnZXQpIDogbnVsbDtcbiAgICBpZiAocmVhY3RDb21wb25lbnQgIT09IHRoaXMucHJldmlvdXNDb21wb25lbnQpIHtcbiAgICAgIHRoaXMuY29tcG9uZW50RXZlbnRDYWNoZS5mb3JFYWNoKChtc2cpID0+IHtcbiAgICAgICAgdGhpcy5zZW5kRXZlbnQobXNnKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jbGVhckV2ZW50Q2FjaGUoKTtcbiAgICB9XG4gIH07XG5cbiAgZ2V0TWVzc2FnZSA9IChyZWFjdENvbXBvbmVudDogYW55LCBldmVudDogS2V5Ym9hcmRFdmVudCB8IEV2ZW50KTogTWVzc2FnZSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQ7XG4gICAgY29uc3QgaW5wdXRUYXJnZXQgPSB0YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBsaW5rVGFyZ2V0ID0gdGFyZ2V0IGFzIEhUTUxMaW5rRWxlbWVudDtcblxuICAgIGNvbnN0IHByb3BzID0gZ2V0Q29tcG9uZW50UHJvcHMocmVhY3RDb21wb25lbnQpO1xuICAgIHJldHVybiB7XG4gICAgICBhY3Rpb246IGV2ZW50LnR5cGUsXG4gICAgICBjaGVja2VkOiBldmVudD8udGFyZ2V0Py5oYXNPd25Qcm9wZXJ0eShcImNoZWNrZWRcIilcbiAgICAgICAgPyBpbnB1dFRhcmdldC5jaGVja2VkXG4gICAgICAgIDogbnVsbCxcbiAgICAgIGNvbXBvbmVudE5hbWU6IGdldENvbXBvbmVudE5hbWUocmVhY3RDb21wb25lbnQ/Ll9kZWJ1Z093bmVyKSxcbiAgICAgIGNvb3JkaW5hdGVzOiBnZXRDb29yZGluYXRlcyhldmVudCksXG4gICAgICAvLyBmaWxlbmFtZTogcmVhY3RDb21wb25lbnQ/Ll9kZWJ1Z1NvdXJjZT8uZmlsZU5hbWUsXG4gICAgICBmaWxlbmFtZTogZ2V0Q29tcG9uZW50RmlsZU5hbWUocmVhY3RDb21wb25lbnQsMTApPy5maWxlbmFtZSxcbiAgICAgIGxpbmVudW1iZXI6IGdldENvbXBvbmVudEZpbGVOYW1lKHJlYWN0Q29tcG9uZW50LDEwKT8ubGluZW51bWJlcixcbiAgICAgIGhyZWY6IGxpbmtUYXJnZXQuaHJlZiA/IGxpbmtUYXJnZXQuaHJlZiA6IG51bGwsXG4gICAgICBrZXlDb2RlOiAoZXZlbnQgYXMgS2V5Ym9hcmRFdmVudCkua2V5Q29kZVxuICAgICAgICA/IChldmVudCBhcyBLZXlib2FyZEV2ZW50KS5rZXlDb2RlXG4gICAgICAgIDogbnVsbCxcbiAgICAgIHByb3BzLFxuICAgICAgdGFnTmFtZTogaW5wdXRUYXJnZXQudGFnTmFtZSxcbiAgICAgIHRhZ1R5cGU6IGlucHV0VGFyZ2V0LnR5cGUsXG4gICAgICB0ZXh0Q29udGVudDogaW5wdXRUYXJnZXQudGV4dENvbnRlbnQgfHwgaW5wdXRUYXJnZXQuaW5uZXJUZXh0LFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICAgIHZhbHVlOiBpbnB1dFRhcmdldC52YWx1ZSxcbiAgICB9O1xuICB9O1xuXG4gIHJlY29yZEV2ZW50ID0gKGV2ZW50OiBFdmVudCkgPT4ge1xuICAgIGNvbnN0IG5vZGVUYXJnZXQgPSBldmVudC50YXJnZXQgYXMgTm9kZTtcblxuICAgIGlmICh0aGlzLnByZXZpb3VzTXNnICYmIHRoaXMucHJldmlvdXNNc2cudGltZXN0YW1wID09PSBldmVudC50aW1lU3RhbXApXG4gICAgICByZXR1cm47XG4gICAgaWYgKGV2ZW50LnR5cGUgPT09IFwibG9hZFwiICYmIG5vZGVUYXJnZXQubm9kZU5hbWUgPT09IFwiI2RvY3VtZW50XCIpIHJldHVybjtcblxuICAgIGlmICghZXZlbnQudGFyZ2V0KSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgaWYgKHRoaXMucHJldmlvdXNNc2cpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIChldmVudC50eXBlID09PSBcImNoYW5nZVwiIHx8IGV2ZW50LnR5cGUgPT09IFwiY2xpY2tcIikgJiZcbiAgICAgICAgICB0aGlzLnByZXZpb3VzTXNnICYmXG4gICAgICAgICAgdGhpcy5wcmV2aW91c01zZy5hY3Rpb24gPT09IFwiY2xpY2tcIiAmJlxuICAgICAgICAgIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5wcmV2aW91c01zZy50aW1lc3RhbXAgPCAxMDBcbiAgICAgICAgKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJtZXNzYWdlIG5vdCBzZW5kIGR1ZSB0byB0aW1lXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCByZWFjdENvbXBvbmVudCA9IGZpbmRSZWFjdEVsZW1lbnQoZXZlbnQudGFyZ2V0KTtcbiAgICAgIGNvbnNvbGUubG9nKCdyZWFjdENvbXBvbmVudDogJywgcmVhY3RDb21wb25lbnQpXG4gICAgICBjb25zdCBtc2c6IE1lc3NhZ2UgPSB0aGlzLmdldE1lc3NhZ2UocmVhY3RDb21wb25lbnQsIGV2ZW50KTtcbiAgICAgIGNvbnNvbGUubG9nKCdyZWNvcmQgZXZlbnQgbXNnJywgbXNnKVxuXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImxhc3RFdmVudFwiLCBKU09OLnN0cmluZ2lmeShtc2cpKTtcbiAgICAgIHRoaXMucHJldmlvdXNNc2cgPSBtc2c7XG5cbiAgICAgIGlmIChcbiAgICAgICAgIXRoaXMucHJldmlvdXNDb21wb25lbnQgfHxcbiAgICAgICAgKHRoaXMucHJldmlvdXNDb21wb25lbnQgJiYgdGhpcy5wcmV2aW91c0NvbXBvbmVudCA9PT0gcmVhY3RDb21wb25lbnQpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5wcmV2aW91c0NvbXBvbmVudCA9IHJlYWN0Q29tcG9uZW50O1xuICAgICAgICBpZiAoXG4gICAgICAgICAgdGhpcy5wcmV2aW91c0NvbXBvbmVudCAmJlxuICAgICAgICAgIG1zZy5jaGVja2VkICE9PSBudWxsICYmXG4gICAgICAgICAgbXNnLmFjdGlvbiA9PT0gXCJjbGlja1wiXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMuc2VuZEV2ZW50KG1zZyk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29tcG9uZW50RXZlbnRDYWNoZS5wdXNoKG1zZyk7XG5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jbGVhckV2ZW50Q2FjaGUoKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5wcmV2aW91c0NvbXBvbmVudCA9IHJlYWN0Q29tcG9uZW50O1xuXG4gICAgICB0aGlzLnNlbmRFdmVudChtc2cpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZWNvcmRpbmcgZXZlbnRcIiwgZSk7XG4gICAgfVxuICB9O1xuXG4gIHNlbmRFdmVudCA9IGFzeW5jIChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XG4gICAgLy8gY29uc3QgYWNjb3VudElkID0gd2luZG93W1wiZGF0YUxheWVyXCJdWzBdW1wiYXBpS2V5XCJdO1xuICAgIGNvbnN0IGFjY291bnRJZCA9ICh3aW5kb3cgYXMgeyBba2V5OiBzdHJpbmddOiBhbnkgfSlbXCJkYXRhTGF5ZXJcIl1bMF1bXCJhcGlLZXlcIl1cbiAgICBjb25zdCB1cmwgPSBgLy9sb2NhbGhvc3Q6MzAwMi9hcGkvYWNjb3VudHMvJHthY2NvdW50SWR9L2V2ZW50cy9gO1xuICAgIC8vIGNvbnNvbGUubG9nKCd0aGlzIGlzIHRoZSBzZW5kRXZlbnQnLCBtZXNzYWdlKVxuICAgIGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIG1vZGU6IFwiY29yc1wiLFxuICAgICAgY2FjaGU6IFwibm8tY2FjaGVcIixcbiAgICAgIGNyZWRlbnRpYWxzOiBcInNhbWUtb3JpZ2luXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdXJsOiB3aW5kb3cubG9jYXRpb24uaHJlZixcbiAgICAgICAgZXZlbnQ6IFttZXNzYWdlXSxcbiAgICAgICAgLy8gVE9ETzogdGVzdCBzZXQgaWQgc2hvdWxkIGJlIHNldCB3aGVuIGNyZWF0aW5nL2xvYWRpbmcgdGVzdHNldCBpbiB0aGUgcnVubmVyXG4gICAgICAgIHBsYWNlaG9sZGVyOiBudWxsLFxuICAgICAgfSksXG4gICAgfSk7XG4gIH07XG59XG5cbig8YW55PndpbmRvdykuZXZlbnRSZWNvcmRlciA9IG5ldyBBc3NlcnRseUNsaWVudCgpO1xuKDxhbnk+d2luZG93KS5ldmVudFJlY29yZGVyLnN0YXJ0KCk7Il0sInNvdXJjZVJvb3QiOiIifQ==