!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";function o(e,n,t){var r,i,l;if(!e||0===n)return t;if(null===(r=null==e?void 0:e._debugSource)||void 0===r?void 0:r.fileName){const r=function e(n,t={}){var o;if(!n)return c(t),t;const r=n.pendingProps?Object.assign(Object.assign({},t),n.pendingProps):t;if(delete r.children,(null===(o=null==n?void 0:n.type)||void 0===o?void 0:o.__proto__)&&["Component","PureComponent"].includes(n.type.__proto__.name))return c(r),r;return e(n._debugOwner,r)}(null==e?void 0:e._debugOwner),s=function e(n){if(!n)return null;if(n.elementType&&n.elementType.name)return n.elementType.name;if(n.elementType&&n.elementType.displayName)return n.elementType.displayName;if(n.type.displayName)return n.type.displayName;if(n.type.name)return n.type.name;return e(n._debugOwner)}(null==e?void 0:e._debugOwner);return t.push({filename:null===(i=null==e?void 0:e._debugSource)||void 0===i?void 0:i.fileName,linenumber:null===(l=null==e?void 0:e._debugSource)||void 0===l?void 0:l.lineNumber,props:r,componentName:s}),o(null==e?void 0:e._debugOwner,n-1,t)}return o(null==e?void 0:e._debugOwner,n-1,t)}t.r(n),t.d(n,"default",(function(){return u}));const r={mouseup:!0,mousedown:!0,mousemove:!0,mouseover:!0};function i(e){const n=e;return r[e.type]?{x:n.clientX,y:n.clientY}:null}function l(e){const n=Object.keys(e).find(e=>e.startsWith("__reactInternalInstance$")),t=n?e[n]:null;return null==t?null:t}function c(e){for(let n in e)if(e[n]&&"[object Function]"==={}.toString.call(e[n]))try{e[n]=""+e[n],e[n]=e[n].replace(/(\r\n|\n|\r)/gm,"")}catch(e){console.error("Error stringifying prop",e)}!function(e){const n=Object.keys(e);for(const t of n)"[object Object]"!==Object.prototype.toString.call(e[t])||!e[t].hasOwnProperty("_owner")&&"inputRef"!==t&&"InputProps"!==t||delete e[t]}(e)}class s{constructor(e){this.recordEvents=[],this.reconcileEvents=["blur","focus","change"],this.addAllListeners=()=>{this.recordEvents.forEach(e=>{window.addEventListener(e,this.eventCallback,!0)}),this.reconcileEvents.forEach(e=>{window.addEventListener(e,this.reconcileCallback,!0)})},this.removeAllListeners=()=>{this.recordEvents.forEach(e=>{window.removeEventListener(e,this.eventCallback,!0)}),this.reconcileEvents.forEach(e=>{window.removeEventListener(e,this.reconcileCallback,!0)})},this.start=()=>{window.recorderAddedControlListeners||(this.addAllListeners(),window.recorderAddedControlListeners=!0)},this.stop=()=>{window.recorderAddedControlListeners&&(this.removeAllListeners(),window.recorderAddedControlListeners=!1)};const{eventCallback:n,reconcileCallback:t,recordEvents:o,reconcileEvents:r=null}=e;this.eventCallback=n,this.reconcileCallback=t,this.recordEvents=o,r&&(this.reconcileEvents=r)}}var a=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function l(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(l,c)}s((o=o.apply(e,n||[])).next())}))};class u{constructor(){this.eventsToRecord=["click","change"],this.componentEventCache=[],this.previousComponent=null,this.previousMsg=null,this.start=()=>{this.eventRecorder.start()},this.stop=()=>{this.eventRecorder.stop()},this.clearEventCache=()=>{this.componentEventCache=[]},this.reconcileEventCache=e=>{(e.target?l(e.target):null)!==this.previousComponent&&(this.componentEventCache.forEach(e=>{console.log("in the reconcile"),this.sendEvent(e)}),this.clearEventCache())},this.createPopupMenu=e=>{var n;const t="componentMenu"+(new Date).getTime(),o=event,r=document.createElement("DIV"),i=Array.from(document.getElementsByClassName("componentMenu"));null==i||i.map(e=>e.remove()),r.setAttribute("id",t),r.setAttribute("class","componentMenu"),document.body.appendChild(r),r.style.position="absolute",r.style.left=o.x+"px",r.style.top=o.y+"px",r.style.zIndex="5",null===(n=null==e?void 0:e.componentInfo)||void 0===n||n.map(n=>{const o=document.createElement("BUTTON");if(o.style.width="150px",o.innerHTML=null==n?void 0:n.componentName,o.innerHTML){o.addEventListener("click",()=>this.componentMenuClick(event,t,e)),r.appendChild(o);const n=document.createElement("br");r.appendChild(n)}});const l=document.createElement("BUTTON");l.style.width="150px",l.innerHTML="Cancel",l.addEventListener("click",()=>this.removeSingleMenu(t)),r.appendChild(l)},this.removeSingleMenu=e=>{const n=document.getElementById(e);null==n||n.remove()},this.componentMenuClick=(e,n,t)=>{var o;console.log("this is the click call back: ",e),console.log("this is the message in the callback: ",t.componentInfo),null==e||e.stopPropagation(),this.sendEvent(Object.assign(Object.assign({},t),{componentInfo:null===(o=t.componentInfo)||void 0===o?void 0:o.filter(n=>{var t;return n.componentName===(null===(t=e.target)||void 0===t?void 0:t.innerHTML)})})),this.removeSingleMenu(n)},this.getMessage=(e,n)=>{var t,r,l;const c=n.target||n.srcElement,s=c,a=c,u=o(e,10,[]),d=(null===(r=null===(t=null==u?void 0:u.slice(0))||void 0===t?void 0:t.reverse())||void 0===r?void 0:r.reduce((e,n)=>{var t;if(null===(t=n.props)||void 0===t?void 0:t.onClick)return Object.assign({},n)},{}))||null;return{action:n.type,checked:(null===(l=null==n?void 0:n.target)||void 0===l?void 0:l.hasOwnProperty("checked"))?s.checked:null,coordinates:i(n),href:a.href?a.href:null,keyCode:n.keyCode?n.keyCode:null,tagName:s.tagName,tagType:s.type,textContent:s.textContent||s.innerText,timestamp:(new Date).getTime(),value:s.value,writeTestLocation:"",componentInfo:u,clickHandlerComponent:d}},this.recordEvent=e=>{var n,t;const o=e.target,r=e;if(!(null===(t=null===(n=null==o?void 0:o.parentElement)||void 0===n?void 0:n.getAttribute("id"))||void 0===t?void 0:t.includes("componentMenu"))&&e.target)try{if(this.previousMsg&&("change"===e.type||"click"===e.type)&&this.previousMsg&&"click"===this.previousMsg.action&&(new Date).getTime()-this.previousMsg.timestamp<100)return void console.log("message not send due to time");const n=l(e.target),t=this.getMessage(n,e);console.log("reactComponent and message in RECORD_EVENT: ",n,t),localStorage.setItem("lastEvent",JSON.stringify(t)),this.previousMsg=t,this.previousComponent=n,(null==r?void 0:r.metaKey)&&this.createPopupMenu(t)}catch(e){console.error("Error recording event",e)}},this.sendEvent=e=>a(this,void 0,void 0,(function*(){var n;const t=window.dataLayer[0].apiKey,o=window.dataLayer[0].testLocation,r=`//localhost:3002/api/accounts/${t}/events/`;console.log("this is the message in SEND_EVENT: ",e),null===(n=null==e?void 0:e.componentInfo)||void 0===n||n.map(e=>(e.writeTestLocation=o,e)),yield fetch(r,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:window.location.href,event:e,placeholder:null})})})),this.eventRecorder=new s({recordEvents:this.eventsToRecord,eventCallback:this.recordEvent,reconcileCallback:this.reconcileEventCache})}}window.eventRecorder=new u,window.eventRecorder.start()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovLy8uL3NyYy9ldmVudC1yZWNvcmRlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY2xpZW50LnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZ2V0Q29tcG9uZW50SW5mbyIsImNvbXBvbmVudCIsIm1heE5lc3QiLCJyZXN1bHRBcnJheSIsIl9kZWJ1Z1NvdXJjZSIsImZpbGVOYW1lIiwicHJvcHMiLCJnZXRDb21wb25lbnRQcm9wcyIsImZ1bmN0aW9uU3RyaW5naWZ5IiwibmV3UHJvcHMiLCJwZW5kaW5nUHJvcHMiLCJjaGlsZHJlbiIsInR5cGUiLCJfX3Byb3RvX18iLCJpbmNsdWRlcyIsIl9kZWJ1Z093bmVyIiwiZ2V0Q29tcG9uZW50TmFtZSIsImZpYmVyIiwiZWxlbWVudFR5cGUiLCJkaXNwbGF5TmFtZSIsInB1c2giLCJmaWxlbmFtZSIsImxpbmVudW1iZXIiLCJsaW5lTnVtYmVyIiwiY29tcG9uZW50TmFtZSIsImV2ZW50c1dpdGhDb29yZGluYXRlcyIsIm1vdXNldXAiLCJtb3VzZWRvd24iLCJtb3VzZW1vdmUiLCJtb3VzZW92ZXIiLCJnZXRDb29yZGluYXRlcyIsImV2ZW50IiwibW91c2VFdmVudCIsIngiLCJjbGllbnRYIiwieSIsImNsaWVudFkiLCJmaW5kUmVhY3RFbGVtZW50IiwidGFyZ2V0Iiwia2V5cyIsImZpbmQiLCJzdGFydHNXaXRoIiwiaW50ZXJuYWxJbnN0YW5jZSIsIm9iaiIsImsiLCJ0b1N0cmluZyIsInJlcGxhY2UiLCJlIiwiY29uc29sZSIsImVycm9yIiwic3RyaXBFeHRyYUNvbXBvbmVudFByb3BzIiwiRXZlbnRSZWNvcmRlciIsImNvbmZpZyIsInJlY29yZEV2ZW50cyIsInJlY29uY2lsZUV2ZW50cyIsImFkZEFsbExpc3RlbmVycyIsInRoaXMiLCJmb3JFYWNoIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50Q2FsbGJhY2siLCJyZWNvbmNpbGVDYWxsYmFjayIsInJlbW92ZUFsbExpc3RlbmVycyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzdGFydCIsInJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzIiwic3RvcCIsImV2ZW50c1RvUmVjb3JkIiwiY29tcG9uZW50RXZlbnRDYWNoZSIsInByZXZpb3VzQ29tcG9uZW50IiwicHJldmlvdXNNc2ciLCJldmVudFJlY29yZGVyIiwiY2xlYXJFdmVudENhY2hlIiwicmVjb25jaWxlRXZlbnRDYWNoZSIsIm1zZyIsImxvZyIsInNlbmRFdmVudCIsImNyZWF0ZVBvcHVwTWVudSIsIm1lc3NhZ2UiLCJkaXZJRCIsIkRhdGUiLCJnZXRUaW1lIiwibWVudURpdiIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInByZXZpb3VzTWVudXMiLCJBcnJheSIsImZyb20iLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwibWFwIiwidmFsIiwicmVtb3ZlIiwic2V0QXR0cmlidXRlIiwiYm9keSIsImFwcGVuZENoaWxkIiwic3R5bGUiLCJwb3NpdGlvbiIsImxlZnQiLCJ0b3AiLCJ6SW5kZXgiLCJjb21wb25lbnRJbmZvIiwiYnRuIiwid2lkdGgiLCJpbm5lckhUTUwiLCJjb21wb25lbnRNZW51Q2xpY2siLCJiciIsIkNhbmNlbEJ0biIsInJlbW92ZVNpbmdsZU1lbnUiLCJnZXRFbGVtZW50QnlJZCIsInN0b3BQcm9wYWdhdGlvbiIsImZpbHRlciIsImdldE1lc3NhZ2UiLCJyZWFjdENvbXBvbmVudCIsInNyY0VsZW1lbnQiLCJpbnB1dFRhcmdldCIsImxpbmtUYXJnZXQiLCJjbGlja0hhbmRsZXIiLCJzbGljZSIsInJldmVyc2UiLCJyZWR1Y2UiLCJhY2N1bXVsYXRvciIsImN1cnJlbnRWYWx1ZSIsIm9uQ2xpY2siLCJhY3Rpb24iLCJjaGVja2VkIiwiY29vcmRpbmF0ZXMiLCJocmVmIiwia2V5Q29kZSIsInRhZ05hbWUiLCJ0YWdUeXBlIiwidGV4dENvbnRlbnQiLCJpbm5lclRleHQiLCJ0aW1lc3RhbXAiLCJ3cml0ZVRlc3RMb2NhdGlvbiIsImNsaWNrSGFuZGxlckNvbXBvbmVudCIsInJlY29yZEV2ZW50Iiwibm9kZVRhcmdldCIsInBhcmVudEVsZW1lbnQiLCJnZXRBdHRyaWJ1dGUiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFLZXkiLCJhY2NvdW50SWQiLCJ3cml0ZUxvY2F0aW9uIiwidXJsIiwiZmV0Y2giLCJtZXRob2QiLCJjYWNoZSIsImNyZWRlbnRpYWxzIiwiaGVhZGVycyIsImxvY2F0aW9uIiwicGxhY2Vob2xkZXIiXSwibWFwcGluZ3MiOiJhQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQUtmRixFQUFvQlEsRUFBSUYsRUFHeEJOLEVBQW9CUyxFQUFJVixFQUd4QkMsRUFB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LFVBQUUsR0FBaUIsYUFDakZ3RixFQUFNLGlDQUFpQ0YsWUFHN0NoRyxRQUFRMkIsSUFBSSxzQ0FBdUNHLEdBRTdCLFFBQXRCLEVBQUFBLGFBQU8sRUFBUEEsRUFBU3NCLHFCQUFhLFNBQUVYLElBQU1DLElBQzVCQSxFQUFJMkMsa0JBQW9CWSxFQUNqQnZELFVBR0h5RCxNQUFNRCxFQUFLLENBQ2ZFLE9BQVEsT0FDUmpLLEtBQU0sT0FDTmtLLE1BQU8sV0FDUEMsWUFBYSxjQUNiQyxRQUFTLENBQ1AsZUFBZ0Isb0JBRWxCMUQsS0FBTWdELEtBQUtDLFVBQVUsQ0FDbkJJLElBQUt4RixPQUFPOEYsU0FBUzFCLEtBQ3JCL0YsTUFBTytDLEVBRVAyRSxZQUFhLFlBMU9qQmpHLEtBQUtlLGNBQWdCLElBQUlwQixFQUFjLENBQ3JDRSxhQUFjRyxLQUFLVyxlQUNuQlAsY0FBZUosS0FBSytFLFlBQ3BCMUUsa0JBQW1CTCxLQUFLaUIsdUJBNk94QmYsT0FBUWEsY0FBZ0IsSUFBSSxFQUM1QmIsT0FBUWEsY0FBY1AiLCJmaWxlIjoiYXNzZXJ0bHkuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJpbXBvcnQgQ29vcmRpbmF0ZXMgZnJvbSBcIi4vdHlwZXMvQ29vcmRpbmF0ZXNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbXBvbmVudEluZm8oY29tcG9uZW50OiBhbnksIG1heE5lc3Q6IG51bWJlciwgcmVzdWx0QXJyYXk6IGFueSk6IGFueSB7XG4gIFxuXG4gIC8vIGNvbnNvbGUubG9nKCdmaW5kRmlsZU5hbWU6ICcsIGNvbXBvbmVudClcblxuICBpZiAoIWNvbXBvbmVudCB8fCBtYXhOZXN0ID09PSAwKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ3Jlc3VsdEFycmF5OiAnLCByZXN1bHRBcnJheSlcbiAgICByZXR1cm4gcmVzdWx0QXJyYXlcbiAgfVxuXG4gIGlmIChjb21wb25lbnQ/Ll9kZWJ1Z1NvdXJjZT8uZmlsZU5hbWUpIHtcbiAgICAvLyB0aGUgb3duZXIgb2YgdGhlIG5vZGUgd2hlcmUgdGhlICdzb3VyY2UnIGZpbGVuYW1lIGV4aXN0cyBpcyB0aGUgZmlsZSB0aGF0IHlvdSB3YW50IHRoZSBwcm9wcyBmb3IgXG4gICAgY29uc3QgcHJvcHMgPSBnZXRDb21wb25lbnRQcm9wcyhjb21wb25lbnQ/Ll9kZWJ1Z093bmVyKVxuICAgIGNvbnN0IG5hbWUgPSBnZXRDb21wb25lbnROYW1lKGNvbXBvbmVudD8uX2RlYnVnT3duZXIpXG4gICAgcmVzdWx0QXJyYXkucHVzaCh7XG4gICAgICBmaWxlbmFtZTogY29tcG9uZW50Py5fZGVidWdTb3VyY2U/LmZpbGVOYW1lLCBcbiAgICAgIC8vIHRoZSBsaW5lIG51bWJlciBpcyByZWFsbHkgZm9yIHRoZSBuZXh0IGNvbXBvbmVudCBkb3duIGluIHRoZSB0cmVlIHRoYXQgaXMgYmVpbmcgY2FsbGVkIGZyb20gdGhlICdmaWxlbmFtZSdcbiAgICAgIGxpbmVudW1iZXI6IGNvbXBvbmVudD8uX2RlYnVnU291cmNlPy5saW5lTnVtYmVyLCBcbiAgICAgIHByb3BzOiBwcm9wcywgXG4gICAgICBjb21wb25lbnROYW1lOiBuYW1lfSlcbiAgICByZXR1cm4gZ2V0Q29tcG9uZW50SW5mbyhjb21wb25lbnQ/Ll9kZWJ1Z093bmVyLG1heE5lc3QtMSxyZXN1bHRBcnJheSlcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZ2V0Q29tcG9uZW50SW5mbyhjb21wb25lbnQ/Ll9kZWJ1Z093bmVyLG1heE5lc3QtMSxyZXN1bHRBcnJheSlcbiAgfVxuXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb21wb25lbnRQcm9wcyhjb21wb25lbnQ6IGFueSwgcHJvcHMgPSB7fSk6IGFueSB7XG4gIGlmICghY29tcG9uZW50KSB7XG4gICAgZnVuY3Rpb25TdHJpbmdpZnkocHJvcHMpO1xuICAgIHJldHVybiBwcm9wcztcbiAgfVxuXG4gIGNvbnN0IG5ld1Byb3BzID0gY29tcG9uZW50LnBlbmRpbmdQcm9wc1xuICAgID8geyAuLi5wcm9wcywgLi4uY29tcG9uZW50LnBlbmRpbmdQcm9wcyB9XG4gICAgOiBwcm9wcztcbiAgZGVsZXRlIG5ld1Byb3BzLmNoaWxkcmVuO1xuXG4gIGlmIChcbiAgICBjb21wb25lbnQ/LnR5cGU/Ll9fcHJvdG9fXyAmJlxuICAgIFtcIkNvbXBvbmVudFwiLCBcIlB1cmVDb21wb25lbnRcIl0uaW5jbHVkZXMoY29tcG9uZW50LnR5cGUuX19wcm90b19fLm5hbWUpXG4gICkge1xuICAgIGZ1bmN0aW9uU3RyaW5naWZ5KG5ld1Byb3BzKTtcbiAgICByZXR1cm4gbmV3UHJvcHM7XG4gIH1cblxuICByZXR1cm4gZ2V0Q29tcG9uZW50UHJvcHMoY29tcG9uZW50Ll9kZWJ1Z093bmVyLCBuZXdQcm9wcyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb21wb25lbnROYW1lKGZpYmVyOiBhbnkpOiBhbnkge1xuICBpZiAoIWZpYmVyKSByZXR1cm4gbnVsbDtcblxuICBpZiAoZmliZXIuZWxlbWVudFR5cGUgJiYgZmliZXIuZWxlbWVudFR5cGUubmFtZSkge1xuICAgIHJldHVybiBmaWJlci5lbGVtZW50VHlwZS5uYW1lO1xuICB9XG5cbiAgaWYgKGZpYmVyLmVsZW1lbnRUeXBlICYmIGZpYmVyLmVsZW1lbnRUeXBlLmRpc3BsYXlOYW1lKSB7XG4gICAgcmV0dXJuIGZpYmVyLmVsZW1lbnRUeXBlLmRpc3BsYXlOYW1lO1xuICB9XG5cbiAgaWYgKGZpYmVyLnR5cGUuZGlzcGxheU5hbWUpIHtcbiAgICByZXR1cm4gZmliZXIudHlwZS5kaXNwbGF5TmFtZTtcbiAgfVxuXG4gIGlmIChmaWJlci50eXBlLm5hbWUpIHtcbiAgICByZXR1cm4gZmliZXIudHlwZS5uYW1lO1xuICB9XG4gIHJldHVybiBnZXRDb21wb25lbnROYW1lKGZpYmVyLl9kZWJ1Z093bmVyKTtcbn1cblxuY29uc3QgZXZlbnRzV2l0aENvb3JkaW5hdGVzOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge1xuICBtb3VzZXVwOiB0cnVlLFxuICBtb3VzZWRvd246IHRydWUsXG4gIG1vdXNlbW92ZTogdHJ1ZSxcbiAgbW91c2VvdmVyOiB0cnVlLFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvb3JkaW5hdGVzKGV2ZW50OiBFdmVudCk6IENvb3JkaW5hdGVzIHwgbnVsbCB7XG4gIGNvbnN0IG1vdXNlRXZlbnQgPSBldmVudCBhcyBNb3VzZUV2ZW50O1xuXG4gIHJldHVybiBldmVudHNXaXRoQ29vcmRpbmF0ZXNbZXZlbnQudHlwZV1cbiAgICA/IHsgeDogbW91c2VFdmVudC5jbGllbnRYLCB5OiBtb3VzZUV2ZW50LmNsaWVudFkgfVxuICAgIDogbnVsbDtcbn1cblxuLy8gbWFwIHJlYWN0IGNsYXNzZXMgdG8gZG9tIGVsZW1lbnRzXG5leHBvcnQgZnVuY3Rpb24gZmluZFJlYWN0RWxlbWVudCh0YXJnZXQ6IEV2ZW50VGFyZ2V0KTogYW55IHtcbiAgLy8gY29uc29sZS5kaXIodGFyZ2V0KVxuICBjb25zdCBrZXkgPSBPYmplY3Qua2V5cyh0YXJnZXQpLmZpbmQoKGtleSkgPT5cbiAgICBrZXkuc3RhcnRzV2l0aChcIl9fcmVhY3RJbnRlcm5hbEluc3RhbmNlJFwiKVxuICApO1xuICAvLyBjb25zb2xlLmxvZygna2V5OiAnLCBrZXkpXG4gIC8vIGNyZWF0ZXMgYW4gb2JqZWN0IG91dCBvZiB0aGUgdGFyZ2V0IHBhc3NlZFxuICBjb25zdCB0YXJnZXRNYXAgPSB0YXJnZXQgYXMgeyBba2V5OiBzdHJpbmddOiBhbnkgfTtcblxuICBjb25zdCBpbnRlcm5hbEluc3RhbmNlID0ga2V5ID8gdGFyZ2V0TWFwW2tleV0gOiBudWxsO1xuICAvLyBjb25zb2xlLmxvZygnUmVhY3QgTm9kZSBpZiBGb3VuZDogJywgaW50ZXJuYWxJbnN0YW5jZSlcbiAgaWYgKGludGVybmFsSW5zdGFuY2UgPT0gbnVsbCkgcmV0dXJuIG51bGw7XG5cbiAgLy8gY29uc29sZS5sb2coJ2ludGVybmFsSW5zdGFuY2UyOiAnLCBpbnRlcm5hbEluc3RhbmNlKVxuICAvLyByZXR1cm4gaW50ZXJuYWxJbnN0YW5jZS5fZGVidWdPd25lclxuICAvLyAgID8gaW50ZXJuYWxJbnN0YW5jZS5fZGVidWdPd25lci5zdGF0ZU5vZGVcbiAgLy8gICA6IGludGVybmFsSW5zdGFuY2UucmV0dXJuLnN0YXRlTm9kZTtcblxuICByZXR1cm4gaW50ZXJuYWxJbnN0YW5jZTtcblxuICAvLyBmb3IgKGxldCBrZXk6IHN0cmluZyBpbiB0YXJnZXQpIHtcbiAgLy8gICBpZiAoa2V5LnN0YXJ0c1dpdGgoXCJfX3JlYWN0SW50ZXJuYWxJbnN0YW5jZSRcIikpIHtcbiAgLy8gICAgIC8vIGNvbnNvbGUubG9nKCdrZXlzIGluIHRoZSBmaW5kIFJlYWN0RWxlbWVudCcsIHRhcmdldFtrZXldKVxuICAvLyAgICAgcmV0dXJuIHRhcmdldFtrZXldO1xuICAvLyAgIH1cbiAgLy8gfVxuICAvLyByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZ1bmN0aW9uU3RyaW5naWZ5KG9iajogYW55KTogdm9pZCB7XG4gIGZvciAobGV0IGsgaW4gb2JqKSB7XG4gICAgaWYgKG9ialtrXSAmJiB7fS50b1N0cmluZy5jYWxsKG9ialtrXSkgPT09IFwiW29iamVjdCBGdW5jdGlvbl1cIikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgb2JqW2tdID0gXCJcIiArIG9ialtrXTtcbiAgICAgICAgLy8gZ2V0IHJpZCBvZiB0aGUgZXh0cmEgbGluZSBtYXJrZXJzXG4gICAgICAgIG9ialtrXSA9IG9ialtrXS5yZXBsYWNlKC8oXFxyXFxufFxcbnxcXHIpL2dtLCBcIlwiKTtcbiAgICAgICAgLy8gb2JqW2tdID0gXCJbRnVuY3Rpb25dXCJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHN0cmluZ2lmeWluZyBwcm9wXCIsIGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBzdHJpcEV4dHJhQ29tcG9uZW50UHJvcHMob2JqKTtcbn1cblxuXG5cbmZ1bmN0aW9uIHN0cmlwRXh0cmFDb21wb25lbnRQcm9wcyhwcm9wczogYW55KTogdm9pZCB7XG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhwcm9wcyk7XG4gIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICBpZiAoXG4gICAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwocHJvcHNba2V5XSkgPT09IFwiW29iamVjdCBPYmplY3RdXCIgJiZcbiAgICAgIChwcm9wc1trZXldLmhhc093blByb3BlcnR5KFwiX293bmVyXCIpIHx8XG4gICAgICAgIGtleSA9PT0gXCJpbnB1dFJlZlwiIHx8XG4gICAgICAgIGtleSA9PT0gXCJJbnB1dFByb3BzXCIpXG4gICAgKSB7XG4gICAgICBkZWxldGUgcHJvcHNba2V5XTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCB7IEV2ZW50VHlwZSwgUmVjb25jaWxlVHlwZSB9IGZyb20gXCIuL3R5cGVzL0V2ZW50VHlwZVwiO1xuaW1wb3J0IHsgUmVjb3JkZXJDb25maWcgfSBmcm9tIFwiLi90eXBlcy9SZWNvcmRlckNvbmZpZ1wiO1xuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIGludGVyZmFjZSBXaW5kb3cge1xuICAgIHJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzOiBib29sZWFuO1xuICAgIGRhdGFMYXllcjogYW55W107XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXZlbnRSZWNvcmRlciB7XG4gIHByaXZhdGUgZXZlbnRDYWxsYmFjazogKGV2ZW50OiBFdmVudCkgPT4gYW55O1xuICBwcml2YXRlIHJlY29uY2lsZUNhbGxiYWNrOiAoZXZlbnQ6IEV2ZW50KSA9PiBhbnk7XG4gIHByaXZhdGUgcmVjb3JkRXZlbnRzOiBFdmVudFR5cGVbXSA9IFtdO1xuICBwcml2YXRlIHJlY29uY2lsZUV2ZW50czogUmVjb25jaWxlVHlwZVtdID0gW1wiYmx1clwiLCBcImZvY3VzXCIsIFwiY2hhbmdlXCJdO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogUmVjb3JkZXJDb25maWcpIHtcbiAgICBjb25zdCB7XG4gICAgICBldmVudENhbGxiYWNrLFxuICAgICAgcmVjb25jaWxlQ2FsbGJhY2ssXG4gICAgICByZWNvcmRFdmVudHMsXG4gICAgICByZWNvbmNpbGVFdmVudHMgPSBudWxsLFxuICAgIH0gPSBjb25maWc7XG4gICAgdGhpcy5ldmVudENhbGxiYWNrID0gZXZlbnRDYWxsYmFjaztcbiAgICB0aGlzLnJlY29uY2lsZUNhbGxiYWNrID0gcmVjb25jaWxlQ2FsbGJhY2s7XG4gICAgdGhpcy5yZWNvcmRFdmVudHMgPSByZWNvcmRFdmVudHM7XG4gICAgaWYgKHJlY29uY2lsZUV2ZW50cykge1xuICAgICAgdGhpcy5yZWNvbmNpbGVFdmVudHMgPSByZWNvbmNpbGVFdmVudHM7XG4gICAgfVxuICB9XG5cbiAgYWRkQWxsTGlzdGVuZXJzID0gKCkgPT4ge1xuICAgIHRoaXMucmVjb3JkRXZlbnRzLmZvckVhY2goKGV2ZW50KSA9PiB7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5ldmVudENhbGxiYWNrLCB0cnVlKTtcbiAgICB9KTtcblxuICAgIHRoaXMucmVjb25jaWxlRXZlbnRzLmZvckVhY2goKGV2ZW50KSA9PiB7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5yZWNvbmNpbGVDYWxsYmFjaywgdHJ1ZSk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmVtb3ZlQWxsTGlzdGVuZXJzID0gKCkgPT4ge1xuICAgIHRoaXMucmVjb3JkRXZlbnRzLmZvckVhY2goKGV2ZW50KSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5ldmVudENhbGxiYWNrLCB0cnVlKTtcbiAgICB9KTtcbiAgICB0aGlzLnJlY29uY2lsZUV2ZW50cy5mb3JFYWNoKChldmVudDogUmVjb25jaWxlVHlwZSkgPT4ge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMucmVjb25jaWxlQ2FsbGJhY2ssIHRydWUpO1xuICAgIH0pO1xuICB9O1xuXG4gIHN0YXJ0ID0gKCkgPT4ge1xuICAgIGlmICghd2luZG93LnJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzKSB7XG4gICAgICB0aGlzLmFkZEFsbExpc3RlbmVycygpO1xuICAgICAgd2luZG93LnJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzID0gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgc3RvcCA9ICgpID0+IHtcbiAgICBpZiAod2luZG93LnJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzKSB7XG4gICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICAgICAgd2luZG93LnJlY29yZGVyQWRkZWRDb250cm9sTGlzdGVuZXJzID0gZmFsc2U7XG4gICAgfVxuICB9O1xufVxuIiwiaW1wb3J0IHtcbiAgZmluZFJlYWN0RWxlbWVudCxcbiAgZ2V0Q29vcmRpbmF0ZXMsXG4gIGdldENvbXBvbmVudE5hbWUsXG4gIGdldENvbXBvbmVudFByb3BzLFxuICBnZXRDb21wb25lbnRJbmZvXG59IGZyb20gXCIuL3V0aWxzXCI7XG5cblxuaW1wb3J0IEV2ZW50UmVjb3JkZXIgZnJvbSBcIi4vZXZlbnQtcmVjb3JkZXJcIjtcbmltcG9ydCBDbGllbnRJbnRlcmZhY2UgZnJvbSBcIi4vdHlwZXMvQ2xpZW50XCI7XG5pbXBvcnQgTWVzc2FnZSBmcm9tIFwiLi90eXBlcy9NZXNzYWdlXCI7XG5pbXBvcnQgeyBFdmVudFR5cGUgfSBmcm9tIFwiLi90eXBlcy9FdmVudFR5cGVcIjtcblxuaW50ZXJmYWNlIENvbXBvbmVudCB7IH1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXNzZXJ0bHlDbGllbnQgaW1wbGVtZW50cyBDbGllbnRJbnRlcmZhY2Uge1xuICBldmVudHNUb1JlY29yZDogRXZlbnRUeXBlW10gPSBbXCJjbGlja1wiLCBcImNoYW5nZVwiXTtcblxuICBwcml2YXRlIGV2ZW50UmVjb3JkZXI6IEV2ZW50UmVjb3JkZXI7XG4gIHByaXZhdGUgY29tcG9uZW50RXZlbnRDYWNoZTogTWVzc2FnZVtdID0gW107XG4gIHByaXZhdGUgcHJldmlvdXNDb21wb25lbnQ6IENvbXBvbmVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHByZXZpb3VzTXNnOiBNZXNzYWdlIHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5ldmVudFJlY29yZGVyID0gbmV3IEV2ZW50UmVjb3JkZXIoe1xuICAgICAgcmVjb3JkRXZlbnRzOiB0aGlzLmV2ZW50c1RvUmVjb3JkLFxuICAgICAgZXZlbnRDYWxsYmFjazogdGhpcy5yZWNvcmRFdmVudCxcbiAgICAgIHJlY29uY2lsZUNhbGxiYWNrOiB0aGlzLnJlY29uY2lsZUV2ZW50Q2FjaGUsXG4gICAgfSk7XG4gIH1cblxuICBzdGFydCA9ICgpID0+IHtcbiAgICB0aGlzLmV2ZW50UmVjb3JkZXIuc3RhcnQoKTtcbiAgfTtcblxuICBzdG9wID0gKCkgPT4ge1xuICAgIHRoaXMuZXZlbnRSZWNvcmRlci5zdG9wKCk7XG4gIH07XG5cbiAgY2xlYXJFdmVudENhY2hlID0gKCkgPT4ge1xuICAgIHRoaXMuY29tcG9uZW50RXZlbnRDYWNoZSA9IFtdO1xuICB9O1xuXG4gIHJlY29uY2lsZUV2ZW50Q2FjaGUgPSAoZXZlbnQ6IEV2ZW50KSA9PiB7XG4gICAgY29uc3QgcmVhY3RDb21wb25lbnQgPSBldmVudC50YXJnZXQgPyBmaW5kUmVhY3RFbGVtZW50KGV2ZW50LnRhcmdldCkgOiBudWxsO1xuICAgIGlmIChyZWFjdENvbXBvbmVudCAhPT0gdGhpcy5wcmV2aW91c0NvbXBvbmVudCkge1xuICAgICAgdGhpcy5jb21wb25lbnRFdmVudENhY2hlLmZvckVhY2goKG1zZykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnaW4gdGhlIHJlY29uY2lsZScpXG4gICAgICAgIHRoaXMuc2VuZEV2ZW50KG1zZyk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY2xlYXJFdmVudENhY2hlKCk7XG4gICAgfVxuICB9O1xuXG4gIGNyZWF0ZVBvcHVwTWVudSA9IChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XG4gICAgXG4gICAgY29uc3QgZXZlbnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKClcbiAgICBjb25zdCBkaXZJRCA9IFwiY29tcG9uZW50TWVudVwiICsgZXZlbnRUaW1lXG4gICAgY29uc3QgbW91c2VFdmVudCA9IGV2ZW50IGFzIE1vdXNlRXZlbnQ7XG4gICAgY29uc3QgbWVudURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJESVZcIik7XG5cbiAgICBjb25zdCBwcmV2aW91c01lbnVzID0gQXJyYXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjb21wb25lbnRNZW51JykpO1xuICAgIHByZXZpb3VzTWVudXM/Lm1hcCggKHZhbDphbnkpID0+IHZhbC5yZW1vdmUoKSlcblxuICAgIG1lbnVEaXYuc2V0QXR0cmlidXRlKFwiaWRcIiwgZGl2SUQpO1xuICAgIG1lbnVEaXYuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgJ2NvbXBvbmVudE1lbnUnKTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1lbnVEaXYpO1xuICAgIG1lbnVEaXYuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgbWVudURpdi5zdHlsZS5sZWZ0ID0gbW91c2VFdmVudC54ICsgJ3B4JztcbiAgICBtZW51RGl2LnN0eWxlLnRvcCA9IG1vdXNlRXZlbnQueSArJ3B4JztcbiAgICBtZW51RGl2LnN0eWxlLnpJbmRleCA9ICc1JztcblxuXG4gICAgLy8gY29uc3QgSGVhZGVyQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkJVVFRPTlwiKTsgICBcbiAgICAvLyBIZWFkZXJCdG4uc3R5bGUud2lkdGggPSAnMTUwcHgnO1xuICAgIC8vIEhlYWRlckJ0bi5pbm5lckhUTUwgPSAnQXNzZXJ0bHknO1xuICAgIC8vIChIZWFkZXJCdG4gYXMgSFRNTEJ1dHRvbkVsZW1lbnQpLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAvLyBtZW51RGl2LmFwcGVuZENoaWxkKEhlYWRlckJ0bik7ICAgXG4gICAgLy8gY29uc3QgYnIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnJcIik7XG4gICAgLy8gbWVudURpdi5hcHBlbmRDaGlsZChicik7ICAgXG5cbiAgICBtZXNzYWdlPy5jb21wb25lbnRJbmZvPy5tYXAoKHZhbDogYW55KSA9PiB7XG4gICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiQlVUVE9OXCIpOyAgIFxuICAgICAgYnRuLnN0eWxlLndpZHRoID0gJzE1MHB4JztcbiAgICAgIGJ0bi5pbm5lckhUTUwgPSB2YWw/LmNvbXBvbmVudE5hbWU7ICAgICAgICAgICAgICAgICBcbiAgICAgIGlmKGJ0bi5pbm5lckhUTUwpIHtcbiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5jb21wb25lbnRNZW51Q2xpY2soZXZlbnQsIGRpdklELCBtZXNzYWdlKSlcbiAgICAgICAgbWVudURpdi5hcHBlbmRDaGlsZChidG4pOyAgICAgICAgICAgICBcbiAgICAgICAgY29uc3QgYnIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnJcIik7XG4gICAgICAgIG1lbnVEaXYuYXBwZW5kQ2hpbGQoYnIpOyBcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3QgQ2FuY2VsQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkJVVFRPTlwiKTsgICBcbiAgICBDYW5jZWxCdG4uc3R5bGUud2lkdGggPSAnMTUwcHgnO1xuICAgIENhbmNlbEJ0bi5pbm5lckhUTUwgPSAnQ2FuY2VsJzsgIFxuICAgIENhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMucmVtb3ZlU2luZ2xlTWVudShkaXZJRCkpXG4gICAgbWVudURpdi5hcHBlbmRDaGlsZChDYW5jZWxCdG4pOyAgICAgXG4gIH1cblxuICByZW1vdmVTaW5nbGVNZW51ID0gKGRpdklEOiBhbnkpID0+IHtcbiAgICBjb25zdCBtZW51RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGl2SUQpO1xuICAgIG1lbnVEaXY/LnJlbW92ZSgpXG4gIH1cblxuICBjb21wb25lbnRNZW51Q2xpY2sgPSAoZXZlbnQ6IGFueSwgZGl2SUQ6IGFueSwgbWVzc2FnZTogTWVzc2FnZSk6IGFueSA9PiB7XG4gICAgY29uc29sZS5sb2coJ3RoaXMgaXMgdGhlIGNsaWNrIGNhbGwgYmFjazogJywgZXZlbnQpXG4gICAgY29uc29sZS5sb2coJ3RoaXMgaXMgdGhlIG1lc3NhZ2UgaW4gdGhlIGNhbGxiYWNrOiAnLCBtZXNzYWdlLmNvbXBvbmVudEluZm8pXG4gICAgZXZlbnQ/LnN0b3BQcm9wYWdhdGlvbigpXG4gICAgdGhpcy5zZW5kRXZlbnQoe1xuICAgICAgLi4ubWVzc2FnZSwgXG4gICAgICBjb21wb25lbnRJbmZvOiBtZXNzYWdlLmNvbXBvbmVudEluZm8/LmZpbHRlciggKHZhbDphbnkpID0+IHZhbC5jb21wb25lbnROYW1lID09PSBldmVudC50YXJnZXQ/LmlubmVySFRNTClcbiAgICB9KVxuXG4gICAgdGhpcy5yZW1vdmVTaW5nbGVNZW51KGRpdklEKVxuICAgIC8vIGNvbnN0IG1lbnVEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkaXZJRCk7XG4gICAgLy8gbWVudURpdj8ucmVtb3ZlKClcbiAgICBcbiAgfVxuXG4gIGdldE1lc3NhZ2UgPSAocmVhY3RDb21wb25lbnQ6IGFueSwgZXZlbnQ6IEtleWJvYXJkRXZlbnQgfCBFdmVudCApOiBNZXNzYWdlID0+IHtcbiAgICBcbiAgICAvLyBmdW5jdGlvbiB0byB1c2UgaW4gYXJyYXkgcmVkdWNlXG4gICAgY29uc3QgZmluZENsaWNrSGFuZGxlciA9IChhY2N1bXVsYXRvciA6IGFueSAsIGN1cnJlbnRWYWx1ZSA6IGFueSkgPT4ge1xuICAgICAgaWYgKGN1cnJlbnRWYWx1ZS5wcm9wcz8ub25DbGljaykge1xuICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAuLi5jdXJyZW50VmFsdWUgfX19O1xuXG4gICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQ7XG4gICAgY29uc3QgaW5wdXRUYXJnZXQgPSB0YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBsaW5rVGFyZ2V0ID0gdGFyZ2V0IGFzIEhUTUxMaW5rRWxlbWVudDtcblxuICAgIGNvbnN0IGNvbXBvbmVudEluZm8gPSBnZXRDb21wb25lbnRJbmZvKHJlYWN0Q29tcG9uZW50LCAxMCwgW10pXG5cbiAgICAvLyBmaW5kIHRoZSBjbG9zZXN0IGNsaWNrIGhhbmRsZXIgdGhhdCB3b3VsZCBoYXZlIGJlZW4gdHJpZ2dlcmVkXG4gICAgY29uc3QgY2xpY2tIYW5kbGVyID0gY29tcG9uZW50SW5mbz8uc2xpY2UoMCk/LnJldmVyc2UoKT8ucmVkdWNlKGZpbmRDbGlja0hhbmRsZXIse30pIHx8IG51bGxcblxuXG4gICAgLy8gY29uc29sZS5sb2coJ2NvbXBvbmVudCBpbmZvIGluIEdFVF9NRVNTQUdFOiAnLCBjb21wb25lbnRJbmZvLCBjbGlja0hhbmRsZXIpXG5cbiAgICBjb25zdCBtZXNzYWdlOiBNZXNzYWdlID0gIHtcbiAgICAgIC8vIGNvbXBvbmVudE5hbWUsIGZpbGVOYW1lLCBhbmQgbGluZU51bWJlciBhcmUgYWxyZWFkeSBpbiB0aGUgb2JqZWN0IHJldHVybmVkXG4gICAgICBhY3Rpb24gOiBldmVudC50eXBlLFxuICAgICAgY2hlY2tlZCA6IGV2ZW50Py50YXJnZXQ/Lmhhc093blByb3BlcnR5KFwiY2hlY2tlZFwiKVxuICAgICAgICA/IGlucHV0VGFyZ2V0LmNoZWNrZWRcbiAgICAgICAgOiBudWxsLFxuICAgICAgY29vcmRpbmF0ZXMgOiBnZXRDb29yZGluYXRlcyhldmVudCksXG4gICAgICBocmVmIDogbGlua1RhcmdldC5ocmVmID8gbGlua1RhcmdldC5ocmVmIDogbnVsbCxcbiAgICAgIGtleUNvZGUgOiAoZXZlbnQgYXMgS2V5Ym9hcmRFdmVudCkua2V5Q29kZVxuICAgICAgICA/IChldmVudCBhcyBLZXlib2FyZEV2ZW50KS5rZXlDb2RlXG4gICAgICAgIDogbnVsbCxcbiAgICAgIHRhZ05hbWUgOiBpbnB1dFRhcmdldC50YWdOYW1lLFxuICAgICAgdGFnVHlwZSA6IGlucHV0VGFyZ2V0LnR5cGUsXG4gICAgICB0ZXh0Q29udGVudCA6IGlucHV0VGFyZ2V0LnRleHRDb250ZW50IHx8IGlucHV0VGFyZ2V0LmlubmVyVGV4dCxcbiAgICAgIHRpbWVzdGFtcCA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgICAgdmFsdWUgOiBpbnB1dFRhcmdldC52YWx1ZSxcbiAgICAgIHdyaXRlVGVzdExvY2F0aW9uIDogJycsXG4gICAgICBjb21wb25lbnRJbmZvOiBjb21wb25lbnRJbmZvLFxuICAgICAgY2xpY2tIYW5kbGVyQ29tcG9uZW50OiBjbGlja0hhbmRsZXJcblxuICAgIH07XG5cbiAgICByZXR1cm4gbWVzc2FnZVxuICB9O1xuXG5cblxuICByZWNvcmRFdmVudCA9IChldmVudDogRXZlbnQpID0+IHtcbiAgICBjb25zdCBub2RlVGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIE5vZGU7XG4gICAgY29uc3QgbW91c2VFdmVudCA9IGV2ZW50IGFzIE1vdXNlRXZlbnQ7XG5cbiAgICAvLyBpZiB0aGUgY2xpY2sgaXMgb24gYSBtZW51IHRoYXQgcG9wcyB1cCwgZG9udCBnbyB0aHJvdWdoIHRoZSByZWNvcmQgZXZlbnQgbG9naWNcbiAgICBpZiAobm9kZVRhcmdldD8ucGFyZW50RWxlbWVudD8uZ2V0QXR0cmlidXRlKFwiaWRcIik/LmluY2x1ZGVzKCdjb21wb25lbnRNZW51JykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFldmVudC50YXJnZXQpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBpZiAodGhpcy5wcmV2aW91c01zZykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgKGV2ZW50LnR5cGUgPT09IFwiY2hhbmdlXCIgfHwgZXZlbnQudHlwZSA9PT0gXCJjbGlja1wiKSAmJlxuICAgICAgICAgIHRoaXMucHJldmlvdXNNc2cgJiZcbiAgICAgICAgICB0aGlzLnByZXZpb3VzTXNnLmFjdGlvbiA9PT0gXCJjbGlja1wiICYmXG4gICAgICAgICAgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLnByZXZpb3VzTXNnLnRpbWVzdGFtcCA8IDEwMFxuICAgICAgICApIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIm1lc3NhZ2Ugbm90IHNlbmQgZHVlIHRvIHRpbWVcIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlYWN0Q29tcG9uZW50ID0gZmluZFJlYWN0RWxlbWVudChldmVudC50YXJnZXQpO1xuICAgICAgY29uc3QgbXNnOiBNZXNzYWdlID0gdGhpcy5nZXRNZXNzYWdlKHJlYWN0Q29tcG9uZW50LCBldmVudCk7XG4gICAgICBjb25zb2xlLmxvZygncmVhY3RDb21wb25lbnQgYW5kIG1lc3NhZ2UgaW4gUkVDT1JEX0VWRU5UOiAnLCByZWFjdENvbXBvbmVudCwgbXNnKVxuXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImxhc3RFdmVudFwiLCBKU09OLnN0cmluZ2lmeShtc2cpKTtcbiAgICAgIHRoaXMucHJldmlvdXNNc2cgPSBtc2c7XG5cbiAgICAgIC8vIGlmIChcbiAgICAgIC8vICAgLy8gaWYgdGhlcmUgaXMgbm8gcHJldmlvdXMgY29tcG9uZW50IG9yIHRoZSBwcmV2aW91cyBjb21wb25lbnQgaXMgdGhlIHNhbWUgYXMgdGhlIGNvbXBvbmVudCB5b3UganVzdCBjbGlja2VkIG9uXG4gICAgICAvLyAgICF0aGlzLnByZXZpb3VzQ29tcG9uZW50IHx8XG4gICAgICAvLyAgICh0aGlzLnByZXZpb3VzQ29tcG9uZW50ICYmIHRoaXMucHJldmlvdXNDb21wb25lbnQgPT09IHJlYWN0Q29tcG9uZW50KVxuICAgICAgLy8gKSB7XG4gICAgICAvLyAgIHRoaXMucHJldmlvdXNDb21wb25lbnQgPSByZWFjdENvbXBvbmVudDtcbiAgICAgIC8vICAgaWYgKFxuICAgICAgLy8gICAgIHRoaXMucHJldmlvdXNDb21wb25lbnQgJiZcbiAgICAgIC8vICAgICBtc2cuY2hlY2tlZCAhPT0gbnVsbCAmJlxuICAgICAgLy8gICAgIG1zZy5hY3Rpb24gPT09IFwiY2xpY2tcIlxuICAgICAgLy8gICApIHtcbiAgICAgIC8vICAgICAvLyBtZXNzYWdlIGlzIHNlbnQgd2hlbiBzb21ldGhpbmcgaW4gdGhlIHBvcHVwIG1lbnUgaXMgc2VsZWN0ZWRcbiAgICAgIC8vICAgICB0aGlzLmNyZWF0ZVBvcHVwTWVudShtc2cpO1xuICAgICAgLy8gICAgIC8vIHRoaXMuc2VuZEV2ZW50KG1zZyk7XG4gICAgICAvLyAgICAgcmV0dXJuO1xuICAgICAgLy8gICB9XG5cbiAgICAgIC8vICAgLy9wdXNoaW5nIGEgbWVzc2FnZSB0byB0aGUgZXZlbnQgY2FjaGUgc2VuZHMgaXQgdG8gdGhlIGFwaSB3aGVuIHRoZSByZWNvbmNpbGUgY2FsbGJhY2sgaXMgY2FsbGVkXG4gICAgICAvLyAgIHRoaXMuY29tcG9uZW50RXZlbnRDYWNoZS5wdXNoKG1zZyk7XG5cbiAgICAgIC8vICAgcmV0dXJuO1xuICAgICAgLy8gfSBlbHNlIHtcbiAgICAgIC8vICAgdGhpcy5jbGVhckV2ZW50Q2FjaGUoKTtcbiAgICAgIC8vIH1cblxuICAgICAgdGhpcy5wcmV2aW91c0NvbXBvbmVudCA9IHJlYWN0Q29tcG9uZW50O1xuXG4gICAgICAvLyBtZXNzYWdlIGlzIHNlbnQgd2hlbiBzb21ldGhpbmcgaW4gdGhlIHBvcHVwIG1lbnUgaXMgc2VsZWN0ZWRcbiAgICAgIGlmIChtb3VzZUV2ZW50Py5tZXRhS2V5KSB0aGlzLmNyZWF0ZVBvcHVwTWVudShtc2cpO1xuICAgICAgLy8gdGhpcy5zZW5kRXZlbnQobXNnKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVjb3JkaW5nIGV2ZW50XCIsIGUpO1xuICAgIH1cbiAgfTtcblxuICBzZW5kRXZlbnQgPSBhc3luYyAobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xuICAgIC8vIGNvbnN0IGFjY291bnRJZCA9IHdpbmRvd1tcImRhdGFMYXllclwiXVswXVtcImFwaUtleVwiXTtcbiAgICBjb25zdCBhY2NvdW50SWQgPSAod2luZG93IGFzIHsgW2tleTogc3RyaW5nXTogYW55IH0pW1wiZGF0YUxheWVyXCJdWzBdW1wiYXBpS2V5XCJdXG4gICAgY29uc3Qgd3JpdGVMb2NhdGlvbiA9ICh3aW5kb3cgYXMgeyBba2V5OiBzdHJpbmddOiBhbnkgfSlbXCJkYXRhTGF5ZXJcIl1bMF1bXCJ0ZXN0TG9jYXRpb25cIl1cbiAgICBjb25zdCB1cmwgPSBgLy9sb2NhbGhvc3Q6MzAwMi9hcGkvYWNjb3VudHMvJHthY2NvdW50SWR9L2V2ZW50cy9gO1xuICAgIC8vIGNvbnNvbGUubG9nKCd0aGlzIGlzIHRoZSBtZXNzYWdlOiAnLCBtZXNzYWdlKTtcbiAgICAvLyBjb25zb2xlLmxvZygndGhpcyBpcyB0aGUgd3JpdGUgbG9jYXRpb246ICcsIHdyaXRlTG9jYXRpb24sIGFjY291bnRJZCk7XG4gICAgY29uc29sZS5sb2coJ3RoaXMgaXMgdGhlIG1lc3NhZ2UgaW4gU0VORF9FVkVOVDogJywgbWVzc2FnZSlcbiAgICBcbiAgICBtZXNzYWdlPy5jb21wb25lbnRJbmZvPy5tYXAoICh2YWw6YW55KSA9PiB7XG4gICAgICB2YWwud3JpdGVUZXN0TG9jYXRpb24gPSB3cml0ZUxvY2F0aW9uXG4gICAgICByZXR1cm4gdmFsXG4gICAgfSk7XG5cbiAgICBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBtb2RlOiBcImNvcnNcIixcbiAgICAgIGNhY2hlOiBcIm5vLWNhY2hlXCIsXG4gICAgICBjcmVkZW50aWFsczogXCJzYW1lLW9yaWdpblwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWYsXG4gICAgICAgIGV2ZW50OiBtZXNzYWdlLFxuICAgICAgICAvLyBUT0RPOiB0ZXN0IHNldCBpZCBzaG91bGQgYmUgc2V0IHdoZW4gY3JlYXRpbmcvbG9hZGluZyB0ZXN0c2V0IGluIHRoZSBydW5uZXJcbiAgICAgICAgcGxhY2Vob2xkZXI6IG51bGwsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfTtcbn1cblxuKDxhbnk+d2luZG93KS5ldmVudFJlY29yZGVyID0gbmV3IEFzc2VydGx5Q2xpZW50KCk7XG4oPGFueT53aW5kb3cpLmV2ZW50UmVjb3JkZXIuc3RhcnQoKTtcblxuIl0sInNvdXJjZVJvb3QiOiIifQ==