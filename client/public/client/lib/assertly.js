!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";function o(e,n,t){var r,i,l,s,u;if(!e||0===n)return t;if(null===(r=null==e?void 0:e._debugSource)||void 0===r?void 0:r.fileName){const r=function e(n,t={}){var o;if(!n)return c(t),t;const r=n.pendingProps?Object.assign(Object.assign({},t),n.pendingProps):t;if(delete r.children,(null===(o=null==n?void 0:n.type)||void 0===o?void 0:o.__proto__)&&["Component","PureComponent"].includes(n.type.__proto__.name))return c(r),r;return e(n._debugOwner,r)}(null==e?void 0:e._debugOwner),a=function e(n){if(!n)return null;if(n.elementType&&n.elementType.name)return n.elementType.name;if(n.elementType&&n.elementType.displayName)return n.elementType.displayName;if(n.type.displayName)return n.type.displayName;if(n.type.name)return n.type.name;return e(n._debugOwner)}(null==e?void 0:e._debugOwner);return t.push({filename:null===(i=null==e?void 0:e._debugSource)||void 0===i?void 0:i.fileName,linenumber:null===(l=null==e?void 0:e._debugSource)||void 0===l?void 0:l.lineNumber,props:r,componentName:"Component"===a?null===(u=null===(s=null==e?void 0:e._debugSource)||void 0===s?void 0:s.fileName)||void 0===u?void 0:u.split("\\").pop().split("/").pop().split(".")[0]:a}),o(null==e?void 0:e._debugOwner,n-1,t)}return o(null==e?void 0:e._debugOwner,n-1,t)}t.r(n),t.d(n,"default",(function(){return a}));const r={mouseup:!0,mousedown:!0,mousemove:!0,mouseover:!0};function i(e){const n=e;return r[e.type]?{x:n.clientX,y:n.clientY}:null}function l(e){const n=Object.keys(e).find(e=>e.startsWith("__reactInternalInstance$")),t=n?e[n]:null;return null==t?null:t}function c(e){for(let n in e)if(e[n]&&"[object Function]"==={}.toString.call(e[n]))try{e[n]="[Function]"}catch(e){console.error("Error stringifying prop",e)}!function(e){const n=Object.keys(e);for(const t of n)"[object Object]"!==Object.prototype.toString.call(e[t])||!e[t].hasOwnProperty("_owner")&&"inputRef"!==t&&"InputProps"!==t||delete e[t]}(e)}class s{constructor(e){this.recordEvents=[],this.reconcileEvents=["blur","focus","change"],this.addAllListeners=()=>{this.recordEvents.forEach(e=>{window.addEventListener(e,this.eventCallback,!0)}),this.reconcileEvents.forEach(e=>{window.addEventListener(e,this.reconcileCallback,!0)})},this.removeAllListeners=()=>{this.recordEvents.forEach(e=>{window.removeEventListener(e,this.eventCallback,!0)}),this.reconcileEvents.forEach(e=>{window.removeEventListener(e,this.reconcileCallback,!0)})},this.start=()=>{window.recorderAddedControlListeners||(this.addAllListeners(),window.recorderAddedControlListeners=!0)},this.stop=()=>{window.recorderAddedControlListeners&&(this.removeAllListeners(),window.recorderAddedControlListeners=!1)};const{eventCallback:n,reconcileCallback:t,recordEvents:o,reconcileEvents:r=null}=e;this.eventCallback=n,this.reconcileCallback=t,this.recordEvents=o,r&&(this.reconcileEvents=r)}}var u=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function l(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(l,c)}s((o=o.apply(e,n||[])).next())}))};class a{constructor(){this.eventsToRecord=["click","change"],this.componentEventCache=[],this.previousComponent=null,this.previousMsg=null,this.start=()=>{this.eventRecorder.start()},this.stop=()=>{this.eventRecorder.stop()},this.clearEventCache=()=>{this.componentEventCache=[]},this.reconcileEventCache=e=>{(e.target?l(e.target):null)!==this.previousComponent&&(this.componentEventCache.forEach(e=>{console.log("in the reconcile"),this.sendEvent(e)}),this.clearEventCache())},this.createPopupMenu=e=>{var n;const t="componentMenu"+(new Date).getTime(),o=event,r=document.createElement("DIV"),i=Array.from(document.getElementsByClassName("componentMenu"));null==i||i.map(e=>e.remove()),r.setAttribute("id",t),r.setAttribute("class","componentMenu"),document.body.appendChild(r),r.style.position="absolute",r.style.left=o.x+"px",r.style.top=o.y+"px",r.style.zIndex="5",null===(n=null==e?void 0:e.componentInfo)||void 0===n||n.map(n=>{console.log("button val: ",n);const o=document.createElement("BUTTON");if(o.style.width="150px",o.innerHTML=null==n?void 0:n.componentName,o.innerHTML){o.addEventListener("click",()=>this.componentMenuClick(event,t,e)),r.appendChild(o);const n=document.createElement("br");r.appendChild(n)}});const l=document.createElement("BUTTON");l.style.width="150px",l.innerHTML="Cancel",l.addEventListener("click",()=>this.removeSingleMenu(t)),r.appendChild(l)},this.removeSingleMenu=e=>{const n=document.getElementById(e);null==n||n.remove()},this.componentMenuClick=(e,n,t)=>{var o;const r=null===(o=t.componentInfo)||void 0===o?void 0:o.reduce((n,t)=>{var o;return t.componentName===(null===(o=e.target)||void 0===o?void 0:o.innerHTML)?Object.assign({},t):n},null);null==e||e.stopPropagation(),this.sendEvent(Object.assign(Object.assign({},t),{componentInfo:r})),this.removeSingleMenu(n)},this.getMessage=(e,n)=>{var t,r,l;const c=n.target||n.srcElement,s=c,u=c,a=o(e,10,[]),d=null===(r=null===(t=null==a?void 0:a.slice(0))||void 0===t?void 0:t.reverse())||void 0===r?void 0:r.reduce((e,n)=>{var t;return(null===(t=n.props)||void 0===t?void 0:t.onClick)?Object.assign({},n):e},null);return{action:n.type,checked:(null===(l=null==n?void 0:n.target)||void 0===l?void 0:l.hasOwnProperty("checked"))?s.checked:null,coordinates:i(n),href:u.href?u.href:null,keyCode:n.keyCode?n.keyCode:null,tagName:s.tagName,tagType:s.type,textContent:s.textContent||s.innerText,timestamp:(new Date).getTime(),value:s.value,writeTestLocation:"",componentInfo:a,clickHandlerComponent:d}},this.recordEvent=e=>{var n,t;const o=e.target,r=e;if(!(null===(t=null===(n=null==o?void 0:o.parentElement)||void 0===n?void 0:n.getAttribute("id"))||void 0===t?void 0:t.includes("componentMenu"))&&e.target)try{if(this.previousMsg&&("change"===e.type||"click"===e.type)&&this.previousMsg&&"click"===this.previousMsg.action&&(new Date).getTime()-this.previousMsg.timestamp<100)return void console.log("message not send due to time");const n=l(e.target),t=this.getMessage(n,e);localStorage.setItem("lastEvent",JSON.stringify(t)),this.previousMsg=t,this.previousComponent=n,(null==r?void 0:r.metaKey)&&this.createPopupMenu(t)}catch(e){console.error("Error recording event",e)}},this.sendEvent=e=>u(this,void 0,void 0,(function*(){const n=`//localhost:3002/api/accounts/${window.dataLayer[0].apiKey}/events/`;yield fetch(n,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:window.location.href,event:e,placeholder:null})})})),this.eventRecorder=new s({recordEvents:this.eventsToRecord,eventCallback:this.recordEvent,reconcileCallback:this.reconcileEventCache})}}window.eventRecorder=new a,window.eventRecorder.start()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovLy8uL3NyYy9ldmVudC1yZWNvcmRlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY2xpZW50LnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZ2V0Q29tcG9uZW50SW5mbyIsImNvbXBvbmVudCIsIm1heE5lc3QiLCJyZXN1bHRBcnJheSIsIl9kZWJ1Z1NvdXJjZSIsImZpbGVOYW1lIiwicHJvcHMiLCJnZXRDb21wb25lbnRQcm9wcyIsImZ1bmN0aW9uU3RyaW5naWZ5IiwibmV3UHJvcHMiLCJwZW5kaW5nUHJvcHMiLCJjaGlsZHJlbiIsInR5cGUiLCJfX3Byb3RvX18iLCJpbmNsdWRlcyIsIl9kZWJ1Z093bmVyIiwiZ2V0Q29tcG9uZW50TmFtZSIsImZpYmVyIiwiZWxlbWVudFR5cGUiLCJkaXNwbGF5TmFtZSIsInB1c2giLCJmaWxlbmFtZSIsImxpbmVudW1iZXIiLCJsaW5lTnVtYmVyIiwiY29tcG9uZW50TmFtZSIsInNwbGl0IiwicG9wIiwiZXZlbnRzV2l0aENvb3JkaW5hdGVzIiwibW91c2V1cCIsIm1vdXNlZG93biIsIm1vdXNlbW92ZSIsIm1vdXNlb3ZlciIsImdldENvb3JkaW5hdGVzIiwiZXZlbnQiLCJtb3VzZUV2ZW50IiwieCIsImNsaWVudFgiLCJ5IiwiY2xpZW50WSIsImZpbmRSZWFjdEVsZW1lbnQiLCJ0YXJnZXQiLCJrZXlzIiwiZmluZCIsInN0YXJ0c1dpdGgiLCJpbnRlcm5hbEluc3RhbmNlIiwib2JqIiwiayIsInRvU3RyaW5nIiwiZSIsImNvbnNvbGUiLCJlcnJvciIsInN0cmlwRXh0cmFDb21wb25lbnRQcm9wcyIsIkV2ZW50UmVjb3JkZXIiLCJjb25maWciLCJyZWNvcmRFdmVudHMiLCJyZWNvbmNpbGVFdmVudHMiLCJhZGRBbGxMaXN0ZW5lcnMiLCJ0aGlzIiwiZm9yRWFjaCIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudENhbGxiYWNrIiwicmVjb25jaWxlQ2FsbGJhY2siLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic3RhcnQiLCJyZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVycyIsInN0b3AiLCJldmVudHNUb1JlY29yZCIsImNvbXBvbmVudEV2ZW50Q2FjaGUiLCJwcmV2aW91c0NvbXBvbmVudCIsInByZXZpb3VzTXNnIiwiZXZlbnRSZWNvcmRlciIsImNsZWFyRXZlbnRDYWNoZSIsInJlY29uY2lsZUV2ZW50Q2FjaGUiLCJtc2ciLCJsb2ciLCJzZW5kRXZlbnQiLCJjcmVhdGVQb3B1cE1lbnUiLCJtZXNzYWdlIiwiZGl2SUQiLCJEYXRlIiwiZ2V0VGltZSIsIm1lbnVEaXYiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJwcmV2aW91c01lbnVzIiwiQXJyYXkiLCJmcm9tIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsIm1hcCIsInZhbCIsInJlbW92ZSIsInNldEF0dHJpYnV0ZSIsImJvZHkiLCJhcHBlbmRDaGlsZCIsInN0eWxlIiwicG9zaXRpb24iLCJsZWZ0IiwidG9wIiwiekluZGV4IiwiY29tcG9uZW50SW5mbyIsImJ0biIsIndpZHRoIiwiaW5uZXJIVE1MIiwiY29tcG9uZW50TWVudUNsaWNrIiwiYnIiLCJDYW5jZWxCdG4iLCJyZW1vdmVTaW5nbGVNZW51IiwiZ2V0RWxlbWVudEJ5SWQiLCJzZWxlY3RlZENvbXBvbmVudCIsInJlZHVjZSIsImFjYyIsImN1cnIiLCJzdG9wUHJvcGFnYXRpb24iLCJnZXRNZXNzYWdlIiwicmVhY3RDb21wb25lbnQiLCJzcmNFbGVtZW50IiwiaW5wdXRUYXJnZXQiLCJsaW5rVGFyZ2V0IiwiY2xpY2tIYW5kbGVyIiwic2xpY2UiLCJyZXZlcnNlIiwiYWNjdW11bGF0b3IiLCJjdXJyZW50VmFsdWUiLCJvbkNsaWNrIiwiYWN0aW9uIiwiY2hlY2tlZCIsImNvb3JkaW5hdGVzIiwiaHJlZiIsImtleUNvZGUiLCJ0YWdOYW1lIiwidGFnVHlwZSIsInRleHRDb250ZW50IiwiaW5uZXJUZXh0IiwidGltZXN0YW1wIiwid3JpdGVUZXN0TG9jYXRpb24iLCJjbGlja0hhbmRsZXJDb21wb25lbnQiLCJyZWNvcmRFdmVudCIsIm5vZGVUYXJnZXQiLCJwYXJlbnRFbGVtZW50IiwiZ2V0QXR0cmlidXRlIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXRhS2V5IiwidXJsIiwiZmV0Y2giLCJtZXRob2QiLCJjYWNoZSIsImNyZWRlbnRpYWxzIiwiaGVhZGVycyIsImxvY2F0aW9uIiwicGxhY2Vob2xkZXIiXSwibWFwcGluZ3MiOiJhQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQUtmRixFQUFvQlEsRUFBSUYsRUFHeEJOLEVBQW9CUyxFQUFJVixFQUd4QkMsRUFB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QUFNLGlDQUZPeEYsT0FBNkMsVUFBRSxHQUFXLHVCQVN2RXlGLE1BQU1ELEVBQUssQ0FDZkUsT0FBUSxPQUNSbEssS0FBTSxPQUNObUssTUFBTyxXQUNQQyxZQUFhLGNBQ2JDLFFBQVMsQ0FDUCxlQUFnQixvQkFFbEIxRCxLQUFNa0QsS0FBS0MsVUFBVSxDQUNuQkUsSUFBS3hGLE9BQU84RixTQUFTeEIsS0FDckJoRyxNQUFPOEMsRUFFUDJFLFlBQWEsWUF6T2pCakcsS0FBS2UsY0FBZ0IsSUFBSXBCLEVBQWMsQ0FDckNFLGFBQWNHLEtBQUtXLGVBQ25CUCxjQUFlSixLQUFLaUYsWUFDcEI1RSxrQkFBbUJMLEtBQUtpQix1QkE0T3hCZixPQUFRYSxjQUFnQixJQUFJLEVBQzVCYixPQUFRYSxjQUFjUCIsImZpbGUiOiJhc3NlcnRseS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCBDb29yZGluYXRlcyBmcm9tIFwiLi90eXBlcy9Db29yZGluYXRlc1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29tcG9uZW50SW5mbyhjb21wb25lbnQ6IGFueSwgbWF4TmVzdDogbnVtYmVyLCByZXN1bHRBcnJheTogYW55KTogYW55IHtcbiAgXG5cbiAgLy8gY29uc29sZS5sb2coJ2ZpbmRGaWxlTmFtZTogJywgY29tcG9uZW50KVxuXG4gIGlmICghY29tcG9uZW50IHx8IG1heE5lc3QgPT09IDApIHtcbiAgICAvLyBjb25zb2xlLmxvZygncmVzdWx0QXJyYXk6ICcsIHJlc3VsdEFycmF5KVxuICAgIHJldHVybiByZXN1bHRBcnJheVxuICB9XG5cbiAgaWYgKGNvbXBvbmVudD8uX2RlYnVnU291cmNlPy5maWxlTmFtZSkge1xuICAgIC8vIHRoZSBvd25lciBvZiB0aGUgbm9kZSB3aGVyZSB0aGUgJ3NvdXJjZScgZmlsZW5hbWUgZXhpc3RzIGlzIHRoZSBmaWxlIHRoYXQgeW91IHdhbnQgdGhlIHByb3BzIGZvciBcbiAgICBjb25zdCBwcm9wcyA9IGdldENvbXBvbmVudFByb3BzKGNvbXBvbmVudD8uX2RlYnVnT3duZXIpXG4gICAgY29uc3QgbmFtZSA9IGdldENvbXBvbmVudE5hbWUoY29tcG9uZW50Py5fZGVidWdPd25lcilcbiAgICByZXN1bHRBcnJheS5wdXNoKHtcbiAgICAgIGZpbGVuYW1lOiBjb21wb25lbnQ/Ll9kZWJ1Z1NvdXJjZT8uZmlsZU5hbWUsIFxuICAgICAgLy8gdGhlIGxpbmUgbnVtYmVyIGlzIHJlYWxseSBmb3IgdGhlIG5leHQgY29tcG9uZW50IGRvd24gaW4gdGhlIHRyZWUgdGhhdCBpcyBiZWluZyBjYWxsZWQgZnJvbSB0aGUgJ2ZpbGVuYW1lJ1xuICAgICAgbGluZW51bWJlcjogY29tcG9uZW50Py5fZGVidWdTb3VyY2U/LmxpbmVOdW1iZXIsIFxuICAgICAgcHJvcHM6IHByb3BzLCBcbiAgICAgIC8vIGlmIGl0J3MgY29tcG9uZW50ICBzdHIuc3BsaXQoJ1xcXFwnKS5wb3Auc3BsaXQoYC9gKS5wb3AoKS5zcGxpdCgnLicpWzBdXG4gICAgICBjb21wb25lbnROYW1lOiBuYW1lID09PSAnQ29tcG9uZW50JyA/IFxuICAgICAgICBjb21wb25lbnQ/Ll9kZWJ1Z1NvdXJjZT8uZmlsZU5hbWU/LnNwbGl0KCdcXFxcJykucG9wKCkuc3BsaXQoYC9gKS5wb3AoKS5zcGxpdCgnLicpWzBdIDogbmFtZVxuICAgIH0pXG4gICAgcmV0dXJuIGdldENvbXBvbmVudEluZm8oY29tcG9uZW50Py5fZGVidWdPd25lcixtYXhOZXN0LTEscmVzdWx0QXJyYXkpXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGdldENvbXBvbmVudEluZm8oY29tcG9uZW50Py5fZGVidWdPd25lcixtYXhOZXN0LTEscmVzdWx0QXJyYXkpXG4gIH1cblxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29tcG9uZW50UHJvcHMoY29tcG9uZW50OiBhbnksIHByb3BzID0ge30pOiBhbnkge1xuICBpZiAoIWNvbXBvbmVudCkge1xuICAgIGZ1bmN0aW9uU3RyaW5naWZ5KHByb3BzKTtcbiAgICByZXR1cm4gcHJvcHM7XG4gIH1cblxuICBjb25zdCBuZXdQcm9wcyA9IGNvbXBvbmVudC5wZW5kaW5nUHJvcHNcbiAgICA/IHsgLi4ucHJvcHMsIC4uLmNvbXBvbmVudC5wZW5kaW5nUHJvcHMgfVxuICAgIDogcHJvcHM7XG4gIGRlbGV0ZSBuZXdQcm9wcy5jaGlsZHJlbjtcblxuICBpZiAoXG4gICAgY29tcG9uZW50Py50eXBlPy5fX3Byb3RvX18gJiZcbiAgICBbXCJDb21wb25lbnRcIiwgXCJQdXJlQ29tcG9uZW50XCJdLmluY2x1ZGVzKGNvbXBvbmVudC50eXBlLl9fcHJvdG9fXy5uYW1lKVxuICApIHtcbiAgICBmdW5jdGlvblN0cmluZ2lmeShuZXdQcm9wcyk7XG4gICAgcmV0dXJuIG5ld1Byb3BzO1xuICB9XG5cbiAgcmV0dXJuIGdldENvbXBvbmVudFByb3BzKGNvbXBvbmVudC5fZGVidWdPd25lciwgbmV3UHJvcHMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29tcG9uZW50TmFtZShmaWJlcjogYW55KTogYW55IHtcbiAgaWYgKCFmaWJlcikgcmV0dXJuIG51bGw7XG5cbiAgaWYgKGZpYmVyLmVsZW1lbnRUeXBlICYmIGZpYmVyLmVsZW1lbnRUeXBlLm5hbWUpIHtcbiAgICByZXR1cm4gZmliZXIuZWxlbWVudFR5cGUubmFtZTtcbiAgfVxuXG4gIGlmIChmaWJlci5lbGVtZW50VHlwZSAmJiBmaWJlci5lbGVtZW50VHlwZS5kaXNwbGF5TmFtZSkge1xuICAgIHJldHVybiBmaWJlci5lbGVtZW50VHlwZS5kaXNwbGF5TmFtZTtcbiAgfVxuXG4gIGlmIChmaWJlci50eXBlLmRpc3BsYXlOYW1lKSB7XG4gICAgcmV0dXJuIGZpYmVyLnR5cGUuZGlzcGxheU5hbWU7XG4gIH1cblxuICBpZiAoZmliZXIudHlwZS5uYW1lKSB7XG4gICAgcmV0dXJuIGZpYmVyLnR5cGUubmFtZTtcbiAgfVxuICByZXR1cm4gZ2V0Q29tcG9uZW50TmFtZShmaWJlci5fZGVidWdPd25lcik7XG59XG5cbmNvbnN0IGV2ZW50c1dpdGhDb29yZGluYXRlczogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHtcbiAgbW91c2V1cDogdHJ1ZSxcbiAgbW91c2Vkb3duOiB0cnVlLFxuICBtb3VzZW1vdmU6IHRydWUsXG4gIG1vdXNlb3ZlcjogdHJ1ZSxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb29yZGluYXRlcyhldmVudDogRXZlbnQpOiBDb29yZGluYXRlcyB8IG51bGwge1xuICBjb25zdCBtb3VzZUV2ZW50ID0gZXZlbnQgYXMgTW91c2VFdmVudDtcblxuICByZXR1cm4gZXZlbnRzV2l0aENvb3JkaW5hdGVzW2V2ZW50LnR5cGVdXG4gICAgPyB7IHg6IG1vdXNlRXZlbnQuY2xpZW50WCwgeTogbW91c2VFdmVudC5jbGllbnRZIH1cbiAgICA6IG51bGw7XG59XG5cbi8vIG1hcCByZWFjdCBjbGFzc2VzIHRvIGRvbSBlbGVtZW50c1xuZXhwb3J0IGZ1bmN0aW9uIGZpbmRSZWFjdEVsZW1lbnQodGFyZ2V0OiBFdmVudFRhcmdldCk6IGFueSB7XG4gIC8vIGNvbnNvbGUuZGlyKHRhcmdldClcbiAgY29uc3Qga2V5ID0gT2JqZWN0LmtleXModGFyZ2V0KS5maW5kKChrZXkpID0+XG4gICAga2V5LnN0YXJ0c1dpdGgoXCJfX3JlYWN0SW50ZXJuYWxJbnN0YW5jZSRcIilcbiAgKTtcbiAgLy8gY29uc29sZS5sb2coJ2tleTogJywga2V5KVxuICAvLyBjcmVhdGVzIGFuIG9iamVjdCBvdXQgb2YgdGhlIHRhcmdldCBwYXNzZWRcbiAgY29uc3QgdGFyZ2V0TWFwID0gdGFyZ2V0IGFzIHsgW2tleTogc3RyaW5nXTogYW55IH07XG5cbiAgY29uc3QgaW50ZXJuYWxJbnN0YW5jZSA9IGtleSA/IHRhcmdldE1hcFtrZXldIDogbnVsbDtcbiAgLy8gY29uc29sZS5sb2coJ1JlYWN0IE5vZGUgaWYgRm91bmQ6ICcsIGludGVybmFsSW5zdGFuY2UpXG4gIGlmIChpbnRlcm5hbEluc3RhbmNlID09IG51bGwpIHJldHVybiBudWxsO1xuXG4gIC8vIGNvbnNvbGUubG9nKCdpbnRlcm5hbEluc3RhbmNlMjogJywgaW50ZXJuYWxJbnN0YW5jZSlcbiAgLy8gcmV0dXJuIGludGVybmFsSW5zdGFuY2UuX2RlYnVnT3duZXJcbiAgLy8gICA/IGludGVybmFsSW5zdGFuY2UuX2RlYnVnT3duZXIuc3RhdGVOb2RlXG4gIC8vICAgOiBpbnRlcm5hbEluc3RhbmNlLnJldHVybi5zdGF0ZU5vZGU7XG5cbiAgcmV0dXJuIGludGVybmFsSW5zdGFuY2U7XG5cbiAgLy8gZm9yIChsZXQga2V5OiBzdHJpbmcgaW4gdGFyZ2V0KSB7XG4gIC8vICAgaWYgKGtleS5zdGFydHNXaXRoKFwiX19yZWFjdEludGVybmFsSW5zdGFuY2UkXCIpKSB7XG4gIC8vICAgICAvLyBjb25zb2xlLmxvZygna2V5cyBpbiB0aGUgZmluZCBSZWFjdEVsZW1lbnQnLCB0YXJnZXRba2V5XSlcbiAgLy8gICAgIHJldHVybiB0YXJnZXRba2V5XTtcbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmdW5jdGlvblN0cmluZ2lmeShvYmo6IGFueSk6IHZvaWQge1xuICBmb3IgKGxldCBrIGluIG9iaikge1xuICAgIGlmIChvYmpba10gJiYge30udG9TdHJpbmcuY2FsbChvYmpba10pID09PSBcIltvYmplY3QgRnVuY3Rpb25dXCIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIG9ialtrXSA9IFwiXCIgKyBvYmpba107XG4gICAgICAgIC8vIC8vIGdldCByaWQgb2YgdGhlIGV4dHJhIGxpbmUgbWFya2Vyc1xuICAgICAgICAvLyBvYmpba10gPSBvYmpba10ucmVwbGFjZSgvKFxcclxcbnxcXG58XFxyKS9nbSwgXCJcIik7XG4gICAgICAgIG9ialtrXSA9IFwiW0Z1bmN0aW9uXVwiXG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzdHJpbmdpZnlpbmcgcHJvcFwiLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgc3RyaXBFeHRyYUNvbXBvbmVudFByb3BzKG9iaik7XG59XG5cblxuXG5mdW5jdGlvbiBzdHJpcEV4dHJhQ29tcG9uZW50UHJvcHMocHJvcHM6IGFueSk6IHZvaWQge1xuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocHJvcHMpO1xuICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgaWYgKFxuICAgICAgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHByb3BzW2tleV0pID09PSBcIltvYmplY3QgT2JqZWN0XVwiICYmXG4gICAgICAocHJvcHNba2V5XS5oYXNPd25Qcm9wZXJ0eShcIl9vd25lclwiKSB8fFxuICAgICAgICBrZXkgPT09IFwiaW5wdXRSZWZcIiB8fFxuICAgICAgICBrZXkgPT09IFwiSW5wdXRQcm9wc1wiKVxuICAgICkge1xuICAgICAgZGVsZXRlIHByb3BzW2tleV07XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBFdmVudFR5cGUsIFJlY29uY2lsZVR5cGUgfSBmcm9tIFwiLi90eXBlcy9FdmVudFR5cGVcIjtcbmltcG9ydCB7IFJlY29yZGVyQ29uZmlnIH0gZnJvbSBcIi4vdHlwZXMvUmVjb3JkZXJDb25maWdcIjtcblxuZGVjbGFyZSBnbG9iYWwge1xuICBpbnRlcmZhY2UgV2luZG93IHtcbiAgICByZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVyczogYm9vbGVhbjtcbiAgICBkYXRhTGF5ZXI6IGFueVtdO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV2ZW50UmVjb3JkZXIge1xuICBwcml2YXRlIGV2ZW50Q2FsbGJhY2s6IChldmVudDogRXZlbnQpID0+IGFueTtcbiAgcHJpdmF0ZSByZWNvbmNpbGVDYWxsYmFjazogKGV2ZW50OiBFdmVudCkgPT4gYW55O1xuICBwcml2YXRlIHJlY29yZEV2ZW50czogRXZlbnRUeXBlW10gPSBbXTtcbiAgcHJpdmF0ZSByZWNvbmNpbGVFdmVudHM6IFJlY29uY2lsZVR5cGVbXSA9IFtcImJsdXJcIiwgXCJmb2N1c1wiLCBcImNoYW5nZVwiXTtcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFJlY29yZGVyQ29uZmlnKSB7XG4gICAgY29uc3Qge1xuICAgICAgZXZlbnRDYWxsYmFjayxcbiAgICAgIHJlY29uY2lsZUNhbGxiYWNrLFxuICAgICAgcmVjb3JkRXZlbnRzLFxuICAgICAgcmVjb25jaWxlRXZlbnRzID0gbnVsbCxcbiAgICB9ID0gY29uZmlnO1xuICAgIHRoaXMuZXZlbnRDYWxsYmFjayA9IGV2ZW50Q2FsbGJhY2s7XG4gICAgdGhpcy5yZWNvbmNpbGVDYWxsYmFjayA9IHJlY29uY2lsZUNhbGxiYWNrO1xuICAgIHRoaXMucmVjb3JkRXZlbnRzID0gcmVjb3JkRXZlbnRzO1xuICAgIGlmIChyZWNvbmNpbGVFdmVudHMpIHtcbiAgICAgIHRoaXMucmVjb25jaWxlRXZlbnRzID0gcmVjb25jaWxlRXZlbnRzO1xuICAgIH1cbiAgfVxuXG4gIGFkZEFsbExpc3RlbmVycyA9ICgpID0+IHtcbiAgICB0aGlzLnJlY29yZEV2ZW50cy5mb3JFYWNoKChldmVudCkgPT4ge1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMuZXZlbnRDYWxsYmFjaywgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlY29uY2lsZUV2ZW50cy5mb3JFYWNoKChldmVudCkgPT4ge1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMucmVjb25jaWxlQ2FsbGJhY2ssIHRydWUpO1xuICAgIH0pO1xuICB9O1xuXG4gIHJlbW92ZUFsbExpc3RlbmVycyA9ICgpID0+IHtcbiAgICB0aGlzLnJlY29yZEV2ZW50cy5mb3JFYWNoKChldmVudCkgPT4ge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMuZXZlbnRDYWxsYmFjaywgdHJ1ZSk7XG4gICAgfSk7XG4gICAgdGhpcy5yZWNvbmNpbGVFdmVudHMuZm9yRWFjaCgoZXZlbnQ6IFJlY29uY2lsZVR5cGUpID0+IHtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCB0aGlzLnJlY29uY2lsZUNhbGxiYWNrLCB0cnVlKTtcbiAgICB9KTtcbiAgfTtcblxuICBzdGFydCA9ICgpID0+IHtcbiAgICBpZiAoIXdpbmRvdy5yZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVycykge1xuICAgICAgdGhpcy5hZGRBbGxMaXN0ZW5lcnMoKTtcbiAgICAgIHdpbmRvdy5yZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVycyA9IHRydWU7XG4gICAgfVxuICB9O1xuXG4gIHN0b3AgPSAoKSA9PiB7XG4gICAgaWYgKHdpbmRvdy5yZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVycykge1xuICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICAgIHdpbmRvdy5yZWNvcmRlckFkZGVkQ29udHJvbExpc3RlbmVycyA9IGZhbHNlO1xuICAgIH1cbiAgfTtcbn1cbiIsImltcG9ydCB7XG4gIGZpbmRSZWFjdEVsZW1lbnQsXG4gIGdldENvb3JkaW5hdGVzLFxuICBnZXRDb21wb25lbnROYW1lLFxuICBnZXRDb21wb25lbnRQcm9wcyxcbiAgZ2V0Q29tcG9uZW50SW5mb1xufSBmcm9tIFwiLi91dGlsc1wiO1xuXG5cbmltcG9ydCBFdmVudFJlY29yZGVyIGZyb20gXCIuL2V2ZW50LXJlY29yZGVyXCI7XG5pbXBvcnQgQ2xpZW50SW50ZXJmYWNlIGZyb20gXCIuL3R5cGVzL0NsaWVudFwiO1xuaW1wb3J0IE1lc3NhZ2UgZnJvbSBcIi4vdHlwZXMvTWVzc2FnZVwiO1xuaW1wb3J0IHsgRXZlbnRUeXBlIH0gZnJvbSBcIi4vdHlwZXMvRXZlbnRUeXBlXCI7XG5cbmludGVyZmFjZSBDb21wb25lbnQgeyB9XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFzc2VydGx5Q2xpZW50IGltcGxlbWVudHMgQ2xpZW50SW50ZXJmYWNlIHtcbiAgZXZlbnRzVG9SZWNvcmQ6IEV2ZW50VHlwZVtdID0gW1wiY2xpY2tcIiwgXCJjaGFuZ2VcIl07XG5cbiAgcHJpdmF0ZSBldmVudFJlY29yZGVyOiBFdmVudFJlY29yZGVyO1xuICBwcml2YXRlIGNvbXBvbmVudEV2ZW50Q2FjaGU6IE1lc3NhZ2VbXSA9IFtdO1xuICBwcml2YXRlIHByZXZpb3VzQ29tcG9uZW50OiBDb21wb25lbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBwcmV2aW91c01zZzogTWVzc2FnZSB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZXZlbnRSZWNvcmRlciA9IG5ldyBFdmVudFJlY29yZGVyKHtcbiAgICAgIHJlY29yZEV2ZW50czogdGhpcy5ldmVudHNUb1JlY29yZCxcbiAgICAgIGV2ZW50Q2FsbGJhY2s6IHRoaXMucmVjb3JkRXZlbnQsXG4gICAgICByZWNvbmNpbGVDYWxsYmFjazogdGhpcy5yZWNvbmNpbGVFdmVudENhY2hlLFxuICAgIH0pO1xuICB9XG5cbiAgc3RhcnQgPSAoKSA9PiB7XG4gICAgdGhpcy5ldmVudFJlY29yZGVyLnN0YXJ0KCk7XG4gIH07XG5cbiAgc3RvcCA9ICgpID0+IHtcbiAgICB0aGlzLmV2ZW50UmVjb3JkZXIuc3RvcCgpO1xuICB9O1xuXG4gIGNsZWFyRXZlbnRDYWNoZSA9ICgpID0+IHtcbiAgICB0aGlzLmNvbXBvbmVudEV2ZW50Q2FjaGUgPSBbXTtcbiAgfTtcblxuICByZWNvbmNpbGVFdmVudENhY2hlID0gKGV2ZW50OiBFdmVudCkgPT4ge1xuICAgIGNvbnN0IHJlYWN0Q29tcG9uZW50ID0gZXZlbnQudGFyZ2V0ID8gZmluZFJlYWN0RWxlbWVudChldmVudC50YXJnZXQpIDogbnVsbDtcbiAgICBpZiAocmVhY3RDb21wb25lbnQgIT09IHRoaXMucHJldmlvdXNDb21wb25lbnQpIHtcbiAgICAgIHRoaXMuY29tcG9uZW50RXZlbnRDYWNoZS5mb3JFYWNoKChtc2cpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2luIHRoZSByZWNvbmNpbGUnKVxuICAgICAgICB0aGlzLnNlbmRFdmVudChtc2cpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNsZWFyRXZlbnRDYWNoZSgpO1xuICAgIH1cbiAgfTtcblxuICBjcmVhdGVQb3B1cE1lbnUgPSAobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xuXG4gICAgY29uc3QgZXZlbnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKClcbiAgICBjb25zdCBkaXZJRCA9IFwiY29tcG9uZW50TWVudVwiICsgZXZlbnRUaW1lXG4gICAgY29uc3QgbW91c2VFdmVudCA9IGV2ZW50IGFzIE1vdXNlRXZlbnQ7XG4gICAgY29uc3QgbWVudURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJESVZcIik7XG5cbiAgICBjb25zdCBwcmV2aW91c01lbnVzID0gQXJyYXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjb21wb25lbnRNZW51JykpO1xuICAgIHByZXZpb3VzTWVudXM/Lm1hcCgodmFsOiBhbnkpID0+IHZhbC5yZW1vdmUoKSlcblxuICAgIG1lbnVEaXYuc2V0QXR0cmlidXRlKFwiaWRcIiwgZGl2SUQpO1xuICAgIG1lbnVEaXYuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgJ2NvbXBvbmVudE1lbnUnKTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1lbnVEaXYpO1xuICAgIG1lbnVEaXYuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgbWVudURpdi5zdHlsZS5sZWZ0ID0gbW91c2VFdmVudC54ICsgJ3B4JztcbiAgICBtZW51RGl2LnN0eWxlLnRvcCA9IG1vdXNlRXZlbnQueSArICdweCc7XG4gICAgbWVudURpdi5zdHlsZS56SW5kZXggPSAnNSc7XG5cbiAgICBtZXNzYWdlPy5jb21wb25lbnRJbmZvPy5tYXAoKHZhbDogYW55KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcImJ1dHRvbiB2YWw6IFwiLCB2YWwpO1xuICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIkJVVFRPTlwiKTtcbiAgICAgIGJ0bi5zdHlsZS53aWR0aCA9ICcxNTBweCc7XG4gICAgICBidG4uaW5uZXJIVE1MID0gdmFsPy5jb21wb25lbnROYW1lO1xuICAgICAgaWYgKGJ0bi5pbm5lckhUTUwpIHtcbiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5jb21wb25lbnRNZW51Q2xpY2soZXZlbnQsIGRpdklELCBtZXNzYWdlKSlcbiAgICAgICAgbWVudURpdi5hcHBlbmRDaGlsZChidG4pO1xuICAgICAgICBjb25zdCBiciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJiclwiKTtcbiAgICAgICAgbWVudURpdi5hcHBlbmRDaGlsZChicik7XG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IENhbmNlbEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJCVVRUT05cIik7XG4gICAgQ2FuY2VsQnRuLnN0eWxlLndpZHRoID0gJzE1MHB4JztcbiAgICBDYW5jZWxCdG4uaW5uZXJIVE1MID0gJ0NhbmNlbCc7XG4gICAgQ2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5yZW1vdmVTaW5nbGVNZW51KGRpdklEKSlcbiAgICBtZW51RGl2LmFwcGVuZENoaWxkKENhbmNlbEJ0bik7XG4gIH1cblxuICByZW1vdmVTaW5nbGVNZW51ID0gKGRpdklEOiBhbnkpID0+IHtcbiAgICBjb25zdCBtZW51RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGl2SUQpO1xuICAgIG1lbnVEaXY/LnJlbW92ZSgpXG4gIH1cblxuICBjb21wb25lbnRNZW51Q2xpY2sgPSAoZXZlbnQ6IGFueSwgZGl2SUQ6IGFueSwgbWVzc2FnZTogTWVzc2FnZSk6IGFueSA9PiB7XG4gICAgLy8gY29uc29sZS5sb2coJ3RoaXMgaXMgdGhlIGNsaWNrIGNhbGwgYmFjazogJywgZXZlbnQpXG5cbiAgICBjb25zdCBzZWxlY3RlZENvbXBvbmVudCA9IG1lc3NhZ2UuY29tcG9uZW50SW5mbz8ucmVkdWNlKFxuICAgICAgKGFjYzogYW55LCBjdXJyOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKGN1cnIuY29tcG9uZW50TmFtZSA9PT0gZXZlbnQudGFyZ2V0Py5pbm5lckhUTUwpIHtcbiAgICAgICAgICByZXR1cm4geyAuLi5jdXJyIH1cbiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGFjYyB9XG4gICAgICB9LCBudWxsKVxuXG4gICAgZXZlbnQ/LnN0b3BQcm9wYWdhdGlvbigpXG4gICAgdGhpcy5zZW5kRXZlbnQoe1xuICAgICAgLi4ubWVzc2FnZSxcbiAgICAgIC8vIHRoZXJlIHNob3VsZCBvbmx5IGJlIG9uZSBtYXRjaCBoZXJlIG9uIHRoZSBmaWx0ZXJcbiAgICAgIC8vIGNvbXBvbmVudEluZm86IG1lc3NhZ2UuY29tcG9uZW50SW5mbz8uZmlsdGVyKCAodmFsOmFueSkgPT4gdmFsLmNvbXBvbmVudE5hbWUgPT09IGV2ZW50LnRhcmdldD8uaW5uZXJIVE1MKVxuICAgICAgY29tcG9uZW50SW5mbzogc2VsZWN0ZWRDb21wb25lbnRcbiAgICB9KVxuXG4gICAgdGhpcy5yZW1vdmVTaW5nbGVNZW51KGRpdklEKVxuICAgIC8vIGNvbnN0IG1lbnVEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkaXZJRCk7XG4gICAgLy8gbWVudURpdj8ucmVtb3ZlKClcblxuICB9XG5cbiAgZ2V0TWVzc2FnZSA9IChyZWFjdENvbXBvbmVudDogYW55LCBldmVudDogS2V5Ym9hcmRFdmVudCB8IEV2ZW50KTogTWVzc2FnZSA9PiB7XG5cbiAgICAvLyBmdW5jdGlvbiB0byB1c2UgaW4gYXJyYXkgcmVkdWNlXG4gICAgY29uc3QgZmluZENsaWNrSGFuZGxlciA9IChhY2N1bXVsYXRvcjogYW55LCBjdXJyZW50VmFsdWU6IGFueSkgPT4ge1xuICAgICAgaWYgKGN1cnJlbnRWYWx1ZS5wcm9wcz8ub25DbGljaykge1xuICAgICAgICByZXR1cm4gey4uLmN1cnJlbnRWYWx1ZX1cbiAgICAgIH0gZWxzZSB7IHJldHVybiBhY2N1bXVsYXRvciB9XG4gICAgfTtcblxuICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldCB8fCBldmVudC5zcmNFbGVtZW50O1xuICAgIGNvbnN0IGlucHV0VGFyZ2V0ID0gdGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgbGlua1RhcmdldCA9IHRhcmdldCBhcyBIVE1MTGlua0VsZW1lbnQ7XG5cbiAgICBjb25zdCBjb21wb25lbnRJbmZvID0gZ2V0Q29tcG9uZW50SW5mbyhyZWFjdENvbXBvbmVudCwgMTAsIFtdKVxuXG4gICAgLy8gZmluZCB0aGUgY2xvc2VzdCBjbGljayBoYW5kbGVyIHRoYXQgd291bGQgaGF2ZSBiZWVuIHRyaWdnZXJlZFxuICAgIGNvbnN0IGNsaWNrSGFuZGxlciA9IGNvbXBvbmVudEluZm8/LnNsaWNlKDApPy5yZXZlcnNlKCk/LnJlZHVjZShmaW5kQ2xpY2tIYW5kbGVyLCBudWxsKVxuXG5cbiAgICAvLyBjb25zb2xlLmxvZygnY29tcG9uZW50IGluZm8gaW4gR0VUX01FU1NBR0U6ICcsIGNvbXBvbmVudEluZm8sIGNsaWNrSGFuZGxlcilcblxuICAgIGNvbnN0IG1lc3NhZ2U6IE1lc3NhZ2UgPSB7XG4gICAgICAvLyBjb21wb25lbnROYW1lLCBmaWxlTmFtZSwgYW5kIGxpbmVOdW1iZXIgYXJlIGFscmVhZHkgaW4gdGhlIG9iamVjdCByZXR1cm5lZFxuICAgICAgYWN0aW9uOiBldmVudC50eXBlLFxuICAgICAgY2hlY2tlZDogZXZlbnQ/LnRhcmdldD8uaGFzT3duUHJvcGVydHkoXCJjaGVja2VkXCIpXG4gICAgICAgID8gaW5wdXRUYXJnZXQuY2hlY2tlZFxuICAgICAgICA6IG51bGwsXG4gICAgICBjb29yZGluYXRlczogZ2V0Q29vcmRpbmF0ZXMoZXZlbnQpLFxuICAgICAgaHJlZjogbGlua1RhcmdldC5ocmVmID8gbGlua1RhcmdldC5ocmVmIDogbnVsbCxcbiAgICAgIGtleUNvZGU6IChldmVudCBhcyBLZXlib2FyZEV2ZW50KS5rZXlDb2RlXG4gICAgICAgID8gKGV2ZW50IGFzIEtleWJvYXJkRXZlbnQpLmtleUNvZGVcbiAgICAgICAgOiBudWxsLFxuICAgICAgdGFnTmFtZTogaW5wdXRUYXJnZXQudGFnTmFtZSxcbiAgICAgIHRhZ1R5cGU6IGlucHV0VGFyZ2V0LnR5cGUsXG4gICAgICB0ZXh0Q29udGVudDogaW5wdXRUYXJnZXQudGV4dENvbnRlbnQgfHwgaW5wdXRUYXJnZXQuaW5uZXJUZXh0LFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICAgIHZhbHVlOiBpbnB1dFRhcmdldC52YWx1ZSxcbiAgICAgIHdyaXRlVGVzdExvY2F0aW9uOiAnJyxcbiAgICAgIGNvbXBvbmVudEluZm86IGNvbXBvbmVudEluZm8sXG4gICAgICBjbGlja0hhbmRsZXJDb21wb25lbnQ6IGNsaWNrSGFuZGxlclxuXG4gICAgfTtcblxuICAgIHJldHVybiBtZXNzYWdlXG4gIH07XG5cblxuXG4gIHJlY29yZEV2ZW50ID0gKGV2ZW50OiBFdmVudCkgPT4ge1xuICAgIGNvbnN0IG5vZGVUYXJnZXQgPSBldmVudC50YXJnZXQgYXMgTm9kZTtcbiAgICBjb25zdCBtb3VzZUV2ZW50ID0gZXZlbnQgYXMgTW91c2VFdmVudDtcblxuICAgIC8vIGlmIHRoZSBjbGljayBpcyBvbiBhIG1lbnUgdGhhdCBwb3BzIHVwLCBkb250IGdvIHRocm91Z2ggdGhlIHJlY29yZCBldmVudCBsb2dpY1xuICAgIGlmIChub2RlVGFyZ2V0Py5wYXJlbnRFbGVtZW50Py5nZXRBdHRyaWJ1dGUoXCJpZFwiKT8uaW5jbHVkZXMoJ2NvbXBvbmVudE1lbnUnKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIWV2ZW50LnRhcmdldCkgcmV0dXJuO1xuXG4gICAgdHJ5IHtcbiAgICAgIGlmICh0aGlzLnByZXZpb3VzTXNnKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAoZXZlbnQudHlwZSA9PT0gXCJjaGFuZ2VcIiB8fCBldmVudC50eXBlID09PSBcImNsaWNrXCIpICYmXG4gICAgICAgICAgdGhpcy5wcmV2aW91c01zZyAmJlxuICAgICAgICAgIHRoaXMucHJldmlvdXNNc2cuYWN0aW9uID09PSBcImNsaWNrXCIgJiZcbiAgICAgICAgICBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMucHJldmlvdXNNc2cudGltZXN0YW1wIDwgMTAwXG4gICAgICAgICkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwibWVzc2FnZSBub3Qgc2VuZCBkdWUgdG8gdGltZVwiKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVhY3RDb21wb25lbnQgPSBmaW5kUmVhY3RFbGVtZW50KGV2ZW50LnRhcmdldCk7XG4gICAgICBjb25zdCBtc2c6IE1lc3NhZ2UgPSB0aGlzLmdldE1lc3NhZ2UocmVhY3RDb21wb25lbnQsIGV2ZW50KTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdyZWFjdENvbXBvbmVudCBhbmQgbWVzc2FnZSBpbiBSRUNPUkRfRVZFTlQ6ICcsIHJlYWN0Q29tcG9uZW50LCBtc2cpXG5cbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwibGFzdEV2ZW50XCIsIEpTT04uc3RyaW5naWZ5KG1zZykpO1xuICAgICAgdGhpcy5wcmV2aW91c01zZyA9IG1zZztcblxuICAgICAgLy8gaWYgKFxuICAgICAgLy8gICAvLyBpZiB0aGVyZSBpcyBubyBwcmV2aW91cyBjb21wb25lbnQgb3IgdGhlIHByZXZpb3VzIGNvbXBvbmVudCBpcyB0aGUgc2FtZSBhcyB0aGUgY29tcG9uZW50IHlvdSBqdXN0IGNsaWNrZWQgb25cbiAgICAgIC8vICAgIXRoaXMucHJldmlvdXNDb21wb25lbnQgfHxcbiAgICAgIC8vICAgKHRoaXMucHJldmlvdXNDb21wb25lbnQgJiYgdGhpcy5wcmV2aW91c0NvbXBvbmVudCA9PT0gcmVhY3RDb21wb25lbnQpXG4gICAgICAvLyApIHtcbiAgICAgIC8vICAgdGhpcy5wcmV2aW91c0NvbXBvbmVudCA9IHJlYWN0Q29tcG9uZW50O1xuICAgICAgLy8gICBpZiAoXG4gICAgICAvLyAgICAgdGhpcy5wcmV2aW91c0NvbXBvbmVudCAmJlxuICAgICAgLy8gICAgIG1zZy5jaGVja2VkICE9PSBudWxsICYmXG4gICAgICAvLyAgICAgbXNnLmFjdGlvbiA9PT0gXCJjbGlja1wiXG4gICAgICAvLyAgICkge1xuICAgICAgLy8gICAgIC8vIG1lc3NhZ2UgaXMgc2VudCB3aGVuIHNvbWV0aGluZyBpbiB0aGUgcG9wdXAgbWVudSBpcyBzZWxlY3RlZFxuICAgICAgLy8gICAgIHRoaXMuY3JlYXRlUG9wdXBNZW51KG1zZyk7XG4gICAgICAvLyAgICAgLy8gdGhpcy5zZW5kRXZlbnQobXNnKTtcbiAgICAgIC8vICAgICByZXR1cm47XG4gICAgICAvLyAgIH1cblxuICAgICAgLy8gICAvL3B1c2hpbmcgYSBtZXNzYWdlIHRvIHRoZSBldmVudCBjYWNoZSBzZW5kcyBpdCB0byB0aGUgYXBpIHdoZW4gdGhlIHJlY29uY2lsZSBjYWxsYmFjayBpcyBjYWxsZWRcbiAgICAgIC8vICAgdGhpcy5jb21wb25lbnRFdmVudENhY2hlLnB1c2gobXNnKTtcblxuICAgICAgLy8gICByZXR1cm47XG4gICAgICAvLyB9IGVsc2Uge1xuICAgICAgLy8gICB0aGlzLmNsZWFyRXZlbnRDYWNoZSgpO1xuICAgICAgLy8gfVxuXG4gICAgICB0aGlzLnByZXZpb3VzQ29tcG9uZW50ID0gcmVhY3RDb21wb25lbnQ7XG5cbiAgICAgIC8vIG1lc3NhZ2UgaXMgc2VudCB3aGVuIHNvbWV0aGluZyBpbiB0aGUgcG9wdXAgbWVudSBpcyBzZWxlY3RlZFxuICAgICAgaWYgKG1vdXNlRXZlbnQ/Lm1ldGFLZXkpIHRoaXMuY3JlYXRlUG9wdXBNZW51KG1zZyk7XG4gICAgICAvLyB0aGlzLnNlbmRFdmVudChtc2cpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZWNvcmRpbmcgZXZlbnRcIiwgZSk7XG4gICAgfVxuICB9O1xuXG4gIHNlbmRFdmVudCA9IGFzeW5jIChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XG4gICAgLy8gY29uc3QgYWNjb3VudElkID0gd2luZG93W1wiZGF0YUxheWVyXCJdWzBdW1wiYXBpS2V5XCJdO1xuICAgIGNvbnN0IGFjY291bnRJZCA9ICh3aW5kb3cgYXMgeyBba2V5OiBzdHJpbmddOiBhbnkgfSlbXCJkYXRhTGF5ZXJcIl1bMF1bXCJhcGlLZXlcIl1cbiAgICAvLyBjb25zdCB3cml0ZUxvY2F0aW9uID0gKHdpbmRvdyBhcyB7IFtrZXk6IHN0cmluZ106IGFueSB9KVtcImRhdGFMYXllclwiXVswXVtcInRlc3RMb2NhdGlvblwiXVxuICAgIGNvbnN0IHVybCA9IGAvL2xvY2FsaG9zdDozMDAyL2FwaS9hY2NvdW50cy8ke2FjY291bnRJZH0vZXZlbnRzL2A7XG4gICAgLy8gY29uc29sZS5sb2coJ3RoaXMgaXMgdGhlIHdyaXRlIGxvY2F0aW9uOiAnLCB3cml0ZUxvY2F0aW9uLCBhY2NvdW50SWQpO1xuICAgIC8vIGNvbnNvbGUubG9nKCd0aGlzIGlzIHRoZSBtZXNzYWdlIGluIFNFTkRfRVZFTlQ6ICcsIG1lc3NhZ2UpXG5cbiAgICAvLyBtZXNzYWdlLndyaXRlVGVzdExvY2F0aW9uID0gd3JpdGVMb2NhdGlvblxuXG5cbiAgICBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBtb2RlOiBcImNvcnNcIixcbiAgICAgIGNhY2hlOiBcIm5vLWNhY2hlXCIsXG4gICAgICBjcmVkZW50aWFsczogXCJzYW1lLW9yaWdpblwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWYsXG4gICAgICAgIGV2ZW50OiBtZXNzYWdlLFxuICAgICAgICAvLyBUT0RPOiB0ZXN0IHNldCBpZCBzaG91bGQgYmUgc2V0IHdoZW4gY3JlYXRpbmcvbG9hZGluZyB0ZXN0c2V0IGluIHRoZSBydW5uZXJcbiAgICAgICAgcGxhY2Vob2xkZXI6IG51bGwsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfTtcbn1cblxuKDxhbnk+d2luZG93KS5ldmVudFJlY29yZGVyID0gbmV3IEFzc2VydGx5Q2xpZW50KCk7XG4oPGFueT53aW5kb3cpLmV2ZW50UmVjb3JkZXIuc3RhcnQoKTtcblxuIl0sInNvdXJjZVJvb3QiOiIifQ==