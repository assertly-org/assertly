!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";function o(e,n,t){var r,i,l;if(!e||0===n)return t;if(null===(r=null==e?void 0:e._debugSource)||void 0===r?void 0:r.fileName){const r=function e(n,t={}){var o;if(!n)return c(t),t;const r=n.pendingProps?Object.assign(Object.assign({},t),n.pendingProps):t;if(delete r.children,(null===(o=null==n?void 0:n.type)||void 0===o?void 0:o.__proto__)&&["Component","PureComponent"].includes(n.type.__proto__.name))return c(r),r;return e(n._debugOwner,r)}(null==e?void 0:e._debugOwner),s=function e(n){if(!n)return null;if(n.elementType&&n.elementType.name)return n.elementType.name;if(n.elementType&&n.elementType.displayName)return n.elementType.displayName;if(n.type.displayName)return n.type.displayName;if(n.type.name)return n.type.name;return e(n._debugOwner)}(null==e?void 0:e._debugOwner);return t.push({filename:null===(i=null==e?void 0:e._debugSource)||void 0===i?void 0:i.fileName,linenumber:null===(l=null==e?void 0:e._debugSource)||void 0===l?void 0:l.lineNumber,props:r,componentName:s}),o(null==e?void 0:e._debugOwner,n-1,t)}return o(null==e?void 0:e._debugOwner,n-1,t)}t.r(n),t.d(n,"default",(function(){return a}));const r={mouseup:!0,mousedown:!0,mousemove:!0,mouseover:!0};function i(e){const n=e;return r[e.type]?{x:n.clientX,y:n.clientY}:null}function l(e){const n=Object.keys(e).find(e=>e.startsWith("__reactInternalInstance$")),t=n?e[n]:null;return null==t?null:t}function c(e){for(let n in e)if(e[n]&&"[object Function]"==={}.toString.call(e[n]))try{e[n]="[Function]"}catch(e){console.error("Error stringifying prop",e)}!function(e){const n=Object.keys(e);for(const t of n)"[object Object]"!==Object.prototype.toString.call(e[t])||!e[t].hasOwnProperty("_owner")&&"inputRef"!==t&&"InputProps"!==t||delete e[t]}(e)}class s{constructor(e){this.recordEvents=[],this.reconcileEvents=["blur","focus","change"],this.addAllListeners=()=>{this.recordEvents.forEach(e=>{window.addEventListener(e,this.eventCallback,!0)}),this.reconcileEvents.forEach(e=>{window.addEventListener(e,this.reconcileCallback,!0)})},this.removeAllListeners=()=>{this.recordEvents.forEach(e=>{window.removeEventListener(e,this.eventCallback,!0)}),this.reconcileEvents.forEach(e=>{window.removeEventListener(e,this.reconcileCallback,!0)})},this.start=()=>{window.recorderAddedControlListeners||(this.addAllListeners(),window.recorderAddedControlListeners=!0)},this.stop=()=>{window.recorderAddedControlListeners&&(this.removeAllListeners(),window.recorderAddedControlListeners=!1)};const{eventCallback:n,reconcileCallback:t,recordEvents:o,reconcileEvents:r=null}=e;this.eventCallback=n,this.reconcileCallback=t,this.recordEvents=o,r&&(this.reconcileEvents=r)}}var u=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function l(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(l,c)}s((o=o.apply(e,n||[])).next())}))};class a{constructor(){this.eventsToRecord=["click","change"],this.componentEventCache=[],this.previousComponent=null,this.previousMsg=null,this.start=()=>{this.eventRecorder.start()},this.stop=()=>{this.eventRecorder.stop()},this.clearEventCache=()=>{this.componentEventCache=[]},this.reconcileEventCache=e=>{(e.target?l(e.target):null)!==this.previousComponent&&(this.componentEventCache.forEach(e=>{console.log("in the reconcile"),this.sendEvent(e)}),this.clearEventCache())},this.createPopupMenu=e=>{var n;const t="componentMenu"+(new Date).getTime(),o=event,r=document.createElement("DIV"),i=Array.from(document.getElementsByClassName("componentMenu"));null==i||i.map(e=>e.remove()),r.setAttribute("id",t),r.setAttribute("class","componentMenu"),document.body.appendChild(r),r.style.position="absolute",r.style.left=o.x+"px",r.style.top=o.y+"px",r.style.zIndex="5",null===(n=null==e?void 0:e.componentInfo)||void 0===n||n.map(n=>{console.log("button val: ",n);const o=document.createElement("BUTTON");if(o.style.width="150px",o.innerHTML=null==n?void 0:n.componentName,o.innerHTML){o.addEventListener("click",()=>this.componentMenuClick(event,t,e)),r.appendChild(o);const n=document.createElement("br");r.appendChild(n)}});const l=document.createElement("BUTTON");l.style.width="150px",l.innerHTML="Cancel",l.addEventListener("click",()=>this.removeSingleMenu(t)),r.appendChild(l)},this.removeSingleMenu=e=>{const n=document.getElementById(e);null==n||n.remove()},this.componentMenuClick=(e,n,t)=>{var o;const r=null===(o=t.componentInfo)||void 0===o?void 0:o.reduce((n,t)=>{var o;return t.componentName===(null===(o=e.target)||void 0===o?void 0:o.innerHTML)?Object.assign({},t):n},null);null==e||e.stopPropagation(),this.sendEvent(Object.assign(Object.assign({},t),{componentInfo:r})),this.removeSingleMenu(n)},this.getMessage=(e,n)=>{var t,r,l;const c=n.target||n.srcElement,s=c,u=c,a=o(e,10,[]),d=null===(r=null===(t=null==a?void 0:a.slice(0))||void 0===t?void 0:t.reverse())||void 0===r?void 0:r.reduce((e,n)=>{var t;return(null===(t=n.props)||void 0===t?void 0:t.onClick)?Object.assign({},n):e},null);return{action:n.type,checked:(null===(l=null==n?void 0:n.target)||void 0===l?void 0:l.hasOwnProperty("checked"))?s.checked:null,coordinates:i(n),href:u.href?u.href:null,keyCode:n.keyCode?n.keyCode:null,tagName:s.tagName,tagType:s.type,textContent:s.textContent||s.innerText,timestamp:(new Date).getTime(),value:s.value,writeTestLocation:"",componentInfo:a,clickHandlerComponent:d}},this.recordEvent=e=>{var n,t;const o=e.target,r=e;if(!(null===(t=null===(n=null==o?void 0:o.parentElement)||void 0===n?void 0:n.getAttribute("id"))||void 0===t?void 0:t.includes("componentMenu"))&&e.target)try{if(this.previousMsg&&("change"===e.type||"click"===e.type)&&this.previousMsg&&"click"===this.previousMsg.action&&(new Date).getTime()-this.previousMsg.timestamp<100)return void console.log("message not send due to time");const n=l(e.target),t=this.getMessage(n,e);localStorage.setItem("lastEvent",JSON.stringify(t)),this.previousMsg=t,this.previousComponent=n,(null==r?void 0:r.metaKey)&&this.createPopupMenu(t)}catch(e){console.error("Error recording event",e)}},this.sendEvent=e=>u(this,void 0,void 0,(function*(){const n=`//localhost:3002/api/accounts/${window.dataLayer[0].apiKey}/events/`;yield fetch(n,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:window.location.href,event:e,placeholder:null})})})),this.eventRecorder=new s({recordEvents:this.eventsToRecord,eventCallback:this.recordEvent,reconcileCallback:this.reconcileEventCache})}}window.eventRecorder=new a,window.eventRecorder.start()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovLy8uL3NyYy9ldmVudC1yZWNvcmRlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvY2xpZW50LnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZ2V0Q29tcG9uZW50SW5mbyIsImNvbXBvbmVudCIsIm1heE5lc3QiLCJyZXN1bHRBcnJheSIsIl9kZWJ1Z1NvdXJjZSIsImZpbGVOYW1lIiwicHJvcHMiLCJnZXRDb21wb25lbnRQcm9wcyIsImZ1bmN0aW9uU3RyaW5naWZ5IiwibmV3UHJvcHMiLCJwZW5kaW5nUHJvcHMiLCJjaGlsZHJlbiIsInR5cGUiLCJfX3Byb3RvX18iLCJpbmNsdWRlcyIsIl9kZWJ1Z093bmVyIiwiZ2V0Q29tcG9uZW50TmFtZSIsImZpYmVyIiwiZWxlbWVudFR5cGUiLCJkaXNwbGF5TmFtZSIsInB1c2giLCJmaWxlbmFtZSIsImxpbmVudW1iZXIiLCJsaW5lTnVtYmVyIiwiY29tcG9uZW50TmFtZSIsImV2ZW50c1dpdGhDb29yZGluYXRlcyIsIm1vdXNldXAiLCJtb3VzZWRvd24iLCJtb3VzZW1vdmUiLCJtb3VzZW92ZXIiLCJnZXRDb29yZGluYXRlcyIsImV2ZW50IiwibW91c2VFdmVudCIsIngiLCJjbGllbnRYIiwieSIsImNsaWVudFkiLCJmaW5kUmVhY3RFbGVtZW50IiwidGFyZ2V0Iiwia2V5cyIsImZpbmQiLCJzdGFydHNXaXRoIiwiaW50ZXJuYWxJbnN0YW5jZSIsIm9iaiIsImsiLCJ0b1N0cmluZyIsImUiLCJjb25zb2xlIiwiZXJyb3IiLCJzdHJpcEV4dHJhQ29tcG9uZW50UHJvcHMiLCJFdmVudFJlY29yZGVyIiwiY29uZmlnIiwicmVjb3JkRXZlbnRzIiwicmVjb25jaWxlRXZlbnRzIiwiYWRkQWxsTGlzdGVuZXJzIiwidGhpcyIsImZvckVhY2giLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnRDYWxsYmFjayIsInJlY29uY2lsZUNhbGxiYWNrIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInN0YXJ0IiwicmVjb3JkZXJBZGRlZENvbnRyb2xMaXN0ZW5lcnMiLCJzdG9wIiwiZXZlbnRzVG9SZWNvcmQiLCJjb21wb25lbnRFdmVudENhY2hlIiwicHJldmlvdXNDb21wb25lbnQiLCJwcmV2aW91c01zZyIsImV2ZW50UmVjb3JkZXIiLCJjbGVhckV2ZW50Q2FjaGUiLCJyZWNvbmNpbGVFdmVudENhY2hlIiwibXNnIiwibG9nIiwic2VuZEV2ZW50IiwiY3JlYXRlUG9wdXBNZW51IiwibWVzc2FnZSIsImRpdklEIiwiRGF0ZSIsImdldFRpbWUiLCJtZW51RGl2IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwicHJldmlvdXNNZW51cyIsIkFycmF5IiwiZnJvbSIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJtYXAiLCJ2YWwiLCJyZW1vdmUiLCJzZXRBdHRyaWJ1dGUiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJzdHlsZSIsInBvc2l0aW9uIiwibGVmdCIsInRvcCIsInpJbmRleCIsImNvbXBvbmVudEluZm8iLCJidG4iLCJ3aWR0aCIsImlubmVySFRNTCIsImNvbXBvbmVudE1lbnVDbGljayIsImJyIiwiQ2FuY2VsQnRuIiwicmVtb3ZlU2luZ2xlTWVudSIsImdldEVsZW1lbnRCeUlkIiwic2VsZWN0ZWRDb21wb25lbnQiLCJyZWR1Y2UiLCJhY2MiLCJjdXJyIiwic3RvcFByb3BhZ2F0aW9uIiwiZ2V0TWVzc2FnZSIsInJlYWN0Q29tcG9uZW50Iiwic3JjRWxlbWVudCIsImlucHV0VGFyZ2V0IiwibGlua1RhcmdldCIsImNsaWNrSGFuZGxlciIsInNsaWNlIiwicmV2ZXJzZSIsImFjY3VtdWxhdG9yIiwiY3VycmVudFZhbHVlIiwib25DbGljayIsImFjdGlvbiIsImNoZWNrZWQiLCJjb29yZGluYXRlcyIsImhyZWYiLCJrZXlDb2RlIiwidGFnTmFtZSIsInRhZ1R5cGUiLCJ0ZXh0Q29udGVudCIsImlubmVyVGV4dCIsInRpbWVzdGFtcCIsIndyaXRlVGVzdExvY2F0aW9uIiwiY2xpY2tIYW5kbGVyQ29tcG9uZW50IiwicmVjb3JkRXZlbnQiLCJub2RlVGFyZ2V0IiwicGFyZW50RWxlbWVudCIsImdldEF0dHJpYnV0ZSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwibWV0YUtleSIsInVybCIsImZldGNoIiwibWV0aG9kIiwiY2FjaGUiLCJjcmVkZW50aWFscyIsImhlYWRlcnMiLCJsb2NhdGlvbiIsInBsYWNlaG9sZGVyIl0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVQyxRQUduQyxJQUFJQyxFQUFTSixFQUFpQkUsR0FBWSxDQUN6Q0csRUFBR0gsRUFDSEksR0FBRyxFQUNISCxRQUFTLElBVVYsT0FOQUksRUFBUUwsR0FBVU0sS0FBS0osRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0YsR0FHL0RHLEVBQU9FLEdBQUksRUFHSkYsRUFBT0QsUUFLZkYsRUFBb0JRLEVBQUlGLEVBR3hCTixFQUFvQlMsRUFBSVYsRUFHeEJDLEVBQW9CVSxFQUFJLFNBQVNS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QUNuQkUsSUFBS3hGLE9BQU84RixTQUFTeEIsS0FDckJoRyxNQUFPOEMsRUFFUDJFLFlBQWEsWUF6T2pCakcsS0FBS2UsY0FBZ0IsSUFBSXBCLEVBQWMsQ0FDckNFLGFBQWNHLEtBQUtXLGVBQ25CUCxjQUFlSixLQUFLaUYsWUFDcEI1RSxrQkFBbUJMLEtBQUtpQix1QkE0T3hCZixPQUFRYSxjQUFnQixJQUFJLEVBQzVCYixPQUFRYSxjQUFjUCIsImZpbGUiOiJhc3NlcnRseS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCBDb29yZGluYXRlcyBmcm9tIFwiLi90eXBlcy9Db29yZGluYXRlc1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29tcG9uZW50SW5mbyhjb21wb25lbnQ6IGFueSwgbWF4TmVzdDogbnVtYmVyLCByZXN1bHRBcnJheTogYW55KTogYW55IHtcbiAgXG5cbiAgLy8gY29uc29sZS5sb2coJ2ZpbmRGaWxlTmFtZTogJywgY29tcG9uZW50KVxuXG4gIGlmICghY29tcG9uZW50IHx8IG1heE5lc3QgPT09IDApIHtcbiAgICAvLyBjb25zb2xlLmxvZygncmVzdWx0QXJyYXk6ICcsIHJlc3VsdEFycmF5KVxuICAgIHJldHVybiByZXN1bHRBcnJheVxuICB9XG5cbiAgaWYgKGNvbXBvbmVudD8uX2RlYnVnU291cmNlPy5maWxlTmFtZSkge1xuICAgIC8vIHRoZSBvd25lciBvZiB0aGUgbm9kZSB3aGVyZSB0aGUgJ3NvdXJjZScgZmlsZW5hbWUgZXhpc3RzIGlzIHRoZSBmaWxlIHRoYXQgeW91IHdhbnQgdGhlIHByb3BzIGZvciBcbiAgICBjb25zdCBwcm9wcyA9IGdldENvbXBvbmVudFByb3BzKGNvbXBvbmVudD8uX2RlYnVnT3duZXIpXG4gICAgY29uc3QgbmFtZSA9IGdldENvbXBvbmVudE5hbWUoY29tcG9uZW50Py5fZGVidWdPd25lcilcbiAgICByZXN1bHRBcnJheS5wdXNoKHtcbiAgICAgIGZpbGVuYW1lOiBjb21wb25lbnQ/Ll9kZWJ1Z1NvdXJjZT8uZmlsZU5hbWUsIFxuICAgICAgLy8gdGhlIGxpbmUgbnVtYmVyIGlzIHJlYWxseSBmb3IgdGhlIG5leHQgY29tcG9uZW50IGRvd24gaW4gdGhlIHRyZWUgdGhhdCBpcyBiZWluZyBjYWxsZWQgZnJvbSB0aGUgJ2ZpbGVuYW1lJ1xuICAgICAgbGluZW51bWJlcjogY29tcG9uZW50Py5fZGVidWdTb3VyY2U/LmxpbmVOdW1iZXIsIFxuICAgICAgcHJvcHM6IHByb3BzLCBcbiAgICAgIGNvbXBvbmVudE5hbWU6IG5hbWV9KVxuICAgIHJldHVybiBnZXRDb21wb25lbnRJbmZvKGNvbXBvbmVudD8uX2RlYnVnT3duZXIsbWF4TmVzdC0xLHJlc3VsdEFycmF5KVxuICB9IGVsc2Uge1xuICAgIHJldHVybiBnZXRDb21wb25lbnRJbmZvKGNvbXBvbmVudD8uX2RlYnVnT3duZXIsbWF4TmVzdC0xLHJlc3VsdEFycmF5KVxuICB9XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbXBvbmVudFByb3BzKGNvbXBvbmVudDogYW55LCBwcm9wcyA9IHt9KTogYW55IHtcbiAgaWYgKCFjb21wb25lbnQpIHtcbiAgICBmdW5jdGlvblN0cmluZ2lmeShwcm9wcyk7XG4gICAgcmV0dXJuIHByb3BzO1xuICB9XG5cbiAgY29uc3QgbmV3UHJvcHMgPSBjb21wb25lbnQucGVuZGluZ1Byb3BzXG4gICAgPyB7IC4uLnByb3BzLCAuLi5jb21wb25lbnQucGVuZGluZ1Byb3BzIH1cbiAgICA6IHByb3BzO1xuICBkZWxldGUgbmV3UHJvcHMuY2hpbGRyZW47XG5cbiAgaWYgKFxuICAgIGNvbXBvbmVudD8udHlwZT8uX19wcm90b19fICYmXG4gICAgW1wiQ29tcG9uZW50XCIsIFwiUHVyZUNvbXBvbmVudFwiXS5pbmNsdWRlcyhjb21wb25lbnQudHlwZS5fX3Byb3RvX18ubmFtZSlcbiAgKSB7XG4gICAgZnVuY3Rpb25TdHJpbmdpZnkobmV3UHJvcHMpO1xuICAgIHJldHVybiBuZXdQcm9wcztcbiAgfVxuXG4gIHJldHVybiBnZXRDb21wb25lbnRQcm9wcyhjb21wb25lbnQuX2RlYnVnT3duZXIsIG5ld1Byb3BzKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbXBvbmVudE5hbWUoZmliZXI6IGFueSk6IGFueSB7XG4gIGlmICghZmliZXIpIHJldHVybiBudWxsO1xuXG4gIGlmIChmaWJlci5lbGVtZW50VHlwZSAmJiBmaWJlci5lbGVtZW50VHlwZS5uYW1lKSB7XG4gICAgcmV0dXJuIGZpYmVyLmVsZW1lbnRUeXBlLm5hbWU7XG4gIH1cblxuICBpZiAoZmliZXIuZWxlbWVudFR5cGUgJiYgZmliZXIuZWxlbWVudFR5cGUuZGlzcGxheU5hbWUpIHtcbiAgICByZXR1cm4gZmliZXIuZWxlbWVudFR5cGUuZGlzcGxheU5hbWU7XG4gIH1cblxuICBpZiAoZmliZXIudHlwZS5kaXNwbGF5TmFtZSkge1xuICAgIHJldHVybiBmaWJlci50eXBlLmRpc3BsYXlOYW1lO1xuICB9XG5cbiAgaWYgKGZpYmVyLnR5cGUubmFtZSkge1xuICAgIHJldHVybiBmaWJlci50eXBlLm5hbWU7XG4gIH1cbiAgcmV0dXJuIGdldENvbXBvbmVudE5hbWUoZmliZXIuX2RlYnVnT3duZXIpO1xufVxuXG5jb25zdCBldmVudHNXaXRoQ29vcmRpbmF0ZXM6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7XG4gIG1vdXNldXA6IHRydWUsXG4gIG1vdXNlZG93bjogdHJ1ZSxcbiAgbW91c2Vtb3ZlOiB0cnVlLFxuICBtb3VzZW92ZXI6IHRydWUsXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29vcmRpbmF0ZXMoZXZlbnQ6IEV2ZW50KTogQ29vcmRpbmF0ZXMgfCBudWxsIHtcbiAgY29uc3QgbW91c2VFdmVudCA9IGV2ZW50IGFzIE1vdXNlRXZlbnQ7XG5cbiAgcmV0dXJuIGV2ZW50c1dpdGhDb29yZGluYXRlc1tldmVudC50eXBlXVxuICAgID8geyB4OiBtb3VzZUV2ZW50LmNsaWVudFgsIHk6IG1vdXNlRXZlbnQuY2xpZW50WSB9XG4gICAgOiBudWxsO1xufVxuXG4vLyBtYXAgcmVhY3QgY2xhc3NlcyB0byBkb20gZWxlbWVudHNcbmV4cG9ydCBmdW5jdGlvbiBmaW5kUmVhY3RFbGVtZW50KHRhcmdldDogRXZlbnRUYXJnZXQpOiBhbnkge1xuICAvLyBjb25zb2xlLmRpcih0YXJnZXQpXG4gIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHRhcmdldCkuZmluZCgoa2V5KSA9PlxuICAgIGtleS5zdGFydHNXaXRoKFwiX19yZWFjdEludGVybmFsSW5zdGFuY2UkXCIpXG4gICk7XG4gIC8vIGNvbnNvbGUubG9nKCdrZXk6ICcsIGtleSlcbiAgLy8gY3JlYXRlcyBhbiBvYmplY3Qgb3V0IG9mIHRoZSB0YXJnZXQgcGFzc2VkXG4gIGNvbnN0IHRhcmdldE1hcCA9IHRhcmdldCBhcyB7IFtrZXk6IHN0cmluZ106IGFueSB9O1xuXG4gIGNvbnN0IGludGVybmFsSW5zdGFuY2UgPSBrZXkgPyB0YXJnZXRNYXBba2V5XSA6IG51bGw7XG4gIC8vIGNvbnNvbGUubG9nKCdSZWFjdCBOb2RlIGlmIEZvdW5kOiAnLCBpbnRlcm5hbEluc3RhbmNlKVxuICBpZiAoaW50ZXJuYWxJbnN0YW5jZSA9PSBudWxsKSByZXR1cm4gbnVsbDtcblxuICAvLyBjb25zb2xlLmxvZygnaW50ZXJuYWxJbnN0YW5jZTI6ICcsIGludGVybmFsSW5zdGFuY2UpXG4gIC8vIHJldHVybiBpbnRlcm5hbEluc3RhbmNlLl9kZWJ1Z093bmVyXG4gIC8vICAgPyBpbnRlcm5hbEluc3RhbmNlLl9kZWJ1Z093bmVyLnN0YXRlTm9kZVxuICAvLyAgIDogaW50ZXJuYWxJbnN0YW5jZS5yZXR1cm4uc3RhdGVOb2RlO1xuXG4gIHJldHVybiBpbnRlcm5hbEluc3RhbmNlO1xuXG4gIC8vIGZvciAobGV0IGtleTogc3RyaW5nIGluIHRhcmdldCkge1xuICAvLyAgIGlmIChrZXkuc3RhcnRzV2l0aChcIl9fcmVhY3RJbnRlcm5hbEluc3RhbmNlJFwiKSkge1xuICAvLyAgICAgLy8gY29uc29sZS5sb2coJ2tleXMgaW4gdGhlIGZpbmQgUmVhY3RFbGVtZW50JywgdGFyZ2V0W2tleV0pXG4gIC8vICAgICByZXR1cm4gdGFyZ2V0W2tleV07XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vIHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZnVuY3Rpb25TdHJpbmdpZnkob2JqOiBhbnkpOiB2b2lkIHtcbiAgZm9yIChsZXQgayBpbiBvYmopIHtcbiAgICBpZiAob2JqW2tdICYmIHt9LnRvU3RyaW5nLmNhbGwob2JqW2tdKSA9PT0gXCJbb2JqZWN0IEZ1bmN0aW9uXVwiKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBvYmpba10gPSBcIlwiICsgb2JqW2tdO1xuICAgICAgICAvLyAvLyBnZXQgcmlkIG9mIHRoZSBleHRyYSBsaW5lIG1hcmtlcnNcbiAgICAgICAgLy8gb2JqW2tdID0gb2JqW2tdLnJlcGxhY2UoLyhcXHJcXG58XFxufFxccikvZ20sIFwiXCIpO1xuICAgICAgICBvYmpba10gPSBcIltGdW5jdGlvbl1cIlxuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc3RyaW5naWZ5aW5nIHByb3BcIiwgZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHN0cmlwRXh0cmFDb21wb25lbnRQcm9wcyhvYmopO1xufVxuXG5cblxuZnVuY3Rpb24gc3RyaXBFeHRyYUNvbXBvbmVudFByb3BzKHByb3BzOiBhbnkpOiB2b2lkIHtcbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHByb3BzKTtcbiAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuICAgIGlmIChcbiAgICAgIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChwcm9wc1trZXldKSA9PT0gXCJbb2JqZWN0IE9iamVjdF1cIiAmJlxuICAgICAgKHByb3BzW2tleV0uaGFzT3duUHJvcGVydHkoXCJfb3duZXJcIikgfHxcbiAgICAgICAga2V5ID09PSBcImlucHV0UmVmXCIgfHxcbiAgICAgICAga2V5ID09PSBcIklucHV0UHJvcHNcIilcbiAgICApIHtcbiAgICAgIGRlbGV0ZSBwcm9wc1trZXldO1xuICAgIH1cbiAgfVxufVxuIiwiaW1wb3J0IHsgRXZlbnRUeXBlLCBSZWNvbmNpbGVUeXBlIH0gZnJvbSBcIi4vdHlwZXMvRXZlbnRUeXBlXCI7XG5pbXBvcnQgeyBSZWNvcmRlckNvbmZpZyB9IGZyb20gXCIuL3R5cGVzL1JlY29yZGVyQ29uZmlnXCI7XG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgaW50ZXJmYWNlIFdpbmRvdyB7XG4gICAgcmVjb3JkZXJBZGRlZENvbnRyb2xMaXN0ZW5lcnM6IGJvb2xlYW47XG4gICAgZGF0YUxheWVyOiBhbnlbXTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFdmVudFJlY29yZGVyIHtcbiAgcHJpdmF0ZSBldmVudENhbGxiYWNrOiAoZXZlbnQ6IEV2ZW50KSA9PiBhbnk7XG4gIHByaXZhdGUgcmVjb25jaWxlQ2FsbGJhY2s6IChldmVudDogRXZlbnQpID0+IGFueTtcbiAgcHJpdmF0ZSByZWNvcmRFdmVudHM6IEV2ZW50VHlwZVtdID0gW107XG4gIHByaXZhdGUgcmVjb25jaWxlRXZlbnRzOiBSZWNvbmNpbGVUeXBlW10gPSBbXCJibHVyXCIsIFwiZm9jdXNcIiwgXCJjaGFuZ2VcIl07XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBSZWNvcmRlckNvbmZpZykge1xuICAgIGNvbnN0IHtcbiAgICAgIGV2ZW50Q2FsbGJhY2ssXG4gICAgICByZWNvbmNpbGVDYWxsYmFjayxcbiAgICAgIHJlY29yZEV2ZW50cyxcbiAgICAgIHJlY29uY2lsZUV2ZW50cyA9IG51bGwsXG4gICAgfSA9IGNvbmZpZztcbiAgICB0aGlzLmV2ZW50Q2FsbGJhY2sgPSBldmVudENhbGxiYWNrO1xuICAgIHRoaXMucmVjb25jaWxlQ2FsbGJhY2sgPSByZWNvbmNpbGVDYWxsYmFjaztcbiAgICB0aGlzLnJlY29yZEV2ZW50cyA9IHJlY29yZEV2ZW50cztcbiAgICBpZiAocmVjb25jaWxlRXZlbnRzKSB7XG4gICAgICB0aGlzLnJlY29uY2lsZUV2ZW50cyA9IHJlY29uY2lsZUV2ZW50cztcbiAgICB9XG4gIH1cblxuICBhZGRBbGxMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgdGhpcy5yZWNvcmRFdmVudHMuZm9yRWFjaCgoZXZlbnQpID0+IHtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCB0aGlzLmV2ZW50Q2FsbGJhY2ssIHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5yZWNvbmNpbGVFdmVudHMuZm9yRWFjaCgoZXZlbnQpID0+IHtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCB0aGlzLnJlY29uY2lsZUNhbGxiYWNrLCB0cnVlKTtcbiAgICB9KTtcbiAgfTtcblxuICByZW1vdmVBbGxMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgdGhpcy5yZWNvcmRFdmVudHMuZm9yRWFjaCgoZXZlbnQpID0+IHtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCB0aGlzLmV2ZW50Q2FsbGJhY2ssIHRydWUpO1xuICAgIH0pO1xuICAgIHRoaXMucmVjb25jaWxlRXZlbnRzLmZvckVhY2goKGV2ZW50OiBSZWNvbmNpbGVUeXBlKSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5yZWNvbmNpbGVDYWxsYmFjaywgdHJ1ZSk7XG4gICAgfSk7XG4gIH07XG5cbiAgc3RhcnQgPSAoKSA9PiB7XG4gICAgaWYgKCF3aW5kb3cucmVjb3JkZXJBZGRlZENvbnRyb2xMaXN0ZW5lcnMpIHtcbiAgICAgIHRoaXMuYWRkQWxsTGlzdGVuZXJzKCk7XG4gICAgICB3aW5kb3cucmVjb3JkZXJBZGRlZENvbnRyb2xMaXN0ZW5lcnMgPSB0cnVlO1xuICAgIH1cbiAgfTtcblxuICBzdG9wID0gKCkgPT4ge1xuICAgIGlmICh3aW5kb3cucmVjb3JkZXJBZGRlZENvbnRyb2xMaXN0ZW5lcnMpIHtcbiAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgICB3aW5kb3cucmVjb3JkZXJBZGRlZENvbnRyb2xMaXN0ZW5lcnMgPSBmYWxzZTtcbiAgICB9XG4gIH07XG59XG4iLCJpbXBvcnQge1xuICBmaW5kUmVhY3RFbGVtZW50LFxuICBnZXRDb29yZGluYXRlcyxcbiAgZ2V0Q29tcG9uZW50TmFtZSxcbiAgZ2V0Q29tcG9uZW50UHJvcHMsXG4gIGdldENvbXBvbmVudEluZm9cbn0gZnJvbSBcIi4vdXRpbHNcIjtcblxuXG5pbXBvcnQgRXZlbnRSZWNvcmRlciBmcm9tIFwiLi9ldmVudC1yZWNvcmRlclwiO1xuaW1wb3J0IENsaWVudEludGVyZmFjZSBmcm9tIFwiLi90eXBlcy9DbGllbnRcIjtcbmltcG9ydCBNZXNzYWdlIGZyb20gXCIuL3R5cGVzL01lc3NhZ2VcIjtcbmltcG9ydCB7IEV2ZW50VHlwZSB9IGZyb20gXCIuL3R5cGVzL0V2ZW50VHlwZVwiO1xuXG5pbnRlcmZhY2UgQ29tcG9uZW50IHsgfVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBc3NlcnRseUNsaWVudCBpbXBsZW1lbnRzIENsaWVudEludGVyZmFjZSB7XG4gIGV2ZW50c1RvUmVjb3JkOiBFdmVudFR5cGVbXSA9IFtcImNsaWNrXCIsIFwiY2hhbmdlXCJdO1xuXG4gIHByaXZhdGUgZXZlbnRSZWNvcmRlcjogRXZlbnRSZWNvcmRlcjtcbiAgcHJpdmF0ZSBjb21wb25lbnRFdmVudENhY2hlOiBNZXNzYWdlW10gPSBbXTtcbiAgcHJpdmF0ZSBwcmV2aW91c0NvbXBvbmVudDogQ29tcG9uZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcHJldmlvdXNNc2c6IE1lc3NhZ2UgfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmV2ZW50UmVjb3JkZXIgPSBuZXcgRXZlbnRSZWNvcmRlcih7XG4gICAgICByZWNvcmRFdmVudHM6IHRoaXMuZXZlbnRzVG9SZWNvcmQsXG4gICAgICBldmVudENhbGxiYWNrOiB0aGlzLnJlY29yZEV2ZW50LFxuICAgICAgcmVjb25jaWxlQ2FsbGJhY2s6IHRoaXMucmVjb25jaWxlRXZlbnRDYWNoZSxcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXJ0ID0gKCkgPT4ge1xuICAgIHRoaXMuZXZlbnRSZWNvcmRlci5zdGFydCgpO1xuICB9O1xuXG4gIHN0b3AgPSAoKSA9PiB7XG4gICAgdGhpcy5ldmVudFJlY29yZGVyLnN0b3AoKTtcbiAgfTtcblxuICBjbGVhckV2ZW50Q2FjaGUgPSAoKSA9PiB7XG4gICAgdGhpcy5jb21wb25lbnRFdmVudENhY2hlID0gW107XG4gIH07XG5cbiAgcmVjb25jaWxlRXZlbnRDYWNoZSA9IChldmVudDogRXZlbnQpID0+IHtcbiAgICBjb25zdCByZWFjdENvbXBvbmVudCA9IGV2ZW50LnRhcmdldCA/IGZpbmRSZWFjdEVsZW1lbnQoZXZlbnQudGFyZ2V0KSA6IG51bGw7XG4gICAgaWYgKHJlYWN0Q29tcG9uZW50ICE9PSB0aGlzLnByZXZpb3VzQ29tcG9uZW50KSB7XG4gICAgICB0aGlzLmNvbXBvbmVudEV2ZW50Q2FjaGUuZm9yRWFjaCgobXNnKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdpbiB0aGUgcmVjb25jaWxlJylcbiAgICAgICAgdGhpcy5zZW5kRXZlbnQobXNnKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jbGVhckV2ZW50Q2FjaGUoKTtcbiAgICB9XG4gIH07XG5cbiAgY3JlYXRlUG9wdXBNZW51ID0gKG1lc3NhZ2U6IE1lc3NhZ2UpID0+IHtcblxuICAgIGNvbnN0IGV2ZW50VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpXG4gICAgY29uc3QgZGl2SUQgPSBcImNvbXBvbmVudE1lbnVcIiArIGV2ZW50VGltZVxuICAgIGNvbnN0IG1vdXNlRXZlbnQgPSBldmVudCBhcyBNb3VzZUV2ZW50O1xuICAgIGNvbnN0IG1lbnVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiRElWXCIpO1xuXG4gICAgY29uc3QgcHJldmlvdXNNZW51cyA9IEFycmF5LmZyb20oZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY29tcG9uZW50TWVudScpKTtcbiAgICBwcmV2aW91c01lbnVzPy5tYXAoKHZhbDogYW55KSA9PiB2YWwucmVtb3ZlKCkpXG5cbiAgICBtZW51RGl2LnNldEF0dHJpYnV0ZShcImlkXCIsIGRpdklEKTtcbiAgICBtZW51RGl2LnNldEF0dHJpYnV0ZShcImNsYXNzXCIsICdjb21wb25lbnRNZW51Jyk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtZW51RGl2KTtcbiAgICBtZW51RGl2LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIG1lbnVEaXYuc3R5bGUubGVmdCA9IG1vdXNlRXZlbnQueCArICdweCc7XG4gICAgbWVudURpdi5zdHlsZS50b3AgPSBtb3VzZUV2ZW50LnkgKyAncHgnO1xuICAgIG1lbnVEaXYuc3R5bGUuekluZGV4ID0gJzUnO1xuXG4gICAgbWVzc2FnZT8uY29tcG9uZW50SW5mbz8ubWFwKCh2YWw6IGFueSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJidXR0b24gdmFsOiBcIiwgdmFsKTtcbiAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJCVVRUT05cIik7XG4gICAgICBidG4uc3R5bGUud2lkdGggPSAnMTUwcHgnO1xuICAgICAgYnRuLmlubmVySFRNTCA9IHZhbD8uY29tcG9uZW50TmFtZTtcbiAgICAgIGlmIChidG4uaW5uZXJIVE1MKSB7XG4gICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuY29tcG9uZW50TWVudUNsaWNrKGV2ZW50LCBkaXZJRCwgbWVzc2FnZSkpXG4gICAgICAgIG1lbnVEaXYuYXBwZW5kQ2hpbGQoYnRuKTtcbiAgICAgICAgY29uc3QgYnIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnJcIik7XG4gICAgICAgIG1lbnVEaXYuYXBwZW5kQ2hpbGQoYnIpO1xuICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBDYW5jZWxCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiQlVUVE9OXCIpO1xuICAgIENhbmNlbEJ0bi5zdHlsZS53aWR0aCA9ICcxNTBweCc7XG4gICAgQ2FuY2VsQnRuLmlubmVySFRNTCA9ICdDYW5jZWwnO1xuICAgIENhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMucmVtb3ZlU2luZ2xlTWVudShkaXZJRCkpXG4gICAgbWVudURpdi5hcHBlbmRDaGlsZChDYW5jZWxCdG4pO1xuICB9XG5cbiAgcmVtb3ZlU2luZ2xlTWVudSA9IChkaXZJRDogYW55KSA9PiB7XG4gICAgY29uc3QgbWVudURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRpdklEKTtcbiAgICBtZW51RGl2Py5yZW1vdmUoKVxuICB9XG5cbiAgY29tcG9uZW50TWVudUNsaWNrID0gKGV2ZW50OiBhbnksIGRpdklEOiBhbnksIG1lc3NhZ2U6IE1lc3NhZ2UpOiBhbnkgPT4ge1xuICAgIC8vIGNvbnNvbGUubG9nKCd0aGlzIGlzIHRoZSBjbGljayBjYWxsIGJhY2s6ICcsIGV2ZW50KVxuXG4gICAgY29uc3Qgc2VsZWN0ZWRDb21wb25lbnQgPSBtZXNzYWdlLmNvbXBvbmVudEluZm8/LnJlZHVjZShcbiAgICAgIChhY2M6IGFueSwgY3VycjogYW55KSA9PiB7XG4gICAgICAgIGlmIChjdXJyLmNvbXBvbmVudE5hbWUgPT09IGV2ZW50LnRhcmdldD8uaW5uZXJIVE1MKSB7XG4gICAgICAgICAgcmV0dXJuIHsgLi4uY3VyciB9XG4gICAgICAgIH0gZWxzZSB7IHJldHVybiBhY2MgfVxuICAgICAgfSwgbnVsbClcblxuICAgIGV2ZW50Py5zdG9wUHJvcGFnYXRpb24oKVxuICAgIHRoaXMuc2VuZEV2ZW50KHtcbiAgICAgIC4uLm1lc3NhZ2UsXG4gICAgICAvLyB0aGVyZSBzaG91bGQgb25seSBiZSBvbmUgbWF0Y2ggaGVyZSBvbiB0aGUgZmlsdGVyXG4gICAgICAvLyBjb21wb25lbnRJbmZvOiBtZXNzYWdlLmNvbXBvbmVudEluZm8/LmZpbHRlciggKHZhbDphbnkpID0+IHZhbC5jb21wb25lbnROYW1lID09PSBldmVudC50YXJnZXQ/LmlubmVySFRNTClcbiAgICAgIGNvbXBvbmVudEluZm86IHNlbGVjdGVkQ29tcG9uZW50XG4gICAgfSlcblxuICAgIHRoaXMucmVtb3ZlU2luZ2xlTWVudShkaXZJRClcbiAgICAvLyBjb25zdCBtZW51RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGl2SUQpO1xuICAgIC8vIG1lbnVEaXY/LnJlbW92ZSgpXG5cbiAgfVxuXG4gIGdldE1lc3NhZ2UgPSAocmVhY3RDb21wb25lbnQ6IGFueSwgZXZlbnQ6IEtleWJvYXJkRXZlbnQgfCBFdmVudCk6IE1lc3NhZ2UgPT4ge1xuXG4gICAgLy8gZnVuY3Rpb24gdG8gdXNlIGluIGFycmF5IHJlZHVjZVxuICAgIGNvbnN0IGZpbmRDbGlja0hhbmRsZXIgPSAoYWNjdW11bGF0b3I6IGFueSwgY3VycmVudFZhbHVlOiBhbnkpID0+IHtcbiAgICAgIGlmIChjdXJyZW50VmFsdWUucHJvcHM/Lm9uQ2xpY2spIHtcbiAgICAgICAgcmV0dXJuIHsuLi5jdXJyZW50VmFsdWV9XG4gICAgICB9IGVsc2UgeyByZXR1cm4gYWNjdW11bGF0b3IgfVxuICAgIH07XG5cbiAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQgfHwgZXZlbnQuc3JjRWxlbWVudDtcbiAgICBjb25zdCBpbnB1dFRhcmdldCA9IHRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGxpbmtUYXJnZXQgPSB0YXJnZXQgYXMgSFRNTExpbmtFbGVtZW50O1xuXG4gICAgY29uc3QgY29tcG9uZW50SW5mbyA9IGdldENvbXBvbmVudEluZm8ocmVhY3RDb21wb25lbnQsIDEwLCBbXSlcblxuICAgIC8vIGZpbmQgdGhlIGNsb3Nlc3QgY2xpY2sgaGFuZGxlciB0aGF0IHdvdWxkIGhhdmUgYmVlbiB0cmlnZ2VyZWRcbiAgICBjb25zdCBjbGlja0hhbmRsZXIgPSBjb21wb25lbnRJbmZvPy5zbGljZSgwKT8ucmV2ZXJzZSgpPy5yZWR1Y2UoZmluZENsaWNrSGFuZGxlciwgbnVsbClcblxuXG4gICAgLy8gY29uc29sZS5sb2coJ2NvbXBvbmVudCBpbmZvIGluIEdFVF9NRVNTQUdFOiAnLCBjb21wb25lbnRJbmZvLCBjbGlja0hhbmRsZXIpXG5cbiAgICBjb25zdCBtZXNzYWdlOiBNZXNzYWdlID0ge1xuICAgICAgLy8gY29tcG9uZW50TmFtZSwgZmlsZU5hbWUsIGFuZCBsaW5lTnVtYmVyIGFyZSBhbHJlYWR5IGluIHRoZSBvYmplY3QgcmV0dXJuZWRcbiAgICAgIGFjdGlvbjogZXZlbnQudHlwZSxcbiAgICAgIGNoZWNrZWQ6IGV2ZW50Py50YXJnZXQ/Lmhhc093blByb3BlcnR5KFwiY2hlY2tlZFwiKVxuICAgICAgICA/IGlucHV0VGFyZ2V0LmNoZWNrZWRcbiAgICAgICAgOiBudWxsLFxuICAgICAgY29vcmRpbmF0ZXM6IGdldENvb3JkaW5hdGVzKGV2ZW50KSxcbiAgICAgIGhyZWY6IGxpbmtUYXJnZXQuaHJlZiA/IGxpbmtUYXJnZXQuaHJlZiA6IG51bGwsXG4gICAgICBrZXlDb2RlOiAoZXZlbnQgYXMgS2V5Ym9hcmRFdmVudCkua2V5Q29kZVxuICAgICAgICA/IChldmVudCBhcyBLZXlib2FyZEV2ZW50KS5rZXlDb2RlXG4gICAgICAgIDogbnVsbCxcbiAgICAgIHRhZ05hbWU6IGlucHV0VGFyZ2V0LnRhZ05hbWUsXG4gICAgICB0YWdUeXBlOiBpbnB1dFRhcmdldC50eXBlLFxuICAgICAgdGV4dENvbnRlbnQ6IGlucHV0VGFyZ2V0LnRleHRDb250ZW50IHx8IGlucHV0VGFyZ2V0LmlubmVyVGV4dCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS5nZXRUaW1lKCksXG4gICAgICB2YWx1ZTogaW5wdXRUYXJnZXQudmFsdWUsXG4gICAgICB3cml0ZVRlc3RMb2NhdGlvbjogJycsXG4gICAgICBjb21wb25lbnRJbmZvOiBjb21wb25lbnRJbmZvLFxuICAgICAgY2xpY2tIYW5kbGVyQ29tcG9uZW50OiBjbGlja0hhbmRsZXJcblxuICAgIH07XG5cbiAgICByZXR1cm4gbWVzc2FnZVxuICB9O1xuXG5cblxuICByZWNvcmRFdmVudCA9IChldmVudDogRXZlbnQpID0+IHtcbiAgICBjb25zdCBub2RlVGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIE5vZGU7XG4gICAgY29uc3QgbW91c2VFdmVudCA9IGV2ZW50IGFzIE1vdXNlRXZlbnQ7XG5cbiAgICAvLyBpZiB0aGUgY2xpY2sgaXMgb24gYSBtZW51IHRoYXQgcG9wcyB1cCwgZG9udCBnbyB0aHJvdWdoIHRoZSByZWNvcmQgZXZlbnQgbG9naWNcbiAgICBpZiAobm9kZVRhcmdldD8ucGFyZW50RWxlbWVudD8uZ2V0QXR0cmlidXRlKFwiaWRcIik/LmluY2x1ZGVzKCdjb21wb25lbnRNZW51JykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFldmVudC50YXJnZXQpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBpZiAodGhpcy5wcmV2aW91c01zZykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgKGV2ZW50LnR5cGUgPT09IFwiY2hhbmdlXCIgfHwgZXZlbnQudHlwZSA9PT0gXCJjbGlja1wiKSAmJlxuICAgICAgICAgIHRoaXMucHJldmlvdXNNc2cgJiZcbiAgICAgICAgICB0aGlzLnByZXZpb3VzTXNnLmFjdGlvbiA9PT0gXCJjbGlja1wiICYmXG4gICAgICAgICAgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLnByZXZpb3VzTXNnLnRpbWVzdGFtcCA8IDEwMFxuICAgICAgICApIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIm1lc3NhZ2Ugbm90IHNlbmQgZHVlIHRvIHRpbWVcIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlYWN0Q29tcG9uZW50ID0gZmluZFJlYWN0RWxlbWVudChldmVudC50YXJnZXQpO1xuICAgICAgY29uc3QgbXNnOiBNZXNzYWdlID0gdGhpcy5nZXRNZXNzYWdlKHJlYWN0Q29tcG9uZW50LCBldmVudCk7XG4gICAgICAvLyBjb25zb2xlLmxvZygncmVhY3RDb21wb25lbnQgYW5kIG1lc3NhZ2UgaW4gUkVDT1JEX0VWRU5UOiAnLCByZWFjdENvbXBvbmVudCwgbXNnKVxuXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImxhc3RFdmVudFwiLCBKU09OLnN0cmluZ2lmeShtc2cpKTtcbiAgICAgIHRoaXMucHJldmlvdXNNc2cgPSBtc2c7XG5cbiAgICAgIC8vIGlmIChcbiAgICAgIC8vICAgLy8gaWYgdGhlcmUgaXMgbm8gcHJldmlvdXMgY29tcG9uZW50IG9yIHRoZSBwcmV2aW91cyBjb21wb25lbnQgaXMgdGhlIHNhbWUgYXMgdGhlIGNvbXBvbmVudCB5b3UganVzdCBjbGlja2VkIG9uXG4gICAgICAvLyAgICF0aGlzLnByZXZpb3VzQ29tcG9uZW50IHx8XG4gICAgICAvLyAgICh0aGlzLnByZXZpb3VzQ29tcG9uZW50ICYmIHRoaXMucHJldmlvdXNDb21wb25lbnQgPT09IHJlYWN0Q29tcG9uZW50KVxuICAgICAgLy8gKSB7XG4gICAgICAvLyAgIHRoaXMucHJldmlvdXNDb21wb25lbnQgPSByZWFjdENvbXBvbmVudDtcbiAgICAgIC8vICAgaWYgKFxuICAgICAgLy8gICAgIHRoaXMucHJldmlvdXNDb21wb25lbnQgJiZcbiAgICAgIC8vICAgICBtc2cuY2hlY2tlZCAhPT0gbnVsbCAmJlxuICAgICAgLy8gICAgIG1zZy5hY3Rpb24gPT09IFwiY2xpY2tcIlxuICAgICAgLy8gICApIHtcbiAgICAgIC8vICAgICAvLyBtZXNzYWdlIGlzIHNlbnQgd2hlbiBzb21ldGhpbmcgaW4gdGhlIHBvcHVwIG1lbnUgaXMgc2VsZWN0ZWRcbiAgICAgIC8vICAgICB0aGlzLmNyZWF0ZVBvcHVwTWVudShtc2cpO1xuICAgICAgLy8gICAgIC8vIHRoaXMuc2VuZEV2ZW50KG1zZyk7XG4gICAgICAvLyAgICAgcmV0dXJuO1xuICAgICAgLy8gICB9XG5cbiAgICAgIC8vICAgLy9wdXNoaW5nIGEgbWVzc2FnZSB0byB0aGUgZXZlbnQgY2FjaGUgc2VuZHMgaXQgdG8gdGhlIGFwaSB3aGVuIHRoZSByZWNvbmNpbGUgY2FsbGJhY2sgaXMgY2FsbGVkXG4gICAgICAvLyAgIHRoaXMuY29tcG9uZW50RXZlbnRDYWNoZS5wdXNoKG1zZyk7XG5cbiAgICAgIC8vICAgcmV0dXJuO1xuICAgICAgLy8gfSBlbHNlIHtcbiAgICAgIC8vICAgdGhpcy5jbGVhckV2ZW50Q2FjaGUoKTtcbiAgICAgIC8vIH1cblxuICAgICAgdGhpcy5wcmV2aW91c0NvbXBvbmVudCA9IHJlYWN0Q29tcG9uZW50O1xuXG4gICAgICAvLyBtZXNzYWdlIGlzIHNlbnQgd2hlbiBzb21ldGhpbmcgaW4gdGhlIHBvcHVwIG1lbnUgaXMgc2VsZWN0ZWRcbiAgICAgIGlmIChtb3VzZUV2ZW50Py5tZXRhS2V5KSB0aGlzLmNyZWF0ZVBvcHVwTWVudShtc2cpO1xuICAgICAgLy8gdGhpcy5zZW5kRXZlbnQobXNnKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVjb3JkaW5nIGV2ZW50XCIsIGUpO1xuICAgIH1cbiAgfTtcblxuICBzZW5kRXZlbnQgPSBhc3luYyAobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xuICAgIC8vIGNvbnN0IGFjY291bnRJZCA9IHdpbmRvd1tcImRhdGFMYXllclwiXVswXVtcImFwaUtleVwiXTtcbiAgICBjb25zdCBhY2NvdW50SWQgPSAod2luZG93IGFzIHsgW2tleTogc3RyaW5nXTogYW55IH0pW1wiZGF0YUxheWVyXCJdWzBdW1wiYXBpS2V5XCJdXG4gICAgLy8gY29uc3Qgd3JpdGVMb2NhdGlvbiA9ICh3aW5kb3cgYXMgeyBba2V5OiBzdHJpbmddOiBhbnkgfSlbXCJkYXRhTGF5ZXJcIl1bMF1bXCJ0ZXN0TG9jYXRpb25cIl1cbiAgICBjb25zdCB1cmwgPSBgLy9sb2NhbGhvc3Q6MzAwMi9hcGkvYWNjb3VudHMvJHthY2NvdW50SWR9L2V2ZW50cy9gO1xuICAgIC8vIGNvbnNvbGUubG9nKCd0aGlzIGlzIHRoZSB3cml0ZSBsb2NhdGlvbjogJywgd3JpdGVMb2NhdGlvbiwgYWNjb3VudElkKTtcbiAgICAvLyBjb25zb2xlLmxvZygndGhpcyBpcyB0aGUgbWVzc2FnZSBpbiBTRU5EX0VWRU5UOiAnLCBtZXNzYWdlKVxuXG4gICAgLy8gbWVzc2FnZS53cml0ZVRlc3RMb2NhdGlvbiA9IHdyaXRlTG9jYXRpb25cblxuXG4gICAgYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgbW9kZTogXCJjb3JzXCIsXG4gICAgICBjYWNoZTogXCJuby1jYWNoZVwiLFxuICAgICAgY3JlZGVudGlhbHM6IFwic2FtZS1vcmlnaW5cIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB1cmw6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLFxuICAgICAgICBldmVudDogbWVzc2FnZSxcbiAgICAgICAgLy8gVE9ETzogdGVzdCBzZXQgaWQgc2hvdWxkIGJlIHNldCB3aGVuIGNyZWF0aW5nL2xvYWRpbmcgdGVzdHNldCBpbiB0aGUgcnVubmVyXG4gICAgICAgIHBsYWNlaG9sZGVyOiBudWxsLFxuICAgICAgfSksXG4gICAgfSk7XG4gIH07XG59XG5cbig8YW55PndpbmRvdykuZXZlbnRSZWNvcmRlciA9IG5ldyBBc3NlcnRseUNsaWVudCgpO1xuKDxhbnk+d2luZG93KS5ldmVudFJlY29yZGVyLnN0YXJ0KCk7XG5cbiJdLCJzb3VyY2VSb290IjoiIn0=