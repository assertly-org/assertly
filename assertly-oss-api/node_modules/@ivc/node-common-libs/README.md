# node-common-libs

Shared NodeJS libraries.  Including but not limited to:

1. Database connections
2. Common middleware
3. Basic shared utilities

## Implementation

* Install this library into your app: 

`npm install @ivc/node-common-libs` 
* make sure your project has a config.default.json and config.local.json. 
The local config file can be an empty object, or override default values. 
* load the config into the app:

```javascript
const nodeCommonLibs = require('@ivc/node-common-libs');
app.locals.config = nodeCommonLibs.loadConfig(__dirname + '/../../');
```
 
* initialize distributed tracing if desired.  
This must be done before anything else is imported so it can attach trace span handlers to other libraries:

```javascript
if (config.datadog && config.datadog === true) {
  nodeCommonLibs.initDistributedTracing('app-name-here', config.http_url);
}
```

* add connections to external systems:

```javascript
  // external system connector instantiation
  const clients = await nodeCommonLibs.initConnections(app);
  redisClient = clients.redis.redisClient;
  const esClient = nodeCommonLibs.getESClient('main');
  const pgClient = nodeCommonLibs.getPgClient('business');
  const pgReadOnlyClient = nodeCommonLibs.getPgClient('readonly');
```

